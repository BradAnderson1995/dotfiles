/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
function checkSimSearch(){function a(a){if(a){var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=Browser.extension.getURL("css/"+a),document.head.appendChild(b)}}function b(a){if(!a)return!1;var b=document.querySelector("link[href='"+Browser.extension.getURL("css/"+a)+"']");return!!b}var c=document.location.href,d="searchhelper.css";for(var e in searchEngines)if(searchEngines[e].regexp.test(c)){a(d),a(searchEngines[e].css),searchEngine=e,setInterval(function(){b("searchhelper.css")||a("searchhelper.css"),b(searchEngines[searchEngine].css)||a(searchEngines[searchEngine].css)},1e3);break}searchEngine&&(searchHelper=new SearchHelper)}function SearchHelper(){function a(a){if("string"==typeof a)return document.querySelector(a);for(var b=0;b<a.length;b++){var c=document.querySelector(a[b]);if(c)return c}return null}function b(){return a(searchEngines[searchEngine].insertBefore)}function c(a){a&&a.auth&&a.auth.username?(o=a.auth,g(!0)):g(!1)}function d(a){l=a.options,m=a.bootstrapInfo,n=l.secureProto+m.serviceHost,("Google"!=searchEngine||"Google"==searchEngine&&document.getElementById("ires"))&&e()}function e(){clearTimeout(p),p=setTimeout(function(){l.useSearchHelper&&q&&Browser.sendToExtension({name:"main_isAuthenticated",type:"simSearch"})},300)}function f(){var a=searchEngines[searchEngine].queryParam,b=document.querySelector("input[name='"+a+"']");return b.value&&""!=b.value.trim()?!0:!1}function g(a){var c=document.getElementById("evernoteSimSearchResults");if((!c||c.getAttribute("extension")==Browser.i18n.getMessage("@@extension_id"))&&(k&&k.parentNode&&k.parentNode.removeChild(k),f())){k=document.createElement("iframe");var d="content/sim_search_results.html?locale="+m.name+"&baseUrl="+n;a&&(d+="&userId="+o.userId+"&shardId="+o.shardId),k.id="evernoteSimSearchResults",k.setAttribute("extension",Browser.i18n.getMessage("@@extension_id"));var e=b();e&&e.parentNode&&(e.parentNode.insertBefore(k,e),k.src=Browser.extension.getURL(d),i())}}function h(a){k.style.height=a.height+"px",k.style.display=0==a.height?"none":"block"}function i(){var a=document.getElementById("evernoteSimSearchResults"),b=document.getElementById("rhs");a&&b&&(a.style.width=Math.min(Math.max(window.innerWidth-b.offsetLeft-30,280),456)+"px")}function j(){q=!1}var k,l,m,n,o,p,q=!0;Browser.addMessageHandlers({simSearch_isAuthenticated:c,simSearch_sendHeight:h,temporarilyDisableSimSearch:j,config:d}),["Google","Bing","Baidu","Yandex"].indexOf(searchEngine)>-1?(document.addEventListener("webkitAnimationStart",function(a){a&&"simSearch"===a.animationName&&e()}),"Google"==searchEngine&&window.addEventListener("resize",i)):window.addEventListener("hashchange",function(){e()}),Browser.sendToExtension({name:"main_getConfig",options:{secureProto:null,useSearchHelper:null},bootstrapInfo:{serviceHost:null,name:null}}),Object.preventExtensions(this)}var searchEngine,searchHelper,searchEngines={Baidu:{regexp:/^https?:\/\/([^.\/]+\.)?baidu\.(com|cn)/i,queryParam:"wd",insertBefore:[".c-container"]},Bing:{regexp:/^https?:\/\/([^.\/]+\.)?bing\.com\/search/i,queryParam:"q",insertBefore:["#results","#b_results .b_algo"]},Daum:{regexp:/^https?:\/\/search\.daum\.net\/search/i,css:"daumsearchhelper.css",queryParam:"q",insertBefore:["#splinkColl+div+hr+[id$='Coll']","#mArticle [id$='Coll']","#noResult"]},Google:{regexp:GlobalUtils.buildGoogleRegEx(),queryParam:"q",insertBefore:["#rhs_block"]},Naver:{regexp:/^https?:\/\/search\.naver\.com\/search\.naver/i,queryParam:"query",insertBefore:[".section:not(.ad_power) > .section_head","#notfound p"]},Yahoo:{regexp:/^https?:\/\/([^.\/]+\.)*yahoo(\.com|\.co\.jp)\/s(earch|\?)/i,queryParam:"p",insertBefore:["#web","#WS2m","#WS2al p"]},YahooCN:{regexp:/^https?:\/\/([^.\/]+\.)*yahoo\.cn\/s(earch|\?)/i,queryParam:"q",insertBefore:[".record",".tip_query"]},Yandex:{regexp:/^https?:\/\/([^.\/]+\.)?yandex\.(com|ru)\/yandsearch/,css:"yandexrusearchhelper.css",queryParam:"text",insertBefore:[".serp-list"]}};Object.preventExtensions(SearchHelper);