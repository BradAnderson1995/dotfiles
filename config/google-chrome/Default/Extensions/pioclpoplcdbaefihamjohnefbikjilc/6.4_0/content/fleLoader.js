/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
!function(){function a(){m||(l.style.display="block",l.contentWindow.postMessage({name:"taskFinished",type:"markup"},Browser.extension.getURL("")),m=!0)}function b(){return window===window.parent&&/^((www|stage|stage-corp|stage-china)\.)?(evernote|yinxiang)\.com$/i.test(document.location.host)&&/^.*?\/webclipper\/whats_new\/?$/i.test(document.location.pathname)&&"?firstlaunch"===document.location.search.toLowerCase()}function c(){this.removeEventListener("click",arguments.callee);var a=document.querySelector("#webclipper-fle-markup");a.addEventListener("webkitTransitionEnd",d),a.style.opacity="0"}function d(){this.removeEventListener("webkitTransitionEnd",arguments.callee),this.style.display="none",a()}function e(a){var b=document.createElement("div");if(b.id="webclipper-fle-markup",b.innerHTML=a.response,GlobalUtils.localize(b),document.documentElement.appendChild(b),SAFARI){var d=document.createElement("link");d.rel="stylesheet",d.href=Browser.extension.getURL("content/fle/flemarkup.css"),document.documentElement.appendChild(d)}b.style.opacity="1",b.querySelector(".next-button").addEventListener("click",c)}function f(){document.getElementById("evernoteGlobalTools")?(document.getElementById("evernoteGlobalTools").style.zIndex="0",l=document.createElement("IFRAME"),l.id="evernoteFlePage",l.src=Browser.extension.getURL("content/fle/fle.html"),l.seamless=!0,document.documentElement.appendChild(l)):setTimeout(function(){f()},300)}function g(a){l.contentWindow.postMessage({name:"taskFinished",type:a.type},Browser.extension.getURL(""))}function h(){l&&b()&&(Browser.sendToExtension({name:"loadXMLHttpRequest",url:Browser.extension.getURL("content/fle/flemarkup.html")}),l.style.display="none")}function i(){!o&&n&&(o=!0,Browser.sendToExtension({name:"tourLoaded"}))}function j(){l.contentWindow.postMessage({name:"taskFinished",type:"screenshot"},Browser.extension.getURL(""))}var l,m=!1,n="undefined"==typeof document.hidden?!0:!document.hidden,o=!1;b()&&(window.addEventListener("unload",function(){Browser.sendToExtension({name:"finishTour"})}),document.addEventListener("visibilitychange",function(){n=!document.hidden||n,i()}),Browser.addMessageHandlers({receiveXMLHttpRequest:e,startTour:f,taskFinished:g}),window.addEventListener("message",function(a){if("eventDetected"==a.data.name)l.contentWindow.postMessage(a.data,Browser.extension.getURL(""));else if("fleMarkUp"==a.data.name)h();else if("redirect"==a.data.name){Browser.sendToExtension({name:"finishTour"});var b=document.location.protocol+"//"+document.location.host+document.location.pathname+"?firstlaunchreturn";document.location.replace(b)}else if("getLocation"==a.data.name){var c={name:"getLocationReply",location:{}};for(k in location){var d=location[k];"string"==typeof d&&(c.location[k]=d)}l.contentWindow.postMessage(c,Browser.extension.getURL(""))}}),window.screenshotDone=j,i())}();