/*! Copyright 2009-2015 Evernote Corporation. All rights reserved. */
"use strict";function msgHandlerReceiveRelatedNotes(a){if(document.getElementsByClassName("branding")[0].href=baseUrl+"/SetAuthToken.action?auth="+encodeURIComponent(a.tokens.pers)+"&targetUrl="+encodeURIComponent("/Home.action"),a.relatedNotes){var b,c=a.relatedNotes;if("account"===a.type){b=document.querySelector("#account .noteSectionNotes");var d,e;e=a.isBizUser?"searchHelperTopMatchesBiz":"searchHelperTopMatchesPers",1==c.length&&(e+="One"),d=Browser.i18n.getMessage(e,[c.length]),document.querySelector("#account .noteSectionTitle").innerText=d}else"library"===a.type?(b=document.querySelector("#library .noteSectionNotes"),document.querySelector("#library .noteSectionTitle").innerText=1==c.length?Browser.i18n.getMessage("searchHelperTopBizLibraryMatchesOne"):Browser.i18n.getMessage("searchHelperTopBizLibraryMatches",[c.length])):"all"===a.type&&(b=document.querySelector("#all .noteSectionNotes"),document.querySelector("#all .noteSectionTitle").innerText=1==c.length?Browser.i18n.getMessage("searchHelperTopMatchesPersOne"):Browser.i18n.getMessage("searchHelperTopMatchesPers",[c.length]));b.parentNode.style.display=c.length>0?"block":"none";var f=new NoteSnippets(b,baseUrl,userId,shardId,a.tokens,null,!0,function(a,b){Browser.sendToExtension(b?{name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"expert",value:totalNumNotes}:a?{name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"business",value:totalNumNotes}:{name:"trackEvent",category:"Simsearch",action:"view_related_notes",label:"personal",value:totalNumNotes})});f.renderBlocks(c),totalNumNotes+=c.length;var g=document.createElement("div");g.className="noteSectionShadow",b.parentNode.insertBefore(g,b),b.addEventListener("overflowchanged",function(a){g.style.display=a.horizontalOverflow?"block":"none"}),"block"==document.querySelector("#noNotes").style.display&&(document.querySelector("#noNotes").style.display="none",Browser.sendToExtension({name:"setPersistentValue",key:userId+"_noSimsearchResultsShown",value:!1})),Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:getWindowHeight(f.hasAtLeastOneNotebookName())}})}else document.querySelector("#"+a.type+" .noteSectionNotes").parentNode.style.display="none",document.querySelector("#"+a.type+" .noteSectionNotes").innerHTML="",getWindowHeight()>0||(a.noSimsearchResultsShown&&0!=a.noSimsearchResultsShown?Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:0}}):(document.querySelector("#noNotes").style.display="block",Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:getWindowHeight()}}),Browser.sendToExtension({name:"setPersistentValue",key:userId+"_noSimsearchResultsShown",value:!0})))}function getWindowHeight(a){var b=document.querySelector("#account .noteSectionNotes"),c=document.querySelector("#library .noteSectionNotes"),d=document.querySelector("#all .noteSectionNotes"),e=document.querySelector("#noNotes"),f=0;return""!=b.innerHTML&&(f=263),(""!=c.innerHTML||""!=d.innerHTML)&&(f=a?282:263),""!=b.innerHTML&&""!=c.innerHTML&&(f=500),"block"==e.style.display&&(f=85),f}function toggleCloseOptions(){document.querySelector("#closeOptions").style.display="block"==document.querySelector("#closeOptions").style.display?"none":"block"}function dismiss(){Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:0}}),Browser.sendToExtension({name:"bounce",message:{name:"temporarilyDisableSimSearch"}})}function dismissForever(){dismiss(),Browser.sendToExtension({name:"main_setOption",options:{useSearchHelper:!1}})}function tellUserToLogin(){document.querySelector("#simSearchNotes").innerHTML=Browser.i18n.getMessage("searchHelperLoginMessage",[baseUrl+"/Login.action"]),Browser.sendToExtension({name:"bounce",message:{name:"simSearch_sendHeight",height:85}})}var baseUrl,locale,userId,shardId,totalNumNotes=0;window.addEventListener("DOMContentLoaded",function(){GlobalUtils.localize(document.body),document.getElementById("closeButton").addEventListener("click",toggleCloseOptions),document.getElementById("dismiss").addEventListener("click",dismiss),document.getElementById("dismissForever").addEventListener("click",dismissForever);for(var a=decodeURI(document.location.href),b=/(locale|baseUrl|userId|shardId)=([^&]+)/g,c=b.exec(a);c;)"locale"===c[1]?locale=c[2]:"baseUrl"===c[1]?baseUrl=c[2]:"userId"===c[1]?userId=c[2]:"shardId"===c[1]&&(shardId=c[2]),c=b.exec(a);/china/i.test(locale)&&(document.querySelector(".branding span").className="china"),userId?(Browser.addMessageHandlers({simsearch_receiveRelatedNotes:msgHandlerReceiveRelatedNotes,tellUserToLogin:tellUserToLogin}),Browser.sendToExtension({name:"simSearch_getNotesRelatedToSearchQuery"})):tellUserToLogin()});