LPhistory=new LPhistory_lib;function write_history(b){if(!g_isdebug||!verbose)return!0;LPhistory||(LPhistory=new LPhistory_lib);return LPhistory.write(b)}function show_history(){return dump_history()}function reset_history(){LPhistory||(LPhistory=new LPhistory_lib);return LPhistory.reset()}function dump_history(){LPhistory||(LPhistory=new LPhistory_lib);return LPhistory.dump()}
function LPhistory_lib(){function b(c){if(!c)return null;var a=c.prop;c=c.dflt;"undefined"==typeof c&&(c=null);var b=a;if("undefined"==typeof a||null===a)b=c;return b}var e=[];this.write=function(c){if(!g_isdebug||!verbose)return!0;if(!c)return!1;"undefined"==typeof c.timestamp&&(c.timestamp=(new Date).getTime());var a,b=c.tabid,d=c.docnum;"undefined"==typeof c.docnum&&(null!==g_CS_tops&&b)&&(d=g_CS_tops[b]);null!==d&&("undefined"!=typeof d&&b)&&(a="","all"==d?a=ftd_get_topurl(b):(a=getcsinfo(b,d))&&
a.url?a=a.url:g_CS[b]&&g_CS[b][d]?(b=g_CS[b][d],a=gettaburl(b),a||(a=b.name)):a="",c.url=a);!g_isdebug||!verbose?c=!0:(e||(e=[]),c?("undefined"==typeof c.timestamp&&(c.timestamp=(new Date).getTime()),8192<e.length&&e.shift(),e.push(c),c=!0):c=!1);return c};this.dump=function(){if(!g_isdebug||!verbose)return!0;if(!e)return console.error("empty history !"),!1;var c;for(c=0;c<e.length;c++){var a=e[c];if(a){var g="",d=a.timestamp,g="undefined"==typeof d||null===g?"none?":"undefined"!=typeof(new Date(d)).toUTCString?
(new Date(d)).toUTCString():parseInt(d/1E3).toString(),d=b({prop:a.aid,dflt:""}),j=b({prop:a.tabid,dflt:""}),k=b({prop:a.cmd,dflt:"none?"}),l=b({prop:a.url,dflt:""}),m=b({prop:a.msg,dflt:""}),h=b({prop:a.docnum,dflt:""}),n=b({prop:a.docstate,dflt:""}),p=b({prop:a.submit,dflt:"none"}),t=b({prop:a.doconfirm,dflt:"none"}),q=b({prop:a.allowforce,dflt:"none"}),r=b({prop:a.name,dflt:""}),u=b({prop:a.custom_js,dflt:""}),v=b({prop:a.is_launch,dflt:""}),s=b({prop:a.manualfill,dflt:""}),w=b({prop:a.username,
dflt:""}),x=b({prop:a.result,dflt:""}),a=b({prop:a.force_fillbest,dflt:"none"}),f="";switch(k){case "fill_A1":case "fill_A2":case "fill_A3":case "fill_A4":case "FILL_F2":case "FILL_F3":case "FILL_F4":case "FILL_F5":case "FILL_F6":case "fill_PW":case "FILLBASIC":case "autofillaid":case "autologinaid":f=sprintf("[submit=%s][doconfirm=%s][allowforce=%s]",p,t,q);break;case "fillfieldCS":f=sprintf("[name=%s][manualfill=%s][is_launch=%s][custom_js=%s]",r,s,v,u);break;case "fillbestCS":f=sprintf("[username=%s][force_fillbest=%s]",
w,a);break;case "check_autologin1":case "check_autologin2":case "check_autologin3":f=sprintf("[dosubmit=%s]",p);break;case "fillfieldconfirm":f=sprintf("[result=%s][manualfill=%s][allowforce=%s][fieldname=%s][force_fillbest=%s]",x,s,q,r,a);break;default:f=""}console.log(sprintf("[%s][%s]%s%s%s%s%s%s%s",k,g,j?sprintf("[tabid=%s]",j):"",h||0===h?sprintf("[docnum=%s]",h):"",l?sprintf("[url=%s]",l):"",d||0===d?sprintf("[aid=%s]",d):"",m?sprintf("[msg=%s]",m):"",n?sprintf("[docstate=%s]",n):"",f))}}return!0};
this.reset=function(){e=[];return!0}};
