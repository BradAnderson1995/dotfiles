function AppApi(){this._resources={images:{}},this._app_info={},this.version="5.0.10",this.platform=null,this.merchant="merch";this.setAppInfo=function(e){this._app_info=e},this.dAppInfo=pns$.Deferred(),this.appInfoInit=function(){var e=pns$.Deferred();return e.done(function(e){appAPI.setAppInfo(e)}),e.resolve({}),e.promise()},this.LOG_LEVELS={Fatal:70,Error:60,Warn:50,Info:40,Config:30,Debug:20,Trace:10,All:0,Desc:{70:"FATAL",60:"ERROR",50:"WARN",40:"INFO",30:"CONFIG",20:"DEBUG",10:"TRACE",0:"ALL"}},this._log_level=this.LOG_LEVELS.Fatal,this.setLogLevel=function(e){this._log_level=this.LOG_LEVELS[e]},this.setAppInfo=function(e){this._app_info=e},this.request={get:function(e,t,n){var o=forge.request.get(e,t,n);return o},post:function(e,t,n,o){var r=pns$.ajax({type:"POST",url:e,dataType:"json",data:t}).done(n).fail(o);return r}},this.bgPost=function(e,t){var n=pns$.Deferred();return forge.message.broadcastBackground("bg_post",{url:e,data:t},function(e){"error"!=e.status?n.resolve(e.response):n.reject(e.response)}),n.promise()},this.bgGet=function(e){var t=pns$.Deferred();return forge.request.get(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},this.getLocalResource=function(e){var t=pns$.Deferred();return forge.tools.getURL(e,function(e){appAPI.request.get(e,function(e){t.resolve(e)}),function(){forge.logging.error("error occured during retrieval of local resource")}}),t.promise()},this.getStorageKey=function(e,t){var n=pns$.Deferred();return forge.prefs.get(e,function(e){n.resolve(e)}),n.promise()},this.setStorageKey=function(e,t){var n=pns$.Deferred(),o={};return o[e]=t,forge.prefs.set(e,t,function(){n.resolve(t)}),n.promise()},this.removeStorageKey=function(e,t){var n=pns$.Deferred();return forge.prefs.clear(e,function(){n.resolve()}),n.promise()},this.getChromeSyncKey=function(e,t){var n=pns$.Deferred();try{forge.is.chrome()?chrome.storage.sync.get(e,function(o){t&&!parseInt(o[e])?n.reject():"undefined"==typeof o[e]?n.reject():n.resolve(o[e])}):n.reject()}catch(o){n.reject()}return n.promise()},this.setChromeSyncKey=function(e,t){var n=pns$.Deferred(),o={};o[e]=t;try{forge.is.chrome()?chrome.storage.sync.set(o,function(){n.resolve(!0)}):n.reject()}catch(r){n.reject()}return n.promise()},this.getUserPrefs=function(){var e=pns$.Deferred();return forge.prefs.get("user_prefs",function(t){e.resolve(t?t:{})},function(){e.reject()}),e.promise()},this.setUserPrefs=function(e,t){var n=pns$.Deferred();return forge.prefs.get("user_prefs",function(o){null!=o?(o[e]=t,forge.prefs.set("user_prefs",o),n.resolve(o)):(o={},o[e]=t,forge.prefs.set("user_prefs",o),n.resolve(o))},function(){n.reject()}),n.promise()},this.sendExtMessage=function(e,t){},this.appInfo={platform:null,getEnvironment:function(){return"staging"},getVersion:function(){return appAPI.version},getPlatform:function(){return this.platform?this.platform:forge.is.chrome()?"CH":forge.is.firefox()?"FF":forge.is.safari()?"SF":forge.is.ie()?"IE":"NA"}},this.JSON={parse:function(e){return JSON.parse(e)},stringify:function(e,t){return JSON.stringify(e,t)}},this.dom={execPageJS:function(e){window.location.href="javascript: (function(){"+e+"}())"}},this.resources={getImage:function(e){return Config.bcloud_host+"/resources/"+e},parseTemplate:function(e,t){return JST["templates/"+e](t)},getResource:function(e){return Config.bcloud_host+"/resources/"+e}},this.setResources=function(e){this._resources=e},this.dResources=pns$.Deferred(),this.resourcesInit=function(){var e=pns$.Deferred();return e.resolve(),e.promise()},this.getResourceURL=function(e){return forge.tools.getURL(e)},this.init=function(){this.dAppInfo=this.appInfoInit(),this.dResources=this.resourcesInit(),this.ready=pns$.when(this.dResources,this.dAppInfo).done}}function on_honey_dev_page(){var e=".*chrome-extension://.*/honey_ch_dev.html.*",t=new RegExp(e);return t.test(window.location.href)?!0:!1}function Honey(){this.user_id="0",this.device_id="0",this.shid="0",this.did="0",this.site_id="0",this.site_uid_regexes=[],this.merch_id=null,this.merch_label=null,this.merch_name=null,this.merch_meta=null,this.merch_url="",this.merchant_partial_url="",this.sales_data={},this.merch_codes={codes:[],details:[]},this.direct_apply_coupons={},this.merch_partials=[],this.coupon_code="coupon",this.gab_used=!1,this.count_sales=0,this.count_coupons=0,this.count_deals=0,this.honey_supported=!1,this.supported=!1,this.honey_cash_supported=!1,this.cash_enabled=!1,this.hsmMerchData=pns$.Deferred(),this.currency_symbol="$",this.currency_code="USD",this.country_code="US",this.launchpad_shown=!1,this.dExtRdf=null,this.dHoneyMerchMeta=null,this.dHoneyLaunchpadAdded=pns$.Deferred(),this.dCouponCodePage=pns$.Deferred(),this.observer_supported=!0,this.pageObserverTimers={},this.honeypay_ext_id=Config.honeypay_ext_id,this.honey_ext_id=Config.honey_ext_id,this.determineObserverSupport=function(){this.observer_supported=!forge.is.ie()},this.addPageObserver=function(e,t){if($h.determineObserverSupport(),$h.observer_supported){var n=(pns$(document),new MutationSummary({callback:e,queries:[{element:"*"}]}));return n}return log.info("observer not supported, skipping"),t?void 0:(log.error("attempt to add page observer when mutations are not supported without providing selector."),!1)},this.removePageObserver=function(e){var t=pns$(document);if($h.observer_supported)return log.info("disconnecting page observer from mutation summary."),t.mutationSummary("disconnect",e,[{all:!0}]);var n=$h.pageObserverTimers[e];log.info("Clearing page observer timer: "+n),clearInterval(n)},this.getMerchID=function(e,t){throw"depreciated"}}function AddonOverlay(){this.template_path="js/addons/templates/",this.iframe_el="#honey_overlay",this.ss_social_circle_path="http://46362e6d99dc8ccd2ae0-fbb611151208cbfcf9ccc8876a5d1e85.r17.cf1.rackcdn.com/ss_social_circle.css",this.ss_standard_path="http://46362e6d99dc8ccd2ae0-fbb611151208cbfcf9ccc8876a5d1e85.r17.cf1.rackcdn.com/ss-standard.css",this.ss_social_circle_secure="https://59d9bfb59648e6baac4e-fbb611151208cbfcf9ccc8876a5d1e85.ssl.cf1.rackcdn.com/ss_social_circle.css",this.ss_standard_secure="https://59d9bfb59648e6baac4e-fbb611151208cbfcf9ccc8876a5d1e85.ssl.cf1.rackcdn.com/ss-standard.css",$overlay=this}function CashbackController(){}function Cookbook(e){appAPI||(appAPI=new AppApi),this.merch_label=e||$h.merch_label,this.storage_prefix=this.merch_label+"_cookbook_",this.ingredients={},this.lib=new CookbookLib}function CookbookLib(){}function HoneyAz(){this.regex_url=/.*amazon\.com\/(?:[\w\-\%]+\/)?(?:dp|gp\/product)\/(?:\w+\/)?(\w{10})/,this.regex_unqualified=/.*\/(?:[\w\-\%]+\/)?(?:dp|gp\/product)\/(?:\w+\/)?(\w{10})/,this.requestLimit=5,this.homePageSelectors=[".s9hl a",".rankedItemInfo a"],this.categoryPageSelectors=[".s9hl a",".newaps a",".vxd-music-bs-info a"],this.staticASIN="B00EE4VGAG",this.staticsArray=[{asin:"B00O8LFGEC",token:"FDB751F251410B9F98AA62BF6C06D270266DA707"},{asin:"B00M1E55HQ",token:"79D1F79283B6B2DFE1614905285283FCB30D45B4"},{asin:"B00NNZ2SBS",token:"4BC3013AAE40E097E38B7723F92139AFA2E52623"},{asin:"B00AA982CY",token:"1B761A8A2E3E832C19CAE95403DD5017B57A7CD3"},{asin:"B00F595M4U",token:"94323F48336E6D5DC945F6D5348EE7E3A5357CBB"},{asin:"B00M1OUBES",token:"483C03115A3B09A5BC7A7B799E002E7CE6E7DD15"},{asin:"B00MNAWM4W",token:"A4AE673FDA4B8CBC08E5C701CD196D3EF5AE21E0"},{asin:"B00NSHLUBU",token:"4AD285B306E3AF9B636A4E7392E46F34D1B96D4F"},{asin:"B00F5NB7MW",token:"3E8748BA93E967799417BCD93CB29D23395BCB92"},{asin:"B00EE4VGAG",token:"99C354359DF4369BE6A03AC574883B7E3231C54D"}],this.staticToken="99C354359DF4369BE6A03AC574883B7E3231C54D",this.cids=["78466f529a8fb3ddf5af7b34217590254d9061224f75961eb3c25d28ee958170","d2c4ce878f78d258ac8fdbc00005c4ed1f3f89f27458792d76ea4001e0f3cf7a"],this.deferreds=[],this.array_results=[],$honeyUpdater=this}function Fngt(){this.az_id=0,this.az_did=0,this.az_key="a1-ss"}function GABController(){this.offer={ttl:0,id:0,start_time:0,claimed:!1},this.sid="pns_",this.site_id=$h.store_id,this.d_offer_claimed=pns$.Deferred(),this.d_offer_available=pns$.Deferred(),this.user=User.getInstance(),this.timer=null,this.amazon_gab_key="amazon_gab_offer"}function HoneyMap(){this.features=[],this.regex_array,this.dRegex=pns$.Deferred(),$map=this}function UserClass(){this.d_login=pns$.Deferred(),this.user_details=null,this.api_url=Config.quest_api,this.merchant="merch",this.id="",this.username="",this.email="",this.image_url="",this.bio="",this.name="",this.deals=[],this.products=[],this.liked_products=[],this.liked_deals=[],this.liked_comments=[]}function LoginModal(){this.user=User.getInstance(),this.overlay=new AddonOverlay}function HoppsApplyCode(){$hoppsApply=this,this.pns_data=null,this.min_price=1/0,this.curr_index=0,this.current_price=0,$hoppsApply.running=!1,this.function_string="",this.preapply_function="",this.postapply_function=""}function Tutorial(){}function UnoGeneric(){this.prodNameMeta="",this.prodImageMeta="",this.prodSalePriceMeta="",this.prodListPriceMeta="",this.prodIDMeta="",this.prodSKUMeta="",this.prodRatingMeta="",this.prodDescriptionMeta="",this.prodAvailabilityMeta="",this.flag=!1,this.multiple=!1}function GrouponFinder(){this.groupon_track_url="http://tracking.groupon.com/r?tsToken=US_AFF_0_203781_252123_0&url=",this.geocode_url="http://maps.google.com/maps/api/geocode/",this.groupon_api="https://api.groupon.com/v2/deals",this.element_to_append_to=".media-block .media-story",this.search_query="",this.location_query="",this.count_deals=30,this.lat,this.lng,$grouponFinder=this}function Launchpad(){this.iframe_sel="launchpad_iframe",this.iframe_el="#"+this.iframe_sel,this.template_path="js/launchpad/tmpl/",this.css_path="css/",this.code_details=[],this.dCouponsInit=null,this.dSalesInit=null,this.apply_panel_initialized=!1}window.AppApi=AppApi;var Config={bcloud_host:"https://sbcloud.joinhoney.com",rcloud_host:"https://sbcloud.joinhoney.com",ipa_host:"https://dan.joinhoney.com/honeypay"};Config.environment="CH",Config.savehoney_api="https://data.joinhoney.com",Config.data_api="https://sdata.joinhoney.com",Config.quest_api=Config.savehoney_api,Config.joinhoney_url="https://joinhoney.com",Config.template_finished_url="https://data.joinhoney.com/extdata/template/find_savings:finished",Config.feedback_url=function(){return"http://dan.joinhoney.com/honeyid.php"},Config.savehoney_api_url=function(){return Config.savehoney_api},Config.write_honey_button_click_url=function(){return Config.data_api+"/he200"},Config.write_merch_stats_url=function(){return Config.data_api+"/he101"},Config.write_honey_results_url=function(){return Config.data_api+"/he201"},Config.write_honey_updates=function(){return Config.data_api+"/he801"},Config.read_merch_meta_url=function(){return"https://sbcloud.joinhoney.com/get_merchant_meta.php"},Config.read_merch_codes_url=function(){return"https://sbcloud.joinhoney.com/get_merchant_codes.php"},Config.write_cart_stats_url=function(){return Config.bcloud_host+"/set_cart_stats.php"},Config.results_page_url=function(){return Config.bcloud_host+"/get_results_page.php"},Config.bcloud_token=function(){return"219c3e1c30a10d6b0e9ad24e1da3418a612e4ea7"},Config.honey_ext_id="hkkaabjfmpakapaoabgcjhfjiloiclae",Config.honeypay_ext_id="alajbchbanbhgomglpeieojgmlakopgp",window.Config=Config,function(e,t){e.prototype.detectAdblock=function(){},e.prototype.dropAffiliate=function(e){try{var t=$h.pickOneUrl(e);t&&(forge.is.chrome()?$h.openAffiliateTab(t):forge.tabs.open(t,!0))}catch(n){log.debug(n.message)}},e.prototype.pickOneUrl=function(e){if(!e)return null;if(1==e.length)return e[0].url;var t=0;for(n in e)t+=e[n].val;t=Math.random()*t;for(var n in e)if(t-=e[n].val,0>=t)return e[n].url;return null},e.prototype.openAffiliateTab=function(e){forge.is.chrome()&&forge.message.broadcastBackground("open_unfocused_tab",e)},e.prototype.addPixel=function(e){var t='<iframe id="opmif" \n                  sandbox="allow-same-origin allow-scripts" \n                  src="'+e+'" \n                  width="1" height="1" display="none"/>';pns$("body").append(t)}}(Honey,this);var _gaq=window._gaq||[];!function(e,t){e.ga_account="UA-35588908-1",e.ga_domain=document.location.host,e.ga_track_url=document.location.href,e.prototype.gaInit=function(){_gaq.push(["_setAccount",e.ga_account]),_gaq.push(["_setDomainName",e.ga_domain]),_gaq.push(["_setAllowLinker",!0]),_gaq.push(["_trackPageview"]),log.debug("GA "+e.ga_account+" initialized for domain: "+e.ga_domain+", url: "+e.ga_track_url)},e.prototype.gaTrackEvent=function(e,t,n,o){log.debug("GA Tracking Event: "+[e,t,n,o].join(", ")),_gaq.push(["_trackEvent",e,t,n,o])}}(Honey,this),function(e,t){e.prototype.getVersion=function(){return $h.shid&&$h.did?appAPI.appInfo.getPlatform()+"."+appAPI.appInfo.getVersion()+"."+$h.shid+"."+$h.did:appAPI.appInfo.getPlatform()+"."+appAPI.appInfo.getVersion()+".0.0"},e.prototype.setCountry=function(e,t){$h.country_code=e,$h.currency_code=$h.currencies_by_country[$h.country_code],t&&($h.currency_symbol=t)},e.prototype.isMerchDataValid=function(e){return null!=e&&"number"==typeof e.ttl&&e.ttl>0&&"number"==typeof e.last_update&&"object"==typeof e.merch_data},e.prototype.getMerchData=function(e){var t=pns$.Deferred();return $h.getMerchDataFromLocal(e).done(function(e){log.info("successfully got valid local data"),t.resolve(e)}).fail(function(){log.info("local data rejected, attempting to get remote "),$h.getMerchDataRemote(e).done(function(e){t.resolve(e)}).fail(function(){log.info("remote data failed, falling back to local data "),$h.getMerchDataFromLocal(e,!0).done(function(e){t.resolve(e)}).fail(function(){t.reject()})})}),t.promise()},e.prototype.clearMerchDataCache=function(){return appAPI.setStorageKey("pns_"+$h.merchant_partial_url,null)},e.prototype.getMerchDataFromLocal=function(e,t){var i=pns$.Deferred();return e=e?e:$h.merchant_partial_url,appAPI.getStorageKey("pns_"+e).done(function(a){if(log.info("getting merch data with key: pns_"+e),!$h.isMerchDataValid(a))return i.reject();if(!t){var s=((new Date).getTime()-a.last_update)/1e3;if(s>=a.ttl)return log.debug("merch_data has expired, dT "+s+"s since last update: "+a.last_update),i.reject()}log.info("using local data ");var p=a.merch_data;n(p),o(p),r(p),i.resolve(a)}),i.promise()},e.prototype.setMerchDataToLocal=function(e){var t=600;e.ttl&&(t=e.ttl);var n={merch_url:window.location.hostname,ttl:t,last_update:(new Date).getTime(),merch_data:e};$h.merchant_partial_url&&appAPI.setStorageKey("pns_"+$h.merchant_partial_url,n).done(function(){log.info("local data saved with key pns_"+$h.merchant_partial_url)})},e.prototype.getMerchDataRemote=function(e){var t=pns$.Deferred(),i="remote_cache_ttl_"+e;return log.info(i),appAPI.getStorageKey(i).done(function(e){log.info("remote cache is "+JSON.stringify(e)),!e||e.err_ttl+e.last_check<Date.now()||e.counter<3?(log.info("allowing request through to find"),forge.document.location(function(e){var a=Config.savehoney_api_url(),s=a+"/stores/find?url="+encodeURIComponent(e.href.split("?")[0])+"&sales=1&coupons=1&meta=1&max_sales=5&direct_apply_coupons=1&affiliate=1";forge.request.get(s,function(e){n(e),o(e),r(e),$h.setMerchDataToLocal(e),t.resolve(e)},function(e){appAPI.getStorageKey(i).done(function(n){if(log.info("retry fail "+JSON.stringify(n)),n&&n.last_check+n.err_ttl>Date.now())n.counter++,appAPI.setStorageKey(i,n);else{var o={counter:0,err_ttl:3e5,last_check:Date.now()};appAPI.setStorageKey(i,o)}t.reject(),log.debug("Failed to get data: "+e.message)})})},function(e){log.debug("Failed to get document location: "+e.message),t.reject()})):(log.info("remote cache ttl not expired, reject"),t.reject())}),t.promise()};var n=function(e){e.country&&$h.setCountry(e.country),$h.merch_id=e.pnsid,$h.site_id=e.id,$h.site_uid_regexes=e.uid_regexes,$h.merch_url=e.url||"",$h.merch_label=e.label,$h.merch_name=e.name,$h.merch_meta=e.metadata,$h.merch_partials=e.partial_urls||[],$h.honey_supported=e.supported,$h.direct_apply_coupons=e.direct_apply_coupons||{},$h.affiliate=e.affiliate||{}},o=function(e){var t=e.coupons;$h.count_coupons=e.num_coupons,$h.count_deals+=$h.count_coupons,$h.merch_codes_original=t;var n={codes:[],details:[]},o=0;for(o=0;o<t.length;o++){var r=t[o].code;n.codes.push(r),n.details.push(t[o])}var i=pns$.extend(!0,{},n);$h.merch_meta&&(i.codes=i.codes.slice(0,$h.merch_meta.pns_siteCodeMax)),$h.merch_codes=i},r=function(e){$h.sales_data=e.sales,$h.count_sales=e.num_sales,$h.count_deals+=$h.count_sales};e.prototype.loadMerchMeta=function(e){var t=pns$.Deferred(),n=Config.read_merch_meta_url()+"?pns_siteID="+e;return e?(log.debug("loading merch meta: "+e),forge.request.get(n,function(e,n){if(e){var o=null;try{var o=e}catch(r){log.debug("loadMerchMeta: Error parsing JSON from server"+r)}var i=o?o:null;t.resolve(i)}else log.debug("No merch meta found"),t.reject()},function(e){log.debug("Request to merchMeta failed"),t.reject()}),t.promise()):pns$.Deferred().reject({error:"merchID is null"})},e.prototype.loadMerchCodes=function(e){var t=Config.read_merch_codes_url()+"?pns_siteID="+e+"&details=1",n=pns$.Deferred();return forge.request.get(t,function(e,o){if(e){var r=null;try{var r=e}catch(i){n.reject({error:"loadMerchCodes: request to "+t+" failed: '"+i+"'"})}var a=r?r:{codes:[],source:"default"};n.resolve(0==a.codes.length?a:a)}else n.reject("loadMerchCodes: no respose from server: "+t)},function(e){n.reject({error:"loadMerchCodes: request to "+t+" failed: '"+e+"'"})}),n.promise()},e.prototype.getSiteInfo=function(e,t,n,o){var r=$.Deferred();return appAPI.getStorageKey("user_settings").done(function(e){if((!e||(log.info(e),e.page_view_allowed))&&parseInt($h.shid)){for(var t=(Config.write_merch_stats_url(),$h.getVersion(),""),n=void 0,o=0;o<$h.site_uid_regexes.length;o++){var r=window.location.href.match($h.site_uid_regexes[o].pattern);if(r){t=r[1],n={id:t};break}}var i=$h.honey_supported?1:0;$h.sendEvent("ext001001",{product:n,store:{id:$h.site_id,supported:i,num_coupons:$h.count_coupons}})}}),r.promise()},e.prototype.setHoneyClickEvent=function(e,t,n,o){var r=pns$.Deferred();return $h.sendEvent("ext003002",{}),r.resolve()},e.prototype.setCouponStats=function(e,t,n,o,r,i,a,s,p,d){{var l=pns$.Deferred();Config.write_honey_results_url()}e=e||appAPI.appInfo.getPlatform();var c=($h.getVersion(),{});c=d?$h.determineHoppsCodes(d,n):$h.determineAccurateCodes(a,s,n);var u={cart:{id:i,start_price:n,final_price:o,url:window.location.href,best_coupon:r},coupons:c};return window.location.href.match(/honey_demo=1/)?$h.sendEvent("ext007006",u):$h.sendEvent("ext003010",u),l.promise()},e.prototype.determineAccurateCodes=function(e,t,n){for(var o={},r=1e13,i=0;i<t.length;i++){var a={};a.discount=(n-t[i]).toFixed(2);var s=!1;t[i]<n&&r!=t[i]&&(s=!0),a.accurate=s,o[e[i]]=a,r=t[i]}return o},e.prototype.determineHoppsCodes=function(e,t){for(var n=Object.keys(e),o={},r=0;r<n.length;r++){var i={};i.discount=t-e[n[r]],i.accurate=!0,o[n[r]]=i}return o},e.prototype.sendHoneyButtonShow=function(e){var t=pns$.Deferred();return appAPI.getStorageKey("session_time").done(function(e){var t=!1,n=600;e&&log.info(e+n<Date.now()/1e3),t=e&&e+n>Date.now()/1e3?!1:!0,t&&($h.sendEvent("ext003001",{}),appAPI.setStorageKey("session_time",Date.now()/1e3))}),t.promise()},e.prototype.ping=function(){if($h.shid){var e=(new Date).getTime(),t=216e5,n=!1;forge.message.broadcastBackground("batch_check");{appAPI.getStorageKey("h_vers").done(function(o){null!=o&&o!=appAPI.appInfo.getVersion()?(log.info("old version detected: "+o+" setting to new "+appAPI.appInfo.getVersion()),n=!0,appAPI.setStorageKey("h_vers",appAPI.appInfo.getVersion())):null==o?(appAPI.setStorageKey("h_vers",appAPI.appInfo.getVersion()),log.info("no version detected, setting to "+appAPI.appInfo.getVersion())):log.info("same version detected, no need to set ping "+appAPI.appInfo.getVersion()+" "+o),forge.prefs.get("ping_server_time",function(o){o?e-o>t&&(n=!0):n=!0,n&&(parseInt($h.shid)?$h.pingServer():log.info("user id is 0, do not send"))})})}}},Honey.prototype.pingServer=function(){log.info("sending ping");var e=(new Date).getTime(),t="?v="+$h.getVersion(),n=Config.savehoney_api+"/extusers"+t;forge.request.get(n,function(t){forge.prefs.set("ping_server_time",e)}),$h.sendEvent("ext000001",{})}}(Honey,this),function(e,t){e.prototype.getCookie=function(e,t){var n=pns$.Deferred(),o={url:e,name:t};return forge.message.broadcastBackground("get_cookie",o,function(e){n.resolve(e)}),n.promise()},e.prototype.setCookie=function(e,t,n,o,r,i){var a=pns$.Deferred(),s={url:e,name:t,value:JSON.stringify(n),expiration:o,domain:r,path:i};return forge.message.broadcastBackground("set_cookie",s,function(e){log.info(e),a.resolve()}),a.promise()},e.prototype.removeCookie=function(e,t){var n={url:e,name:t};forge.message.broadcastBackground("remove_cookie",n,function(e){log.info(e)})}}(Honey,this),function(e,t){e.prototype.merch_codes=null,e.prototype.merch_codes_orig=null,e.prototype.TIMERS={FINAL:null,APPLY_CODES:null,REMOVE_CODES:null},e.prototype.APPLY_CODE_STATES={PRE_APPLY_EXEC:10,INIT:11,REMOVE_INIT:12,APPLY:20,APPLY_GET_PRICE:21,REMOVE_APPLY:22,APPLY_BEST:30,APPLY_BEST_GET_PRICE:31,REMOVE_APPLY_BEST:32,FINISH:40},e.prototype.dNegotiating=null,e.prototype.dHoneyCodeInputReady=null,e.prototype.dHasTotalPrice=null,e.prototype.dHasCodeInput=null}(Honey,this),function(e,t){e.prototype.couponsInit=function(e){log.info("(Coupons): Initializing Coupons module."),$h.merch_codes_orig=pns$.extend(!0,{},e);var t=pns$.extend(!0,{},e);t.codes=t.codes.slice(0,$h.merch_meta.pns_siteCodeMax),$h.merch_codes=t,$h.dNegotiating=pns$.Deferred(),$h.dHoneyCodeInputReady=pns$.Deferred(),$h.dHasTotalPrice=pns$.Deferred(),$h.dHasCodeInput=pns$.Deferred(),$h.dHoneyCodeInputReady.done($h.cartPageCouponHandler),$h.couponsUpdate(),$h.templatesInit()},e.prototype.templatesInit=function(){var e=pns$.Deferred();return appAPI.getLocalResource("html/progress.hbs").done(function(t){var n=Handlebars.compile(t);JST["templates/progress"]=n,e.resolve()}),appAPI.getLocalResource("css/page.css").done(function(e){var t;t=pns$("<style>",{type:"text/css"}),t.text(e),pns$("head").append(t)}),e.promise()},e.prototype.addCSS=function(e,t){var n=this,o=function(e,n){var o;o=pns$("<style>",{type:"text/css"}),o.text(e),pns$(t).append(o)};return this.progress_css?void o(this.progress_css,t):appAPI.getLocalResource(e).done(function(e){n.progress_css=e,o(e,t)})},e.prototype.cartPageCouponHandler=function(){window.onunload=window.onbeforeunload=function(e){$h.TIMERS.APPLY_CODES&&"pending"==$h.TIMERS.APPLY_CODES.state()&&(log.debug("(Coupons): Pausing APPLY_CODES timer."),$h.TIMERS.APPLY_CODES.pause()),$h.TIMERS.REMOVE_CODES&&"pending"==$h.TIMERS.REMOVE_CODES.state()&&(log.debug("(Coupons): Pausing REMOVE_CODES timer."),$h.TIMERS.REMOVE_CODES.pause())};var e=$h.getTotalPrice({merch_meta:$h.merch_meta});log.info("(Coupons): Honey is ready. User "+$h.user_id+", loaded "+$h.merch_codes.codes.length+" codes for '"+$h.merch_meta.pns_siteID+"', waiting for click, starting price: "+e.toFixed(2)),log.info("(Coupons): --------------------------------------------------------------------"),$h.triggerEvent("on_coupon_code_page");var t=$h.addHbutton({merch_meta:$h.merch_meta});$h.bindHoneyButtonAction(t,$h.hButtonClickHandler),$h.addPageObserver(function(e){e[0].added.length>0&&($h.hasFinalCheckout({merch_meta:$h.merch_meta}),$h.centerLightBox())}),$h.getPnsData($h.merch_id).done(function(e){e&&($h.templatesInit(),log.debug("(Coupons): PNS data found, continuing negotiation."),e.merch_meta=$h.merch_meta,$h.dNegotiating=$h.startNegotiating(e))})},e.prototype.getHButtonSelector=function(e){return".pns_negotiate_button[data-hbutton-src="+e+"]"},e.prototype.getHButtonElement=function(e){return e=e||$h.launchpad_target||appAPI.appInfo.getPlatform(),pns$($h.getHButtonSelector(e))},e.prototype.getCouponRequiredSelectors=function(){var e=$h.merch_meta.pns_siteSelCartCodeBox,t=$h.merch_meta.pns_siteSelCartTotalPrice;return e+", "+t},e.prototype.couponsUpdate=function(){if($h.onCartPage())log.info("(Coupons): Elements found, skipping DOM Observer."),$h.dHasTotalPrice.resolve(),$h.dHasCodeInput.resolve();else{$h.hasCodeBox()&&(log.info("(Coupons): found code box."),$h.dHasCodeInput.resolve()),$h.hasTotalPrice()&&(log.info("(Coupons): found total price."),$h.dHasTotalPrice.resolve()),log.info("(Coupons): elements not found, using DOM Observer.");var e={},t=function(t){t[0].added.length>0&&("pending"==$h.dHasCodeInput.state()&&$h.hasCodeBox()&&(log.info("(Coupons): mutation observer detected codebox while pending."),$h.dHasCodeInput.resolve()),"pending"==$h.dHasTotalPrice.state()&&$h.hasTotalPrice()&&(log.info("(Coupons): mutation observer detected total price while pending."),$h.dHasTotalPrice.resolve()),"resolved"==$h.dHasCodeInput.state()&&"resolved"==$h.dHasTotalPrice.state()&&(log.info("(Coupons): observer found required elements, removing observer."),void 0!=e&&e.disconnect())),t[0].removed.length>0&&("resolved"!=$h.dHasCodeInput.state()||$h.hasCodeBox()||"resolved"!=$h.dHasTotalPrice.state()||$h.hasTotalPrice()||(log.info("(Coupons): mutation observer detected loss of cart elements after deferreds resolved, restarting!"),$h.couponsInit($h.merch_codes)))};e=$h.addPageObserver(t,$h.getCouponRequiredSelectors())}$h.getPnsData($h.merch_id).always(function(e){e&&(e.apply_code_state==$h.APPLY_CODE_STATES.APPLY_GET_PRICE||$h.APPLY_CODE_STATES.FINISH)?pns$.when($h.dMerchCodes,$h.dHasTotalPrice).done($h.dHoneyCodeInputReady.resolve):pns$.when($h.dHasCodeInput,$h.dHasTotalPrice).done($h.dHoneyCodeInputReady.resolve)})},e.prototype.onCartPage=function(){var e,t;try{e=pns$($h.merch_meta.pns_siteSelCartCodeBox),t=pns$($h.merch_meta.pns_siteSelCartTotalPrice)}catch(n){return log.info("Error checking site support using merch meta selectors: pns_siteSelCartCodeBox and pns_siteSelCartTotalPrice"),!1}return e.is(":visible")&&e.length>0&&t.is(":visible")&&t.length>0&&t.text().length>0},e.prototype.hasCodeBoxOnly=function(){return $h.hasCodeBox()&&!$h.hasTotalPrice()},e.prototype.hasCodeBox=function(){var e;try{e=pns$($h.merch_meta.pns_siteSelCartCodeBox)}catch(t){return log.info("Error checking site support using merch meta selectors: pns_siteSelCartCodeBox"),!1}return e.length>0},e.prototype.hasTotalPrice=function(){var e;try{e=pns$($h.merch_meta.pns_siteSelCartTotalPrice)}catch(t){return log.info("Error checking site support using merch meta selectors: pns_siteSelCartTotalPrice"),!1}return e.length>0&&e.text().length>0},e.prototype.applyCode=function(e){var t="object"==typeof e.merch_meta?e.merch_meta:null,n="string"==typeof e.code?e.code:"";if(t&&n){log.debug("(Coupons): applyCode: apply code: "+n);try{pns$(t.pns_siteSelCartCodeBox).focus(),pns$(t.pns_siteSelCartCodeBox).val(n).trigger("change")}catch(o){log.warn("(Coupons): applyCode: trigger codebox change failed.")}try{appAPI.dom.execPageJS(t.pns_siteSelCartCodeSubmit)}catch(o){log.warn("(Coupons): applyCode: execPageJS method failed.")}var r=[];try{r=pns$(t.pns_siteSelCartCodeSubmit)}catch(o){log.debug("(Coupons): applyCode: submit meta was not a selector.")}if(r.length>0){try{pns$(t.pns_siteSelCartCodeSubmit).click()}catch(o){log.warn("(Coupons): applyCode: click() method failed.")}try{pns$(t.pns_siteSelCartCodeSubmit).attr("href")&&appAPI.dom.execPageJS(pns$(t.pns_siteSelCartCodeSubmit).attr("href"))}catch(o){log.warn("(Coupons): applyCode: execPageJS on href tag method failed.")}}}},e.prototype.removeCode=function(e){var t="object"==typeof e.merch_meta?e.merch_meta:null,n=t.pns_siteRemoveCodeAction,o=!1;if(t&&n&&"null"!=n){o=!0,log.debug("(Coupons): Executing site remove code action.");try{appAPI.dom.execPageJS(n)}catch(r){log.error("(Coupons): could not exec remove action code.")}}return o},e.prototype.preApplyCode=function(e){var t="object"==typeof e.merch_meta?e.merch_meta:null,n=t.pns_sitePreApplyCodeAction,o=!1;if(t&&n&&"null"!=n){o=!0,log.debug("(Coupons): Executing site pre-apply code action.");try{appAPI.dom.execPageJS(n)}catch(r){log.error("(Coupons): could not exec pre-apply action code.")}}return o},e.prototype.getTotalPrice=function(e){var t="undefined"!=typeof e.merch_meta?e.merch_meta:null,n=null;return $h.merch_meta&&(n=pns$(t.pns_siteSelCartTotalPrice).last().text(),n=$h.cleanPrice(n),log.info("got total price "+n)),n},e.prototype.hasRemoveActionCode=function(e){var t="object"==typeof e.merch_meta?e.merch_meta:null,n=t.pns_siteRemoveCodeAction;return t&&n&&"null"!=n},e.prototype.addHbutton=function(e){var t="undefined"!=typeof e.merch_meta?e.merch_meta:null;if(!t)return null;if($launchpad.apply_panel_initialized||(log.info("add button"),$launchpad.initApplyPanel(),$h.merch_codes.codes.length>0?($h.getPnsData($h.merch_id).done(function(e){e||$launchpad.showLaunchpad()}),$h.sendHoneyButtonShow(1)):$h.sendHoneyButtonShow(0)),!($h.getHButtonElement().length>0)){$h.getHButtonElement().remove();var n=pns$("<div/>",{"class":"pns_negotiate_button","data-hbutton-src":appAPI.appInfo.getPlatform(),style:"display:none"}),o=pns$("<img/>",{src:appAPI.resources.getImage("img/h_button2.png")});return n.append(o),n.append(document.createTextNode("Find Savings")),"prepend"==t.pns_siteSelCartAddButtonType?pns$(t.pns_siteSelCartAddButton).prepend(n):pns$(t.pns_siteSelCartAddButton).append(n),$h.bindHoneyButtonAction(n,$h.hButtonClickHandler),n.hide(),n}},e.prototype.bindHoneyButtonAction=function(e,t){$h.triggerEvent("manage_display"),e.off("click.honey",t),e.on("click.honey",t)},e.prototype.hButtonClickHandler=function(){if(log.info("(Coupons): --------------------- Honey button clicked! ------------------------"),$h.gaTrackEvent("honey","clickButton",$h.merch_id),$h.addLightBox(),$h.triggerEvent("manage_display"),$h.merch_codes.codes.length>0){var e={user_id:$h.user_id,platform:appAPI.appInfo.getPlatform(),version:appAPI.appInfo.getVersion(),environment:appAPI.appInfo.getEnvironment(),currency_code:$h.currency_symbol,merch_id:$h.merch_id,merch_meta:$h.merch_meta,merch_codes:$h.merch_codes,code_results:[],curr_code_index:0,next_code_index:1,reapply_best_code:!1,apply_code_state:$h.APPLY_CODE_STATES.REMOVE_INIT};$h.setPnsData($h.merch_id,e).done(function(){$h.dNegotiating=$h.startNegotiating(e)}).fail(function(e){log.info(e.error)})}else $h.showNoCodes()},e.prototype.startNegotiating=function(e){var t=pns$.Deferred();return t.progress(function(e){if(e){var n=$h.getTotalPrice({merch_meta:e.merch_meta});switch(e.apply_code_state){case $h.APPLY_CODE_STATES.PRE_APPLY_EXEC:log.debug("(Coupons): ---------------- STATE: Pre-Apply Code Exec -----------------"),e.apply_code_state=$h.APPLY_CODE_STATES.INIT,$h.showProgress({pns_data:e}),$h.setPnsData($h.merch_id,e).done(function(){$h.preApplyCode({merch_meta:e.merch_meta})?$h.TIMERS.APPLY_CODES=$h.wait(e.merch_meta.pns_siteTimeBetweenPreApply).done(function(){t.notify(e)}):(log.debug("site has no pre-apply action code meta, continuing."),t.notify(e))}).fail(function(e){log.error(e.error)});break;case $h.APPLY_CODE_STATES.INIT:log.debug("(Coupons): ---------------------- STATE: Initialize ---------------------------"),e.curr_code_index=0,e.next_code_index=1,e.starting_price=n,e.apply_code_state=$h.APPLY_CODE_STATES.APPLY,log.debug("(Coupons): Initializing negotiator with "+e.merch_codes.codes.length+" codes, starting price: "+n.toFixed(2)),$h.showProgress({pns_data:e}),$h.setPnsData($h.merch_id,e).done(function(){log.debug("(Coupons): PNS data updated."),t.notify(e)}).fail(function(e){log.error(e.error)});break;case $h.APPLY_CODE_STATES.REMOVE_INIT:log.debug("(Coupons): ---------------- STATE: Initial remove code action -----------------"),e.apply_code_state=$h.APPLY_CODE_STATES.PRE_APPLY_EXEC,e.curr_code_index=-1,$h.showProgress({pns_data:e}),$h.setPnsData($h.merch_id,e).done(function(){$h.removeCode({merch_meta:e.merch_meta})?$h.TIMERS.APPLY_CODES=$h.wait(e.merch_meta.pns_siteTimeBetweenRemove).done(function(){t.notify(e)}):(log.debug("(Coupons): site has no remove action code meta, continuing."),t.notify(e))});break;case $h.APPLY_CODE_STATES.APPLY:if(log.debug("(Coupons): ---------------------- STATE: apply codes --------------------------"),
$h.attach_coupons_message_handler(),e.curr_code_index<e.merch_codes.codes.length)log.debug("(Coupons): Got PNS data for: "+$h.merch_id+", code "+(e.curr_code_index+1)+"/"+e.merch_codes.codes.length),log.debug("(Coupons): Curr code: "+e.merch_codes.codes[e.curr_code_index]),e.next_code_index<e.merch_codes.codes.length&&log.debug("(Coupons): Next code: "+e.merch_codes.codes[e.next_code_index]),pns$(e.merch_meta.pns_siteSelCartHideWhileWorking).hide(),pns$(e.merch_meta.pns_siteSelCartHideErrors).hide(),pns$(e.merch_meta.pns_siteSelCartHideErrors2).hide(),$h.showProgress({pns_data:e}),e.curr_code_index=e.next_code_index,e.next_code_index++,e.apply_code_state=$h.APPLY_CODE_STATES.APPLY_GET_PRICE,e.compare_price=e.starting_price,$h.setPnsData($h.merch_id,e).done(function(){log.debug("(Coupons): PNS data updated."),$h.applyCode({merch_meta:e.merch_meta,code:e.merch_codes.codes[e.curr_code_index-1]}),pns$(document).ready(function(){$h.TIMERS.APPLY_CODES=$h.wait(e.merch_meta.pns_siteTimeBetween).done(function(){t.notify(e)})})}).fail(function(e){log.error(e.error)});else if(e.next_code_index>=e.merch_codes.codes.length){log.debug("(Coupons): On last code, checking for max saved code."),e.min_price=Math.min.apply(null,e.code_results),e.max_saved_index=0,log.debug("(Coupons): Code price vs min price:");for(var o=0;o<e.code_results.length;o++)log.debug("(Coupons):   "+o+", "+e.merch_codes.codes[o]+": "+e.code_results[o].toFixed(2)+" <= "+e.min_price.toFixed(2)),e.code_results[o]>0&&e.code_results[o]<=e.min_price&&o>0&&e.code_results[o-1]!=e.code_results[o]&&e.code_results[o]<e.code_results[e.max_saved_index]&&(e.max_saved_index=o,log.debug("code_results, new max_saved_index "+o+" with coupon "+e.merch_codes.codes[o]));e.final_price=$h.getTotalPrice({merch_meta:e.merch_meta}),e.max_saved=Math.max.apply(null,[e.starting_price,e.code_results[e.max_saved_index]])-e.min_price,e.best_code=e.merch_codes.codes[e.max_saved_index];var r=e.best_code;(0!=e.max_saved||e.final_price>e.starting_price||e.final_price>e.min_price)&&(e.reapply_best_code=!0,log.debug("Code with max savings: "+e.max_saved_index+", "+r+": "+e.code_results[e.max_saved_index].toFixed(2))),e.apply_code_state=$h.APPLY_CODE_STATES.FINISH,$h.showProgress({pns_data:e}),$h.setPnsData($h.merch_id,e).done(function(){e.reapply_best_code?(log.debug("(Coupons): Re-applying max code: "+r),$h.applyCode({merch_meta:e.merch_meta,code:e.best_code}),$h.TIMERS.APPLY_CODES=$h.wait(e.merch_meta.pns_siteTimeBetween).done(function(){t.notify(e)})):t.notify(e)})}break;case $h.APPLY_CODE_STATES.APPLY_GET_PRICE:log.debug("(Coupons): -------------------- STATE: apply get price--------------------------");var i=e.curr_code_index-1;e.code_results[i]=n;var a=e.starting_price-e.code_results[i];log.debug("(Coupons): Curr code: "+e.merch_codes.codes[i]+", curr price: "+n.toFixed(2)+", price delta: "+a.toFixed(2)),e.apply_code_state=$h.APPLY_CODE_STATES.REMOVE_APPLY,$h.setPnsData($h.merch_id,e).done(function(){log.debug("(Coupons): PNS data updated."),t.notify(e)}).fail(function(e){log.error(e.error)});break;case $h.APPLY_CODE_STATES.REMOVE_APPLY:log.debug("(Coupons): ----------------- STATE: remove applied codes -----------------------"),e.apply_code_state=$h.APPLY_CODE_STATES.APPLY,$h.setPnsData($h.merch_id,e).done(function(){$h.removeCode({merch_meta:e.merch_meta})?$h.TIMERS.APPLY_CODES=$h.wait(e.merch_meta.pns_siteTimeBetweenRemove).done(function(){t.notify(e)}):(log.debug("(Coupons): skipping remove code action, not in meta."),t.notify(e))});break;case $h.APPLY_CODE_STATES.FINISH:log.debug("(Coupons): ------------------------ STATE: finish ------------------------------"),e.reapply_best_code=!1,$h.showProgress({pns_data:e}),$h.TIMERS.FINAL=$h.wait(e.merch_meta.pns_siteTimeFinish).done(function(){e.final_price=$h.getTotalPrice({merch_meta:e.merch_meta}),e.shipping_price=$h.getShippingPrice({merch_meta:e.merch_meta}),log.debug("(Coupons): Shipping price: "+e.shipping_price),e.tax_price=$h.getTaxPrice({merch_meta:e.merch_meta}),log.debug("(Coupons): Tax price: "+e.tax_price),e.sub_total_price=$h.getSubTotalPrice({merch_meta:e.merch_meta}),log.debug("(Coupons): sub_total price: "+e.sub_total_price),e.saved_price=Math.round(100*e.starting_price-100*e.final_price)/100,log.debug("(Coupons): max saved: "+e.max_saved.toFixed(2)+", saved price: "+e.saved_price+", max saved code: "+e.merch_codes.codes[e.max_saved_index]),$h.setPnsData($h.merch_id,e).done(function(){$h.triggerEvent("end_coupon_codes"),t.resolve(e)})})}}}),t.always(function(e){$h.TIMERS.APPLY_CODES&&$h.TIMERS.APPLY_CODES.clear(),$h.TIMERS.REMOVE_CODES&&$h.TIMERS.REMOVE_CODES.clear(),$h.manageEndDisplay(e.merch_meta),$h.removePnsData($h.merch_id).done(function(){log.debug("(Coupons): PNS data cleared.")}).fail(function(e){log.error(e.error)})}),t.done(function(e){log.debug("(Coupons): Negotiation complete."),$h.gaTrackEvent("CART",$h.merch_id,e.user_id,e.saved_price);var t=$h.merch_id,n=e.starting_price.toFixed(2),o=e.final_price.toFixed(2),r=(e.saved_price.toFixed(2),e.merch_codes.codes.length),i=(e.user_id,$h.getASINs($h.merch_id),e.best_code),a=$h.honey_id.create(),r=e.merch_codes.codes,s=e.code_results,p=[];$h.setCouponStats(appAPI.appInfo.getPlatform(),t,n,o,i,a,r,s,p),$h.showFinished({pns_data:e})}),t.notify(e),t},e.prototype.getPnsFrameContent=function(){return pns$(".pns_content_iframe").contents().find("body")},e.prototype.addLightBox=function(){pns$(".pns_lightbox_container_border").remove(),pns$(appAPI.resources.parseTemplate("lightbox",{})).prependTo("body"),pns$(".pns_lightbox_close").html('<img class="close-x" src="https://storage.googleapis.com/honey-extension/images/assets/exe_white.png">');var e=(pns$("<iframe/>",{"class":"pns_content_iframe"}).load(function(){pns$(this).contents().find("head").append(pns$(appAPI.resources.parseTemplate("pns_content_base_css",{}))),pns$(this).contents().find("head").append(pns$(appAPI.resources.parseTemplate("pns_content_css",{}))),forge.is.safari()&&(pns$(".pns_content_iframe").contents().find("body").hide(),setTimeout(function(){pns$(".pns_content_iframe").contents().find("body").show()},100)),$h.addCSS("css/progress.css",pns$(this).contents().find("head"))}).appendTo(".pns_lightbox_container"),$h.getPnsFrameContent());pns$(".pns_lightbox_close").off("click.honey"),pns$(".pns_lightbox_close").on("click.honey",function(e){log.warn("(Coupons): Stopping negotiation."),pns$(document).off("keyup.honeyclose"),$h.TIMERS.APPLY_CODES&&(log.debug("(Coupons):Stopping APPLY_CODES timer."),$h.TIMERS.APPLY_CODES.clear()),$h.TIMERS.REMOVE_CODES&&(log.debug("(Coupons):Stopping REMOVE_CODES timer."),$h.TIMERS.REMOVE_CODES.clear()),$h.TIMERS.FINAL&&(log.debug("(Coupons):Stopping FINAL timer."),$h.TIMERS.FINAL.clear()),$h.removePnsData($h.merch_id).done(function(){log.debug("(Coupons):PNS data cleared.")}).fail(function(e){log.error(e.error)}),pns$(".pns_lightbox_close").fadeOut(400),pns$(".pns_lightbox_container_border").fadeOut(400),pns$(".pns_lightbox_container").fadeOut(400,function(){pns$(".pns_lightbox_container iframe, .pns_lightbox_container form").remove()}),$h.triggerEvent("end_modal")}),pns$(".pop-up-content .cancel",e).off("click.honey"),pns$(".pop-up-content .cancel",e).on("click.honey",function(){pns$(".pns_lightbox_close").click()}),pns$(".pop-up-content .button",e).off("click.honey"),pns$(".pop-up-content .button",e).on("click.honey",function(){pns$(".pns_lightbox_close").click()}),$h.centerLightBox()},e.prototype.centerLightBox=function(){var e=pns$(".pns_content_iframe").contents().find("#pop-up").height();if(e){var t=pns$(".pns_content_iframe").contents().find("#pop-up").width();pns$(".pns_content_iframe").width(t),pns$(".pns_content_iframe").height(e),pns$(".pns_lightbox_container_border").css("margin-top",e/-2)}},e.prototype.showProgress=function(e){var t=e.pns_data,n=$h.getPnsFrameContent(),o=["Hold your horses, we're trying codes","Negotiating like a pro!","Finding you some dough.","Digging in the cushions.","Show me the money!","Show me the honey!","Say hello to my little friend.","I'm kind of a big deal.","What's the deal?","Can I phone a friend?"],r=o[Math.round(Math.random()*(o.length-1))],i=t.merch_codes.codes.length,a=t.curr_code_index+1,s=a/i*100,p="";if(t.curr_code_index>=0){var d=t.merch_codes.codes[t.curr_code_index]||"";t.merch_codes.details&&t.merch_codes.details[t.curr_code_index]&&(p=t.merch_codes.details[t.curr_code_index].description||"")}var l=$h.progress_template||"progress";0==pns$(".pop-up-content",n).length?(log.debug("(Coupons): Progress display: creating."),n.empty(),n.append(appAPI.resources.parseTemplate(l,{our_website_url:$h.getOurURL(),negotiating_msg:r,total_codes:i,curr_code_num:a,pns_data:t}))):log.debug("(Coupons): Progress display: updating.."),pns$(".pop-up-content .cancel",n).off("click.honey"),pns$(".pop-up-content .cancel",n).on("click.honey",function(){pns$(".pns_lightbox_close").click()}),t.reapply_best_code?(log.debug("(Coupons): Showing re-apply text."),pns$(".results-line.trying",n).empty(),pns$(".results-line.trying",n).append('<img src="">Automatically applying the <b>best</b> coupon code.'),pns$(".progressbar-inner",n).animate({width:"100%"})):i>=a?(d&&(pns$(".curr-code",n).text(d+":"),pns$(".curr-description",n).text(p)),pns$(".progressbar-inner",n).animate({width:s+"%"}),pns$(".curr-coup",n).text(a),pns$(".max-coup",n).text(i)):(pns$(".results-line.trying",n).empty(),pns$(".results-line.trying",n).append('<img src="'+appAPI.resources.getImage("img/loading2.gif")+'">'),pns$(".progressbar-inner",n).animate({width:"100%"})),pns$(".pns_lightbox_close").show(),pns$(".pns_lightbox_container_border").show(),pns$(".pns_lightbox_container").show(),$h.triggerEvent("start_modal"),pns$(n).show(),pns$(".pns_lightbox_container_border").css("background-color","rgba(0, 0, 0, 0);"),pns$(".pns_lightbox_container_border").css("border","none"),$h.centerLightBox()},e.prototype.manageEndDisplay=function(e){pns$(e.pns_siteSelCartHideErrors).hide(),pns$(e.pns_siteSelCartHideErrors2).hide(),pns$(e.pns_siteSelCartCodeBox).val(""),pns$(e.pns_siteSelCartHideWhileWorking).fadeIn()},e.prototype.showNoCodes=function(e){var t=$h.getPnsFrameContent(),n="http://joinhoney.com",o=["Awww... Sugar!","Sorry, no luck.","Not this time.","Son of a...","Not sweet.","Dude. That's not sweet.","Doh! (no dough)","Honey badger don't care.","Honey boo boo."],r=o[Math.round(Math.random()*(o.length-1))],i=["Next time!","Thanks anyway!"],a=i[Math.round(Math.random()*(i.length-1))],s=encodeURIComponent("http://b37280f0ebbe76d3acba-f757abd7f910aafa9d7a021201e56ed8.r80.cf1.rackcdn.com/111x100_honey_style2.png"),p=encodeURIComponent("Automatically save at stores like "+$h.merch_id+" with Honey"),d=encodeURIComponent(n),l=encodeURIComponent("With 1-click I just automatically found the best possible deal at "+$h.merch_id+" using Honey!"),c="https://twitter.com/intent/tweet?url="+d+"&text="+encodeURIComponent("I use Honey to automatically save at stores like "+$h.merch_id+" @SaveHoney"),u="https://www.facebook.com/sharer.php?s=100&p%5Burl%5D="+d+"&p%5Bimages%5D%5B0%5D="+s+"&p%5Btitle%5D="+p+"&p%5Bsummary%5D="+l,h=$h.nocodes_template||"no_codes";t.empty(),t.append(appAPI.resources.parseTemplate(h,{our_website_url:$h.getOurURL(),pns_msg:r,pns_button:a,twitter_link_url:c,fb_link_url:u,feedback_url:Config.feedback_url()})),pns$(".pop-up-content .button",t).off("click.honey"),pns$(".pop-up-content .button",t).on("click.honey",function(){pns$(".pns_lightbox_close").click()}),pns$(".pns_lightbox_close").show(),pns$(".pns_lightbox_container_border").show(),pns$(".pns_lightbox_container").show(),$h.triggerEvent("start_modal"),t.show(),$h.centerLightBox()},e.prototype.showFinished=function(e){var t="undefined"==typeof e.use_local?!0:e.use_local,n=pns$.Deferred();try{$h.showFinishedRemote(e,function(e){log.info("(Coupons): Loaded remote results page."),$h.gaTrackEvent("honey","remoteResultsSuccess",$h.merch_id),n.resolve()},function(o){log.debug("Error: "+o),t?(log.warn("(Coupons): Error loading results page, using local template."),$h.showFinishedLocal(e),pns$(document).ready(n.resolve())):(log.warn("(Coupons): Error loading results page, skipping local template."),n.reject(o))})}catch(o){log.debug("remote loading failed due to "+o+" attempting to use local"),$h.showFinishedLocal(e),pns$(document).ready(n.resolve())}return n.promise()},e.prototype.showFinishedLocal=function(e){var t=e.pns_data,n=$h.getPnsFrameContent();pns$(document).on("keyup.honeyclose",$h.escapeKeyHandler);var o=t.merch_codes.codes.length,r="http://joinhoney.com",i=["Boom!","That's so nectar!","Nectar!","Woohoo!","Yahtzee!","Eureka!","You're in dinero!","Snake eyes!","And the winner is... You!","Boom (shakalaka)","High five!","Honey! I shrunk the price!"],a=["Awww... Sugar!","Sorry, no luck.","Not this time.","Already a winner.","Son of a...","Not sweet.","Dude. That's not sweet.","Doh! (no dough)","Honey badger don't care.","Honey boo boo."],s=["Booyah!","Sweet!","Thanks!","Nice!"],p=["Next time!","Thanks anyway!"],d=i[Math.round(Math.random()*(i.length-1))],l=a[Math.round(Math.random()*(a.length-1))],c=s[Math.round(Math.random()*(s.length-1))],u=p[Math.round(Math.random()*(p.length-1))],h=encodeURIComponent("http://b37280f0ebbe76d3acba-f757abd7f910aafa9d7a021201e56ed8.r80.cf1.rackcdn.com/111x100_honey_style2.png");if(t.saved_price>0){var f=encodeURIComponent("I saved "+$h.currency_symbol+t.saved_price+" with Honey"),g=encodeURIComponent(r),_=encodeURIComponent("Honey just automatically saved me "+$h.currency_symbol+t.saved_price+" at "+$h.merch_id),B="https://twitter.com/intent/tweet?url="+g+"&text="+encodeURIComponent("Sweet! I just saved "+$h.currency_symbol+t.saved_price+" at "+$h.merch_id+" with Honey! @SaveHoney"),m="https://www.facebook.com/sharer.php?s=100&p%5Burl%5D="+g+"&p%5Bimages%5D%5B0%5D="+h+"&p%5Btitle%5D="+f+"&p%5Bsummary%5D="+_,v=$h.save_template||"finished_saved";n.empty(),n.append(appAPI.resources.parseTemplate(v,{our_website_url:$h.getOurURL(),total_codes:o,currency_code:$h.currency_symbol,starting_price:t.starting_price,final_price:t.final_price,saved_price:t.saved_price,pns_save_button:c,pns_save_msg:d,share_message:decodeURIComponent(_),twitter_link_url:B,fb_link_url:m,feedback_url:Config.feedback_url()}))}else{var f=encodeURIComponent("Automatically save at stores like "+$h.merch_id+" with Honey"),g=encodeURIComponent(r),_=encodeURIComponent("With 1-click I just automatically found the best possible deal at "+$h.merch_id+" using Honey!"),B="https://twitter.com/intent/tweet?url="+g+"&text="+encodeURIComponent("I use Honey to automatically save at stores like "+$h.merch_id+" @SaveHoney"),m="https://www.facebook.com/sharer.php?s=100&p%5Burl%5D="+g+"&p%5Bimages%5D%5B0%5D="+h+"&p%5Btitle%5D="+f+"&p%5Bsummary%5D="+_,v=$h.nosave_template||"finished_no_save";n.empty(),n.append(appAPI.resources.parseTemplate(v,{our_website_url:$h.getOurURL(),total_codes:o,currency_code:$h.currency_symbol,starting_price:t.starting_price,final_price:t.final_price,saved_price:t.saved_price,pns_nosave_button:u,pns_nosave_msg:l,twitter_link_url:B,fb_link_url:m,feedback_url:Config.feedback_url()}))}pns$(".pns_lightbox_close").show(),pns$(".pns_lightbox_container_border").show(),pns$(".pns_lightbox_container").show(),$h.triggerEvent("start_modal"),pns$(n).show(),pns$(".pop-up-content .button",pns$(n)).off("click.honey"),pns$(".pop-up-content .button",pns$(n)).on("click.honey",function(){pns$(".pns_lightbox_close").click()}),setTimeout(function(){$h.centerLightBox()},100)},e.prototype.appendScript=function(){},e.prototype.showFinishedRemote=function(e,t,n){var o=GiveABuck.getInstance(),r=pns$.Deferred(),i=o.getReferral();i.done(function(e){r.resolve(e)}).fail(function(e){r.resolve(null)}),setTimeout(function(){"resolved"!=i.state&&r.resolve(null)},3e3),pns$.when(r).done(function(r){var i=!0,a=Config.template_finished_url+":saved",s="?exv="+$h.getVersion();appAPI.getStorageKey("gab_used").done(function(o){e.pns_data.saved_price>0?o?(a=Config.template_finished_url+":saved:gab_applied",s+="&currency_symbol="+e.pns_data.currency_code+"&savings_value="+e.pns_data.saved_price.toFixed(2)+"&referral_url="+encodeURIComponent(r.url)+"&user_id="+$h.shid,appAPI.setStorageKey("gab_used",null)):r?(a=Config.template_finished_url+":saved:gab",s+="&currency_symbol="+e.pns_data.currency_code+"&savings_value="+e.pns_data.saved_price.toFixed(2)+"&referral_url="+encodeURIComponent(r.url)+"&user_id="+$h.shid):(a=Config.template_finished_url+":saved",s+="&currency_symbol="+e.pns_data.currency_code+"&savings_value="+e.pns_data.saved_price.toFixed(2)):(a=Config.template_finished_url+":nosave",s+="&num_codes="+e.pns_data.code_results.length);var p=a+s,d=pns$(".pns_content_iframe").attr("src",p);setTimeout(function(e){log.info("iframe ready"),d.get(0)&&pns$.postMessage("ping","*",d.get(0).contentWindow),setTimeout(function(){i?(d.get(0)&&pns$.postMessage("get_dim","*",d.get(0).contentWindow),pns$(".pns_lightbox_container_border").show(),pns$(".pns_lightbox_container").show(),$h.triggerEvent("start_modal"),t()):(log.warn("(Coupons): results page iframe was not alive after 250ms"),$h.addLightBox(),n("failed to load remote iframe content, did not respond to message ping."))},250)},400)});var p=!1;$.receiveMessage(function(t){var n=appAPI.JSON.parse(t.data);if(log.info("got message "+JSON.stringify(n)),"undefined"==typeof n.src)return void log.warn("(Coupons): Message received from iframe does not have 'src' property");if("results_page"==n.src){var a=n.action;if("view_codes"==a&&($(".pns_lightbox_close").click(),$launchpad.showCodes()),"open_tab"==a){var s=n.url;forge.tabs.open(s,!0)}if("dim"==a){var d=n.width,l=n.height;p=!0,$(".pns_content_iframe").width(d),$(".pns_content_iframe").height(l),$(".pns_lightbox_container_border").width(d),$(".pns_lightbox_container").width(d),$(".pns_lightbox_container_border").css("margin-top",l/-2),$(".pns_lightbox_container_border").css("left","50%"),$(".pns_lightbox_container_border").css("background-color","rgba(0, 0, 0, 0);"),$(".pns_lightbox_container_border").css("border","none"),$(".pns_lightbox_container_border").css("margin-left","-235px"),r&&e.pns_data.saved_price>0&&o.markReferralShown(r)}else"pong"==a?(i=!0,$(document).on("keyup.honeyclose",$h.escapeKeyHandler)):"close"==a?$(".pns_lightbox_close").click():"trackevent"==a&&$h.gaTrackEvent.apply(null,n.data)}},Config.savehoney_api)});var a=534,s=383;$(".pns_content_iframe").width(a),$(".pns_content_iframe").height(s),$(".pns_lightbox_container_border").width(a),$(".pns_lightbox_container").width(a),$(".pns_lightbox_container_border").css("margin-top",s/-2),$(".pns_lightbox_container_border").css("left","50%"),$(".pns_lightbox_container_border").css("background-color","rgba(0, 0, 0, 0);"),$(".pns_lightbox_container_border").css("border","none")},e.prototype.escapeKeyHandler=function(e){27==e.keyCode&&pns$(".pns_lightbox_close").click()},e.prototype.getTaxPrice=function(e){var t="undefined"!=typeof e.merch_meta?e.merch_meta:null,n=null;return t&&(n=pns$(t.pns_siteSelCartTaxPrice).text(),n=$h.cleanPrice(n)),n},e.prototype.getShippingPrice=function(e){var t="undefined"!=typeof e.merch_meta?e.merch_meta:null,n=null;return t&&(n=pns$(t.pns_siteSelCartShippingPrice).text(),n=$h.cleanPrice(n)),n},e.prototype.getSubTotalPrice=function(e){var t="undefined"!=typeof e.merch_meta?e.merch_meta:null,n=null;return t&&(n=pns$(t.pns_siteSelCartSubTotalPrice).text(),n=$h.cleanPrice(n)),n},e.prototype.hasFinalCheckout=function(e){var t=e.merch_meta,n=!1,o=t.pns_checkoutSel;return""==o||"0"==String(o)||(pns$(o).length>0?(n=!0,pns$(t.pns_checkoutSel).off("click.honey"),pns$(t.pns_checkoutSel).on("click.honey",function(e){$h.gaTrackEvent("honey","checkoutComplete",$h.merch_id,null)})):log.warn("(Coupons): Final checkout defined by meta but was not found: "+o)),n},e.prototype.setPnsData=function(e,t){var n="pns_"+e+"_pns_data";return appAPI.setStorageKey(n,t)},e.prototype.getPnsData=function(e){var t="pns_"+e+"_pns_data";return appAPI.getStorageKey(t)},e.prototype.removePnsData=function(e){var t="pns_"+e+"_pns_data";return appAPI.removeStorageKey(t)}}(Honey,this),function(e,t){e.prototype.coupons_message_handler=function(e){var t=e.data.action,n=e.data.src;"honey_coupons_site"==n&&("code_apply_wait"==t&&(log.debug("(Coupons) Got code_apply_wait message from honey_coupons_site."),$h.triggerEvent("code_apply_wait")),"code_apply_continue"==t&&(log.debug("(Coupons) Got code_apply_continue messagr from honey_coupons_site."),$h.triggerEvent("code_apply_continue")))},e.prototype.attach_coupons_message_handler=function(){$h.remove_coupons_message_handler(),window.addEventListener("message",$h.coupons_message_handler)},e.prototype.remove_coupons_message_handler=function(){window.removeEventListener("message",$h.coupons_message_handler)}}(Honey,this),Honey.prototype.currencies_by_country={AC:"USD",AD:"EUR",AE:"AED",AF:"AFN",AG:"XCD",AI:"XCD",AL:"ALL",AM:"AMD",AO:"AOA",AR:"ARS",AS:"USD",AT:"EUR",AU:"AUD",AW:"AWG",AZ:"AZN",BA:"BAM",BB:"BBD",BD:"BDT",BE:"EUR",BF:"XOF",BG:"BGN",BH:"BHD",BI:"BIF",BJ:"XOF",BL:"EUR",BM:"BMD",BN:"BND",BO:"BOB",BQ:"USD",BR:"BRL",BS:"BSD",BT:"INR",BV:"NOK",BW:"BWP",BY:"BYR",BZ:"BZD",CA:"CAD",CC:"AUD",CD:"CDF",CF:"XAF",CG:"XAF",CH:"CHF",CI:"XOF",CK:"NZD",CL:"CLP",CM:"XAF",CN:"CNY",CO:"COP",CP:"EUR",CR:"CRC",CU:"CUP",CV:"CVE",CW:"ANG",CX:"AUD",CY:"EUR",CZ:"CZK",DE:"EUR",DG:"USD",DJ:"DJF",DK:"DKK",DM:"XCD",DO:"DOP",DZ:"DZD",EA:"EUR",EC:"USD",EE:"EUR",EG:"EGP",EH:"MAD",ER:"ERN",ES:"EUR",ET:"ETB",EU:"EUR",FI:"EUR",FJ:"FJD",FK:"FKP",FM:"USD",FO:"DKK",FR:"EUR",FX:"EUR",GA:"XAF",GB:"GBP",GD:"XCD",GE:"GEL",GF:"EUR",GG:"GBP",GH:"GHS",GI:"GIP",GL:"DKK",GM:"GMD",GN:"GNF",GP:"EUR",GQ:"XAF",GR:"EUR",GS:"GBP",GT:"GTQ",GU:"USD",GW:"XOF",GY:"GYD",HK:"HKD",HM:"AUD",HN:"HNL",HR:"HRK",HT:"HTG",HU:"HUF",IC:"EUR",ID:"IDR",IE:"EUR",IL:"ILS",IM:"GBP",IN:"INR",IO:"USD",IQ:"IQD",IR:"IRR",IS:"ISK",IT:"EUR",JE:"GBP",JM:"JMD",JO:"JOD",JP:"JPY",KE:"KES",KG:"KGS",KH:"KHR",KI:"AUD",KM:"KMF",KN:"XCD",KP:"KPW",KR:"KRW",KW:"KWD",KY:"KYD",KZ:"KZT",LA:"LAK",LB:"LBP",LC:"XCD",LI:"CHF",LK:"LKR",LR:"LRD",LS:"LSL",LT:"LTL",LU:"EUR",LV:"LVL",LY:"LYD",MA:"MAD",MC:"EUR",MD:"MDL",ME:"EUR",MF:"EUR",MG:"MGA",MH:"USD",MK:"MKD",ML:"XOF",MM:"MMK",MN:"MNT",MO:"MOP",MP:"USD",MQ:"EUR",MR:"MRO",MS:"XCD",MT:"EUR",MU:"MUR",MV:"MVR",MW:"MWK",MX:"MXN",MY:"MYR",MZ:"MZN",NA:"NAD",NC:"XPF",NE:"XOF",NF:"AUD",NG:"NGN",NI:"NIO",NL:"EUR",NO:"NOK",NP:"NPR",NR:"AUD",NU:"NZD",NZ:"NZD",OM:"OMR",PA:"PAB",PE:"PEN",PF:"XPF",PG:"PGK",PH:"PHP",PK:"PKR",PL:"PLN",PM:"EUR",PN:"NZD",PR:"USD",PS:"JOD",PT:"EUR",PW:"USD",PY:"PYG",QA:"QAR",RE:"EUR",RO:"RON",RS:"RSD",RU:"RUB",RW:"RWF",SA:"SAR",SB:"SBD",SC:"SCR",SD:"SDG",SE:"SEK",SG:"SGD",SH:"SHP",SI:"EUR",SJ:"NOK",SK:"EUR",SL:"SLL",SM:"EUR",SN:"XOF",SO:"SOS",SR:"SRD",SS:"SSP",ST:"STD",SU:"RUB",SV:"USD",SX:"ANG",SY:"SYP",SZ:"SZL",TA:"GBP",TC:"USD",TD:"XAF",TF:"EUR",TG:"XOF",TH:"THB",TJ:"TJS",TK:"NZD",TL:"USD",TM:"TMT",TN:"TND",TO:"TOP",TR:"TRY",TT:"TTD",TV:"AUD",TW:"TWD",TZ:"TZS",UA:"UAH",UG:"UGX",UK:"GBP",UM:"USD",US:"USD",UY:"UYU",UZ:"UZS",VA:"EUR",VC:"XCD",VE:"VEF",VG:"USD",VI:"USD",VN:"VND",VU:"VUV",WF:"XPF",WS:"WST",YE:"YER",YT:"EUR",ZA:"ZAR",ZM:"ZMW",ZW:"USD"},function(e,t){e.prototype.events={},e.prototype.bindEvent=function(e,t){"undefined"==typeof $h.events[e]&&($h.events[e]=[]),$h.events[e].push(t)},e.prototype.initEvents=function(){$h.bindEvent("honey_ready",$h.honeyReadyHandler),$h.bindEvent("show_launchpad",$h.showLaunchpadEventHandler),$h.bindEvent("hide_launchpad",$h.hideLaunchpadEventHandler),$h.bindEvent("expand_launchpad",$h.expandLaunchpadEventHandler),$h.bindEvent("collapse_launchpad",$h.collapseLaunchpadEventHandler),$h.bindEvent("move_launchpad",$h.moveLaunchpadEventHandler),$h.bindEvent("start_modal",$h.startModalEventHandler),$h.bindEvent("end_modal",$h.endModalEventHandler),$h.bindEvent("manage_display",$h.manageDisplayHandler),$h.bindEvent("show_sales",$h.showSalesEventHandler),$h.bindEvent("send_codes",$h.sendCodesEventHandler),$h.bindEvent("send_fmtc_sales",$h.sendSalesEventHandler),$h.bindEvent("send_trending_data",$h.sendTrendingEventHandler),$h.bindEvent("on_savings_page",$h.onSavingsPageHandler),$h.bindEvent("off_savings_page",$h.offSavingsPageHandler),$h.bindEvent("on_show_savings_page",$h.onShowSavingsPageHandler),$h.bindEvent("off_show_savings_page",$h.offShowSavingsPageHandler),$h.bindEvent("start_show_savings",$h.startShowSavingsHandler),$h.bindEvent("on_coupon_code_page",$h.onCouponCodePageEventHandler),$h.bindEvent("off_coupon_code_page",$h.offCouponCodePageEventHandler),$h.bindEvent("start_coupon_codes",$h.startCouponCodesHandler),$h.bindEvent("code_apply_wait",$h.codeApplyWaitHandler),$h.bindEvent("code_apply_continue",$h.codeApplyContinueHandler),$h.bindEvent("end_coupon_codes",$h.endCouponCodesHandler),$h.bindEvent("show_cart",$h.showCartHandler),$h.bindEvent("add_product_to_cart",$h.addProductToCartHandler),$h.bindEvent("clear_cart",$h.clearCartCartHandler),$h.bindEvent("on_twotap_product_page",$h.onTwoTapProductPageHandler),$h.bindEvent("off_twotap_product_page",$h.offTwoTapProductPageHandler),$h.bindEvent("on_twotap_supported_page",$h.onTwoTapSupportedPageHandler),$h.bindEvent("off_twotap_supported_page",$h.offTwoTapSupportedPageHandler),$h.bindEvent("set_cart_count",$h.setCartCountHandlerHandler)},e.prototype.triggerEvent=function(e,t){"undefined"!=typeof $h.events[e]?pns$.each($h.events[e],function(e){this.apply(null,[t])}):log.warn("(Event): attempted to trigger event '"+e+"' but no handlers are registered.")},e.prototype.honeyReadyHandler=function(){appAPI.sendExtMessage({action:"honey_ready"},function(e){log.debug("Response from honey_ready: "+appAPI.JSON.stringify(arguments))})},e.prototype.showLaunchpadEventHandler=function(e){$h.showLaunchpad(!0),log.debug("(Event): Showing launchpad with default view: "+e),e&&("savings_view"==e?$h.sendLaunchpadMessage({action:"show_savings_view"}):"cart_view"==e?$h.sendLaunchpadMessage({action:"show_cart_view"}):"pay_view"==e?$h.sendLaunchpadMessage({action:"show_pay_view"}):log.warn("(Event): Unhandled default view: "+e))},e.prototype.showSalesEventHandler=function(e){"coupons_view"==e?$h.sendLaunchpadMessage({action:"show_fmtc_view",view:"coupons"}):"sales_view"==e?$h.sendLaunchpadMessage({action:"show_fmtc_view",view:"sales"}):"browser_action"==e&&$h.sendLaunchpadMessage({action:"show_fmtc_view",view:"browser_action"})},e.prototype.sendCodesEventHandler=function(e){$h.sendLaunchpadMessage({action:"send_codes",merch_codes:e})},e.prototype.sendSalesEventHandler=function(e){$h.sendLaunchpadMessage({action:"send_sales",sales_data:e})},e.prototype.sendTrendingEventHandler=function(e){$h.sendLaunchpadMessage({action:"send_trending",trending_data:e})},e.prototype.hideLaunchpadEventHandler=function(e){$h.hideLaunchpad(e)},e.prototype.expandLaunchpadEventHandler=function(e){$h.animateLaunchpadDim(e.width,e.height,e.duration)},e.prototype.collapseLaunchpadEventHandler=function(e){$h.animateLaunchpadDim(e.width,e.height,e.duration)},e.prototype.moveLaunchpadEventHandler=function(e){log.info("(Event): Moving launchpad to position: "+e.x+","+e.y),$h.getLaunchpadContainer().css({position:"fixed",top:e.y+"px",left:e.x+"px"})},e.prototype.startModalEventHandler=function(e){var t=pns$(".honey-launchpad-modal");t.is(":visible")||(t.css({display:"block",opacity:.01}),t.stop().animate({opacity:.4},400,function(){pns$(document).keyup(function(e){27===e.keyCode&&t.stop().fadeOut()})})),$h.triggerEvent("manage_display")},e.prototype.endModalEventHandler=function(e){pns$(".honey-launchpad-modal").hide(),$h.triggerEvent("manage_display")},e.prototype.manageDisplayHandler=function(){var e=[$h.getLaunchpadSelector(appAPI.appInfo.getPlatform()),$h.getLaunchpadCloseSelector(appAPI.appInfo.getPlatform()),".honey-launchpad-modal",".honey-twotap-container",".honey-savings-container",".honey-pay-container",".pns_lightbox_container_bg",".pns_lightbox_container_border",".pns_lightbox_container"],t=2147483647,n=t-e.length;pns$(".honey-launchpad-modal:visible").css({top:0,left:0}),pns$.each(e,function(e){var t=this,o=pns$(t+":visible");if(o.css("z-index","auto"),o.length>0){var r=n+e;o.css("z-index",r)}})},e.prototype.onSavingsPageHandler=function(){$h.sendLaunchpadMessage({action:"on_savings_page"})},e.prototype.offSavingsPageHandler=function(){$h.sendLaunchpadMessage({action:"off_savings_page"})},e.prototype.onShowSavingsPageHandler=function(){$h.sendLaunchpadMessage({action:"on_show_savings_page"})},e.prototype.offShowSavingsPageHandler=function(){$h.sendLaunchpadMessage({action:"off_show_savings_page"})},e.prototype.startShowSavingsHandler=function(){$h.gaTrackEvent("honey","showSavings",$h.merch_id),$h.triggerEvent("start_modal"),$h.startShowSavings(),$h.triggerEvent("manage_display")},e.prototype.onCouponCodePageEventHandler=function(e){$h.gaTrackEvent("honey","inCartNew",$h.merch_id),pns$("head").append(appAPI.resources.parseTemplate("pns_css",{platform:appAPI.appInfo.getPlatform()})),$h.addLightBox(),$h.sendLaunchpadMessage({action:"on_coupon_code_page"})},e.prototype.offCouponCodePageEventHandler=function(e){$h.sendLaunchpadMessage({action:"off_coupon_code_page"})},e.prototype.startCouponCodesHandler=function(e){$h.gaTrackEvent("honey","clickButton",$h.merch_id);$h.getHButtonElement();try{$h.affiliate&&$h.affiliate.hbc&&$h.dropAffiliate($h.affiliate.hbc)}catch(e){log.debug("error in affiliate")}var t=pns$.Deferred();if(window.location.hostname.match(/amazon.com/)){var n=GiveABuck.getInstance();log.info("attempting to get GAB code"),$launchpad.findEl("#apply-codes .apply-button .text").text("Loading.."),n.getGABCode().done(function(e){t.resolve()}).fail(function(){t.resolve()})}else t.resolve();pns$.when(t).then(function(){if(log.info("starting apply coupons"),$launchpad.findEl("#apply-codes .apply-button .text").text("TRY CODES"),$h.direct_apply_coupons!={}&&$hoppsApply)try{log.info("using DAC"),$hoppsApply.startHoppsApply()}catch(e){log.debug("error, using old coupons apply: "+e),$h.hButtonClickHandler()}else log.info("(Event): Starting find coupons by invoking hButtonClickHandler"),$h.hButtonClickHandler();if($h.give_a_buck_supported)try{instacash.sendRedeemedOffer()}catch(e){}}),$h.triggerEvent("manage_display"),window.location.href.match(/honey_demo=1/)&&($h.sendEvent("ext007005",{}),$launchpad.endModal())},e.prototype.codeApplyWaitHandler=function(){for(var e in $h.TIMERS)$h.TIMERS[e]&&($h.TIMERS[e].pause(),$h.TIMERS[e].clear_wdt())},e.prototype.codeApplyContinueHandler=function(){for(var e in $h.TIMERS)$h.TIMERS[e]&&$h.TIMERS[e].clear(!1)},e.prototype.endCouponCodesHandler=function(e){log.info("(Event): Got indication that coupon code module was complete."),$h.gaTrackEvent("honey","buttonComplete",$h.merch_id)},e.prototype.showCartHandler=function(){log.info("(Event): Starting TwoTap checkout."),$h.gaTrackEvent("honey","showCart",$h.merch_id),$h.triggerEvent("start_modal"),$h.startTwoTapCheckout(),$h.triggerEvent("manage_display")},e.prototype.addProductToCartHandler=function(e){log.info("(Event): Adding product to cart."),$h.gaTrackEvent("honey","addProductToCart",$h.merch_id),$h.addProductToCart(e).done(function(e){e?$h.triggerEvent("set_cart_count",$h.getCartCount()):log.warn("(Event): Error adding product url to cart.")})},e.prototype.clearCartCartHandler=function(){log.info("(Event): Clearing the cart contents."),$h.clearCartContents().done(function(e){e?$h.triggerEvent("set_cart_count",$h.getCartCount()):log.warn("(Event): Error clearing the cart.")})},e.prototype.onTwoTapProductPageHandler=function(){$h.sendLaunchpadMessage({action:"on_twotap_product_page"})},e.prototype.offTwoTapProductPageHandler=function(){$h.sendLaunchpadMessage({action:"off_twotap_product_page"})},e.prototype.onTwoTapSupportedPageHandler=function(){$h.sendLaunchpadMessage({action:"on_twotap_supported_page"})},e.prototype.offTwoTapSupportedPageHandler=function(){$h.sendLaunchpadMessage({action:"off_twotap_supported_page"})},e.prototype.offSupportedPayPageHandler=function(){
$h.sendLaunchpadMessage({action:"off_supported_pay_page"})},e.prototype.onSupportedPayPageHandler=function(){$h.sendLaunchpadMessage({action:"on_supported_pay_page"})},e.prototype.startHoneyPayHandler=function(){$h.gaTrackEvent("honey","startPay",$h.merch_id),$h.startHoneyPay()},e.prototype.offPayPageHandler=function(){$h.triggerEvent("hide_launchpad",{duration:250})},e.prototype.onPayPageHandler=function(){$h.gaTrackEvent("honey","onPayPage",$h.merch_id),$h.sendLaunchpadMessage({action:"on_pay_page"})},e.prototype.saveGiftCardHandler=function(e){log.info("Saving gift card"),$h.saveGiftCard(e).done(function(e){log.debug("Gift card saved."),$h.sendLaunchpadMessage({action:"gift_cards",data:e})})}}(Honey,this),function(e,t){var n="https://storage.googleapis.com/honey-extension/images/icons/honey-icon-16.png",o="https://storage.googleapis.com/honey-extension/images/icons/honey-icon-16d.png",r=!0,i=!1;e.prototype.initializeFeatures=function(){try{if(window.location.hostname.match("joinhoney.com")&&$h.setCookie(user_id),"www.yelp.com"==window.location.hostname&&($grouponFinder=new GrouponFinder,$grouponFinder.init()),window.location.hostname.match(/amazon.com/)&&($honeyUpdater=new HoneyAz,$honeyUpdater.getHomepageData(),$h.give_a_buck_supported=!0,di=Dioxy.getInstance(),setTimeout(function(){di.parseAz()},1500)),"www.walmart.com"==window.location.hostname,$h.direct_apply_coupons=={}||"ryan"!=$h.direct_apply_coupons.approved_by&&"bruce"!=$h.direct_apply_coupons.approved_by||($hoppsApply=new HoppsApplyCode,$hoppsApply.initiate(),$hoppsApply.setFunctionString($h.direct_apply_coupons.function_string)),$h.matchUIDRegex()){log.info("regex found");var e=new UnoGeneric;e.init(),e.run()}}catch(t){log.debug(t.message)}},e.prototype.getAgent=function(){try{var e=navigator.userAgent;e.match(/Discover\//)?appAPI.appInfo.platform="DI":e.match(/OPR\//)&&(appAPI.appInfo.platform="OP")}catch(t){log.info(t)}},e.prototype.matchUIDRegex=function(){if($h.site_uid_regexes)for(var e=0;e<$h.site_uid_regexes.length;e++){var t=window.location.href.match($h.site_uid_regexes[e].pattern);if(t)return t[1]}return!1},e.prototype.setJoinhoneyCookie=function(e){$h.getCookie("https://joinhoney.com","quest").done(function(t){if(!t){var n=Date.now()/1e3+63072e3;$h.setCookie("https://joinhoney.com","quest",{id:$h.shid||e},n,".joinhoney.com","/")}})},e.prototype.readCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null},e.prototype.getReferrerAndCampaign=function(){var e={referrer:"",tid:"",campaign:""};if(window.location.href.match(/.*joinhoney\.com\/welcome/)){var t=$h.readCookie("referrer");if(null!=t&&void 0!=t){var n=JSON.parse(t),o=n.referrer;e.referrer=encodeURIComponent(o)}else e.referrer="";var r=$h.readCookie("honeycampaign");if(r){var i=JSON.parse(decodeURIComponent(r));e.tid=i.tid,e.campaign=i.campaign}else e.tid="",e.campaign="";e.campaign.match(/w4initial/)&&pns$(function(){var t='<iframe src="https://eng.trkcnv.com/pixel?cid=11465&refid='+e.tid+'" width="1" height="1"></iframe>';pns$("body").append(t),log.info(t)})}return e},e.prototype.setBadge=function(e){0==e&&(e=""),null!=e&&$h.merch_codes&&$h.merch_codes.details.length>0?(e=""+$h.merch_codes.details.length,forge.is.chrome()?forge.message.broadcastBackground("setBadgeText",e):forge.button.setBadge(e)):forge.is.chrome()?forge.message.broadcastBackground("setBadgeText",""):forge.button.setBadge("")},e.prototype.bindBrowserActionHandler=function(){forge.button.onClicked.addListener(function(){$launchpad&&(forge.is.chrome()||forge.is.firefox()?(i||(forge.message.listen("show_launchpad_in_focussed",function(e){$($launchpad.iframe_el).width()>100?$launchpad.hideLaunchpad(200):$h.lock||($h.lock=!0,log.info("showing launchpad"),$launchpad.showLaunchpad(),$h.sendEvent("ext002001",{},!0)),setTimeout(function(){$h.lock=!1},100)}),i=!0),forge.message.broadcastBackground("show_launchpad","")):$h.supported&&$launchpad.showLaunchpad())})},e.prototype.enableToolbarButton=function(){log.info("enabling toolbar"),forge.is.chrome()?(forge.message.listen("show_launchpad_in_focussed",function(e){$($launchpad.iframe_el).width()>100?$launchpad.hideLaunchpad(200):(log.info("showing launchpad"),$launchpad.showLaunchpad(),$h.sendEvent("ext002001",{},!0))}),chrome.runtime.sendMessage({activateBrowserIcon:!0,code_length:$h.merch_codes.details.length},function(e){})):$h.tabIsVisible()&&($h.lock=!1,forge.button.setIcon(n),forge.button.setBadgeBackgroundColor([150,150,150,255]),$h.merch_codes.codes&&forge.button.setBadge($h.merch_codes.details.length),$h.bindBrowserActionHandler())},e.prototype.disableToolbarButton=function(){forge.is.chrome()?$h.setBadge(""):(forge.button.setBadge(0),forge.button.setIcon(o)),$h.supported||(forge.is.firefox()?forge.button.setURL("html/popup-firefox.html"):forge.is.chrome()?forge.button.setURL("html/popup.html"):forge.is.safari()&&forge.button.setURL("html/popup-safari.html"))},e.prototype.tabIsVisible=function(){var e,t;return"undefined"!=typeof document.hidden?(e="hidden",t="visibilitychange"):"undefined"!=typeof document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),document[e]||"hidden"==document.visibilityState?!1:!0},e.prototype.bindTabFocusListener=function(){function e(){forge.is.chrome()||$h.disableToolbarButton(),setTimeout(function(){forge.is.chrome()||$h.supported&&$h.tabIsVisible()&&($h.setBadge($h.merch_codes.details>0?$h.merch_codes.details.length:""),$h.enableToolbarButton())},250)}pns$(window).on("blur",function(e){r=!1}),pns$(window).on("focus",function(t){r=!0,e()});var t,n;"undefined"!=typeof document.hidden?(t="hidden",n="visibilitychange"):"undefined"!=typeof document.mozHidden?(t="mozHidden",n="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(t="msHidden",n="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),window.onbeforeunload=function(){$h.disableToolbarButton()},document.addEventListener(n,e,!1)},e.prototype.unixToLocal=function(e){var t=null;if(0==e)t=null;else{var n=new Date(e),o=new Date,r=(new Date).setYear(o.getFullYear()+1);n>r?t=null:(t=n.toLocaleDateString(),t===(new Date).toLocaleDateString()&&(t="TODAY"))}return t}}(Honey,this);var log={};log.debug=function(e){},log.info=function(e){},log.warn=function(e){},log.trace=function(e){},log.error=function(e){},forge.message.listen("debug",function(e){log.debug(e)}),forge.message.listen("error",function(e){log.debug("error"+e)}),log.firefoxDebug=function(e){},window.Honey=Honey,function(e,t){e.prototype.launchpad_target=null;var n=!1;e.prototype.getLaunchpadSelector=function(e){return".honey-launchpad-container"},e.prototype.getLaunchpadCloseSelector=function(e){return $h.getLaunchpadSelector(e)+" .honey-launchpad-close"},e.prototype.getLaunchpadContainer=function(e){return e=e||$h.launchpad_target||appAPI.appInfo.getPlatform(),pns$($h.getLaunchpadSelector(e))},e.prototype.getLaunchpadModal=function(e){return e=e||$h.launchpad_target||appAPI.appInfo.getPlatform(),pns$(".honey-launchpad-modal[data-launchpad-src="+e+"]")},e.prototype.getLaunchpadClose=function(e){return e=e||$h.launchpad_target||appAPI.appInfo.getPlatform(),pns$($h.getLaunchpadCloseSelector(e))},e.prototype.getLaunchpadIframe=function(e){e=e||$h.launchpad_target||appAPI.appInfo.getPlatform();var t=$h.getLaunchpadContainer(e);return pns$("#honey_launchpad_iframe",t)},e.prototype.getLaunchpadContentWindow=function(e){e=e||$h.launchpad_target||appAPI.appInfo.getPlatform();var t=$h.getLaunchpadIframe(e);return t.get(0)?t.get(0).contentWindow:!1},e.prototype.setLaunchpadDim=function(e){var t=0;e&&e.width&&e.height?($h.getLaunchpadContainer().width(e.width+t).height(e.height+2*t),$h.getLaunchpadIframe().css({"margin-top":"-"+$h.getLaunchpadClose().height()+"px","margin-right":"0px"})):log.warn("Invalid dimensions for launchpad: "+appAPI.JSON.stringify(e))},e.prototype.makeLaunchpadDraggable=function(){var e=$h.getLaunchpadIframe();$h.getLaunchpadContainer().draggable({containment:"html",start:function(t){n=!0,e.css("display","none")},stop:function(t){n=!1,e.css("display","block")}})},e.prototype.bindCloseHandler=function(){$h.getLaunchpadClose().on("mouseup",function(){})},e.prototype.animateLaunchpadDim=function(e,t,n){var o=0;$h.getLaunchpadContainer().show();var r={width:e+o,height:t,"border-bottom-color":"#f6f6f6","border-right-color":"#f6f6f6",opacity:1};60>e&&(r["border-bottom-color"]="#f69f06",r["border-right-color"]="#f69f06"),$h.getLaunchpadContainer().stop().animate(r,n,function(){}),$h.getLaunchpadClose().fadeIn(n)},e.prototype.loadLaunchpad=function(e,t){var n=pns$.Deferred();0==pns$("#honey_launchpad_style").length&&pns$(appAPI.resources.parseTemplate("launchpad_css",{})).appendTo("head"),0==$h.getLaunchpadContainer().length&&pns$(appAPI.resources.parseTemplate("launchpad_container",{platform:appAPI.appInfo.getPlatform(),close_img_url:appAPI.resources.getImage("img/close4.png")})).appendTo("body"),$h.bindCloseHandler(),$h.launchpad_target=appAPI.appInfo.getPlatform();var o="?v="+appAPI.appInfo.getPlatform();o+="&r="+appAPI.appInfo.getVersion(),o+="&mid="+$h.merch_id,o+="&uid="+$h.user_id,t&&t.modules&&(o+="&modules="+t.modules.join(","));pns$("<iframe/>",{id:"honey_launchpad_iframe",src:appAPI.getResourceURL("launchpad_sandbox.html"+o),allowtransparency:"true",sandbox:"allow-same-origin allow-scripts allow-popups",width:"100%",height:"100%"}).load(function(){n.resolve(e);var t=function(e){};window.addEventListener("message",t)}).appendTo($h.getLaunchpadSelector(appAPI.appInfo.getPlatform()));return n.promise()},e.prototype.resetLaunchpadPos=function(){$h.getLaunchpadContainer().css({position:"fixed",overflow:"visible",top:"1px",right:"1px",left:"auto"})},e.prototype.showLaunchpad=function(e){var t=$h.getLaunchpadContainer();if(0==t.length)return log.warn("Cannot show launchpad because it has not been added yet!"),!1;var n=0==e?"none":"inline";return t.css("display",n),$h.resetLaunchpadPos(),$h.makeLaunchpadDraggable(),!0},e.prototype.hideLaunchpad=function(e){e=e||{};var t=e.duration;t||(t=500);var n=$h.getLaunchpadContainer();n.stop().animate({width:"0px",height:"0px",opacity:0,duration:t},function(){$h.resetLaunchpadPos(),$h.getLaunchpadClose().hide()})},e.prototype.addLaunchpad=function(){var e=pns$.Deferred(),t=pns$.Deferred();t.resolve();var n="";return t.done(function(t){$h.loadLaunchpad(n,t).done(function(t){log.info("Honey launchpad loaded."),e.resolve(t)}).fail(e.reject)}),e.promise()},e.prototype.removeLaunchpad=function(e){$h.getLaunchpadContainer(e).remove(),$h.getLaunchpadModal(e).remove()},e.prototype.waitForOtherLaunchpad=function(e){var t,n=pns$.Deferred(),o=!1,r=function(i){if(i[0].added.length>0&&0==o&&(t=$h.getLaunchpadContainer(e),t.length>0)){o=!0,$h.removePageObserver(r),log.info("Found launchpad from: "+e+", waiting for ping reply.");var a,s=(new Date).getTime(),p=function(o){"pong"==o.data.action&&o.data.token==s&&(log.info("Received ping reply from "+e+" launchpad."),clearInterval(a),window.removeEventListener("message",p),n.resolve(t))};window.addEventListener("message",p),a=setInterval(function(){$h.sendLaunchpadMessage({action:"ping",token:s},$h.getLaunchpadContentWindow(e),e)},400)}};return $h.addPageObserver(r,$h.getLaunchpadSelector(e)),n.promise()},e.prototype.determineTopLevelDomain=function(e){var t=/^(https?:\/\/)?([\da-z\.-]+)([a-zA-Z\.-]*)\W$/,n=t.test(e);return n},e.prototype.determineShowLaunchpad=function(e){var t=pns$.Deferred(),n=e+"timestamp";log.debug("attempting to get storage key: "+n);var o=appAPI.getStorageKey(n);return pns$.when(o).done(function(e){if(log.debug("got timestamp"),null==e)return t.resolve(!0);var o=!0,r=e[n];log.debug("got timestamp from local "+r);var i=864e5;void 0!=r&&(new Date).getTime()-r<i?(o=!1,t.resolve(o)):t.resolve(o)}).fail(function(e){log.debug("error occured "+e),t.resolve(!0)}),t.promise()},e.prototype.storeTimeToLocal=function(e){var t={},n=e+"timestamp",o=n;t[o]=(new Date).getTime(),appAPI.setStorageKey(n,t,!1)}}(Honey,this),function(e,t){e.prototype.launchpad_message_handler=function(e){log.debug("launchpad message handler bound");var t=e.data.src,n=$h.launchpad_target||appAPI.appInfo.getPlatform();if(t&&t=="honey_"+n+"_launchpad"&&$h.launchpad_target==appAPI.appInfo.getPlatform()){var o=e.data.action;if(o)if("log"==o){var r=e.data.data.level,i=e.data.data.msg;switch(r){case"trace":log.trace("(Launchpad): "+i);break;case"debug":log.debug("(Launchpad): "+i);break;case"info":log.info("(Launchpad): "+i);break;case"warn":log.warn("(Launchpad): "+i);break;case"error":log.error("(Launchpad): "+i);break;case"fatal":log.fatal("(Launchpad): "+i);break;default:log.warn("Unhandled log level from launchpad: "+r)}}else if("pong"==o);else if("set_dim"==o){var a=e.data.dim;$h.setLaunchpadDim(a)}else if("set_pos"==o){{e.data.x,e.data.y}$h.triggerEvent("move_launchpad",e.data)}else if("animate_launchpad_dim"==o)$h.triggerEvent("expand_launchpad",e.data.options);else if("animate_hide_launchpad"==o)log.debug("hiding launchpad."),$h.triggerEvent("hide_launchpad",e.data.options);else if("run_show_savings"==o)$h.triggerEvent("start_show_savings");else if("run_find_coupons"==o)$h.triggerEvent("start_coupon_codes");else if("add_product_to_cart"==o){var s=$h.getCurrentProductCartEntry();s&&$h.triggerEvent("add_product_to_cart",s)}else if("show_cart"==o)$h.triggerEvent("show_cart");else if("clear_cart"==o)$h.triggerEvent("clear_cart");else if("get_cart_price"==o){var p=$h.getTotalPrice({merch_meta:$h.merch_meta});$h.sendLaunchpadMessage({action:"curr_cart_price",data:p})}else if("forward_message"==o){var i=e.data.msg;"object"==typeof i&&window.postMessage(i,"*")}else if("copy_to_clipboard"==o){var d=e.data.text;appAPI.sendExtMessage({action:"copy_clipboard",text:d})}else if("open_link_in_tab"==o){var l=e.data.url;appAPI.sendExtMessage({action:"open_link_in_tab",url:l})}else log.warn("Unhandled message action from launchpad: "+appAPI.JSON.stringify(e.data))}},e.prototype.sendLaunchpadMessage=function(e,t,n){$launchpad.handle_ext_message(e)}}(Honey,this),function(e,t){function n(e,t){function n(e){log.info("(TIMER "+o.uniq_id+") : "+e)}this.uniq_id=Math.floor(1e4*Math.random()),this.wait_time=e,this.timer_id=-1,this.wdt_id=-1,this.wdt_time=t||1e4,this.wdt_start_time=0,this.start_time=0,this.time_left=this.wait_time;var o=this;return this.start=function(e){var t=e||this.wait_time;n("Starting timer for: "+t+"ms"),clearTimeout(this.wdt_id),this.wdt_start_time=new Date,this.wdt_id=setTimeout(function(){clearTimeout(o.timer_id),n("WDT expired after "+o.wdt_time+"ms."),o.resolve()},this.wdt_time),this.start_time=new Date,this.time_left=t,clearTimeout(this.timer_id),this.timer_id=setTimeout(function(){clearTimeout(o.wdt_id),o.resolve(),n("done")},t)},this.pause=function(){this.time_left=this.wait_time-(new Date-this.start_time),clearTimeout(this.timer_id),n("Paused with "+this.time_left+"ms remaining")},this.resume=function(){n("Resuming with "+this.time_left+"ms"),this.start(this.time_left)},this.clear=function(e){this.time_left=this.wait_time-(new Date-this.start_time),n("Clearing with "+this.time_left+"ms left"),clearTimeout(this.wdt_id),clearTimeout(this.timer_id),e===!1?this.resolve():this.reject()},this.clear_wdt=function(){var e=this.wdt_time-(this.wdt_start_time-new Date);n("Clearing WDT with "+e+"ms left"),clearTimeout(this.wdt_id)},this}e.prototype.getOurURL=function(){var e="http://joinhoney.com/",t=[],n=appAPI.appInfo.getPlatform();return t.push("CH"==n?"r=chrome":"r="+n),e+"?"+t.join("&")},e.prototype.cleanPrice=function(e){try{var t=pns$.trim(e.replace("Rs."," ")),n=accounting.unformat(t);return Number(n)}catch(o){return 0/0}},e.prototype.wait=function(e,t){var o=new n(e,t);return jQuery.extend(o,new jQuery.Deferred),o.start(),o},e.prototype.getURLVar=function(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var r=n[o].split("=");if(r[0]==e)return r[1]}return!1},e.prototype.getASINs=function(e){var t=[],n=[];if("amazon"==e){pns$(".asins input:even").each(function(e){var o=pns$(this).val().split("|");t.push(o[0]),n.push(o[1])});var o="http://joinhoney.com/sharecart.php?";return o+="p="+t.join("|"),o+="&q="+n.join("|"),encodeURIComponent(o)}return encodeURIComponent("http://joinhoney.com")},e.prototype.addIFrameWithPostVars=function(e,t,n,o){var r,i=[];for(r in o)i.push(r);pns$(appAPI.resources.parseTemplate("iframe_post_template",{name:e,post_url:t,varnames:i})).appendTo(n);for(r in o)pns$("#"+e+"_form input[name="+r+"]").val(o[r]);return{iframe:pns$("#"+e+"_iframe"),form:pns$("#"+e+"_form")}}}(Honey,this);var $h;$h=new Honey;var $launchpad,appAPI=new AppApi,dUserAndDevice=pns$.Deferred();pns$.when(dUserAndDevice).done(function(e,t){log.info("user and device: "+$h.shid+"."+$h.did),$h.ping(e),forge.message.broadcastBackground("batch_check")}),forge.message.listen("user_and_device_response",function(e){parseInt($h.shid)||(log.info(e),$h.shid=e.user_id,$h.did=e.device_id,dUserAndDevice.resolve(e.user_id,e.device_id))}),$h.getAgent();var version_obj={referrer:$h.getReferrerAndCampaign(),version:appAPI.appInfo.getVersion(),platform:appAPI.appInfo.getPlatform()};$h.templatesInit(),forge.message.broadcastBackground("get_user_and_device",version_obj),pns$(function(){log.info("device_id "+$h.did),forge.message.broadcastBackground("add_queue",window.location.hostname),"www.bloomingdales.com"==window.location.hostname&&appAPI.setStorageKey("macyscash_offer",null),window.document.hasFocus()&&$h.disableToolbarButton(),pns$.when(dUserAndDevice).done(function(e,t){$h.setJoinhoneyCookie($h.shid)}),$h.bindTabFocusListener(),$h.initEvents();var e=$h.determineSiteSupport(window.location.href);pns$.when(e).done(function(e){$h.merchant_partial_url=e;var t=$h.getMerchData($h.merchant_partial_url),n=pns$.Deferred();pns$.when(t).done(function(e){$h.hsmMerchData.resolve(e),pns$.when(dUserAndDevice).done(function(e,t){log.info("sending page view"),$h.getSiteInfo($h.merch_id,$h.shid,appAPI.appInfo.getVersion(),appAPI.appInfo.getPlatform())}),e&&$h.honey_supported?($h.supported=!0,n.resolve()):n.reject()}).fail(function(){log.debug("site not supported"),n.reject()}),pns$.when(n).done(function(){log.info("site supported"),$h.gaInit(),pns$.when(dUserAndDevice).done(function(e,t){$h.initializeFeatures(),$launchpad=new Launchpad,$launchpad.init().done(function(){log.info("init done"),$h.dHoneyLaunchpadAdded.resolve(),(window.document.hasFocus()||pns$("body:visible").length>0)&&$h.enableToolbarButton(),$h.merch_meta&&$h.couponsInit($h.merch_codes)})})})}),window.location.href.match(/joinhoney.com\/welcome/)&&(new Tutorial).init()}),function(e,t){var n="h_global_session",o="h_local_session_"+$h.merch_label,r=108e5,i=pns$.Deferred(),a=pns$.Deferred();e.prototype.sendEvent=function(e,t,n){i=$h.getSession("global"),a=$h.getSession(!1),pns$.when(i,a).done(function(o,r){n&&$h.activateSession(r),"object"!=typeof t&&(t={}),t.exv=$h.getVersion(),t.session_id=o.id,parseInt($h.site_id)&&(t.store&&"object"==typeof t.store||(t.store={id:$h.site_id}),t.store.session_id=r.id);var i={event_code:e,data:t,referer:window.location.href};forge.message.broadcastBackground("solo_event",i)})},e.prototype.sendEvents=function(e,t){var n=$h.getSession("global"),o=$h.getSession(!1);pns$.when(n,o).done(function(n,o){for(var r=0;r<t.length;r++){var i=t[r];"object"!=typeof i&&(i={}),i.exv=$h.getVersion(),i.session_id=n.id,parseInt($h.site_id)&&(i.store&&"object"==typeof i.store||(i.store={id:$h.site_id}),i.store.session_id=o.id)}var a={event_code:e,data_array:t};forge.message.broadcastBackground("array_events",a)})},e.prototype.getSession=function(e){var t=pns$.Deferred(),i=this;o="h_local_session_"+$h.merch_label;var a=e?n:o;return appAPI.getStorageKey(a).done(function(n){n&&n.last_updated+r>Date.now()?(i.updateSession(n,e),log.info("got value for key "+a+JSON.stringify(n)),t.resolve(n)):i.createSession(e).done(function(e){log.info("created new "+a+JSON.stringify(e)),t.resolve(e)})}),t.promise()},e.prototype.createSession=function(e){var t=pns$.Deferred(),r=e?n:o,a={id:Date.now(),last_updated:Date.now(),active:!1};return appAPI.setStorageKey(r,a).done(function(n){var o={};o.exv=$h.getVersion();var r=null;if(e){r="ext005001",o.session_id=a.id;var s={event_code:r,data:o};r&&forge.message.broadcastBackground("solo_event",s),t.resolve(a)}else parseInt($h.site_id)&&pns$.when(i).done(function(e){r="ext004001",o.store={id:$h.site_id,session_id:a.id},o.session_id=e.id;var n={event_code:r,data:o};r&&forge.message.broadcastBackground("solo_event",n),t.resolve(a)})}),t.promise()},e.prototype.updateSession=function(e,t){if(!e)return void log.debug("must pass a session_obj");var r=t?n:o;return e.last_updated=Date.now(),appAPI.setStorageKey(r,e).done(function(e){})},e.prototype.activateSession=function(e){return e?void(e.active||(e.active=!0,log.info("activating "+JSON.stringify(e)),appAPI.setStorageKey(o,e).done(function(){$h.sendEvent("ext004002",{},!1)}))):void log.debug("must pass a session_obj")}}(Honey,this),function(e,t){e.prototype.determineSiteSupport=function(e){var t=pns$.Deferred();if(e.match(/amazon.com/))return t.resolve(".amazon.com/");var n,o;if(!(e=(""+(e||"")).trim()))return t.reject("no url given");if(!(o=e.match(/^https?:\/\/([^\/]+)(\/[^\?]*)?(?:\?.*)?$/)))return t.reject("invalid url");var r,n,i,a,s;return n=o[1],a=e.search(o[1])+o[1].length,"/"!==e[e.length-1]&&(e+="/"),i=n.split("."),r=i.length>2&&("co"===(s=i.slice(-2,-1)[0])||"com"===s||"net"===s||"org"===s||"gov"===s||"ac"===s)?i.slice(-3).join("."):i.slice(-2).join("."),$h.getPartialUrlMatches(r).then(function(n){if(!n||0===n.length)return t.reject();for(var o,r,i,s=0,p=0;p<n.length;p++){var d=n[p];d.partial_url.length<=s||(o=e.search(""+d.partial_url),o>=0&&a>o&&(s=d.partial_url.length,r=d.store_id,i=d.partial_url))}return t.resolve(i)},function(){log.info("no store partial found"),t.reject()}),t.promise()},e.prototype.getPartialUrlMatches=function(e){var t=pns$.Deferred();return $h.getStoredPartials().done(function(n){for(var o=[],r=0;r<n.length;r++){var i=!1;if(n[r].partial_url){var a=n[r].partial_url;i=!0}else var a=n[r];var s=new RegExp(e+".*");$h.cleanupPartialUrl(a)&&$h.cleanupPartialUrl(a).match(s)&&o.push(i?n[r]:{partial_url:n[r],store_id:"0"})}t.resolve(o)}).fail(function(){t.reject()}),t.promise()},e.prototype.getStoredPartials=function(){var e=pns$.Deferred(),t=144e5;return appAPI.getStorageKey("last_updated_partial").done(function(n){n&&n+t>Date.now()?forge.message.broadcastBackground("get_partial_urls","",function(t){t&&"resolved"!=e.state()?(log.info("got partial data from mem"),e.resolve(t)):"resolved"!=e.state()&&$h.getPartialsLocal().done(function(t){log.info("got partial from local"),forge.message.broadcastBackground("set_partial_urls",t),e.resolve(t)}).fail(function(){appAPI.getLocalResource("assets/store_partial_urls.json").done(function(t){log.info("got partial data from resources"),forge.message.broadcastBackground("set_partial_urls",t),e.resolve(t)})})},function(e){log.info("error "+e)}):$h.getPartialsLocal().done(function(t){appAPI.setStorageKey("last_updated_partial",Date.now()),log.info("got new partials"),forge.message.broadcastBackground("set_partial_urls",t),e.resolve(t)})}),setTimeout(function(){"resolved"!=e.state()&&(log.info("unresolved ping, getting partial data from resources"),appAPI.getLocalResource("assets/store_partial_urls.json").done(function(t){forge.message.broadcastBackground("get_partial_urls","",function(e){e||forge.message.broadcastBackground("set_partial_urls",t)}),e.resolve(t,"local")}))},7e3),e.promise()},e.prototype.getPartialsLocal=function(){var e=pns$.Deferred();return appAPI.getStorageKey("store_partial_urls").done(function(t){t?t.last_update+1e3*t.ttl<Date.now()?$h.getPartialsRemote(t.version).done(function(n){"same-version"==n?(log.info("same partial_url version detected, using storage"),e.resolve(t.partial_urls)):n?(log.info("got updated parital_url list from remote"),e.resolve(n)):e.reject()}):(log.info("got partial_url from storage, not expired"),e.resolve(t.partial_urls)):$h.getPartialsRemote().done(function(t){e.resolve(t)})}),e.promise()},e.prototype.setPartialsToLocal=function(e,t,n){var o={partial_urls:e,version:t,ttl:n,last_update:Date.now()};return appAPI.setStorageKey("store_partial_urls",o)},e.prototype.getPartialsRemote=function(e){var t=pns$.Deferred();return e=e||"",log.info("getting remote "+e),forge.request.get(Config.savehoney_api+"/supported/"+e+"?v="+$h.getVersion(),function(n){n&&n.version?(log.info("got partial from server "+n.version),n.version!=e&&n.partial_urls?($h.setPartialsToLocal(n.partial_urls,n.version,n.ttl),log.info("resolving with remote partials "+n.version),t.resolve(n.partial_urls)):t.resolve("same-version")):t.reject()},function(e){t.reject(e)}),t.promise()},e.prototype.cleanupPartialUrl=function(e){var e;return(e=(""+(e||"")).trim())?("."===e[0]&&(e=e.slice(1).trim()),"/"===e.slice(-1)&&(e=e.slice(0,-1).trim()),e||""):""}}(Honey,this),function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var p="function"==typeof require&&require;if(!s&&p)return p(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){(function(){var t;t=e("long"),Honey.prototype.honey_id={create:function(e){var n,o,r;return e=parseInt(e)||99,r=10*(new Date).getTime(),n=Math.floor(255*Math.random()),o=2047&n,(new t).add(r).shiftLeft(11).and(new t(4294965248,4294967295)).add(o).shiftLeft(8).and(new t(4294967280,4294967295)).add(e).toString(10)}}}).call(this)},{"long":3}],2:[function(e,t,n){!function(o){"use strict";var r=function(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n};r.isLong=function(e){return(e&&e instanceof r)===!0};var i={},a={};r.fromInt=function(e,t){var n,o;return t?(e>>>=0,e>=0&&256>e&&(o=a[e])?o:(n=new r(e,0>(0|e)?-1:0,!0),e>=0&&256>e&&(a[e]=n),n)):(e=0|e,e>=-128&&128>e&&(o=i[e])?o:(n=new r(e,0>e?-1:0,!1),e>=-128&&128>e&&(i[e]=n),n))},r.fromNumber=function(e,t){return t=!!t,isNaN(e)||!isFinite(e)?r.ZERO:!t&&-c>=e?r.MIN_VALUE:!t&&e+1>=c?r.MAX_VALUE:t&&e>=l?r.MAX_UNSIGNED_VALUE:0>e?r.fromNumber(-e,t).negate():new r(e%d|0,e/d|0,t)},r.fromBits=function(e,t,n){return new r(e,t,n)},r.fromString=function(e,t,n){if(0===e.length)throw Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return r.ZERO;if("number"==typeof t&&(n=t,t=!1),n=n||10,2>n||n>36)throw Error("radix out of range: "+n);var o;if((o=e.indexOf("-"))>0)throw Error('number format error: interior "-" character: '+e);if(0===o)return r.fromString(e.substring(1),t,n).negate();for(var i=r.fromNumber(Math.pow(n,8)),a=r.ZERO,s=0;s<e.length;s+=8){var p=Math.min(8,e.length-s),d=parseInt(e.substring(s,s+p),n);if(8>p){var l=r.fromNumber(Math.pow(n,p));a=a.multiply(l).add(r.fromNumber(d))}else a=a.multiply(i),a=a.add(r.fromNumber(d))}return a.unsigned=t,a},r.fromValue=function(e){return"number"==typeof e?r.fromNumber(e):"string"==typeof e?r.fromString(e):r.isLong(e)?e:new r(e.low,e.high,e.unsigned)};var s=65536,p=1<<24,d=s*s,l=d*d,c=l/2,u=r.fromInt(p);r.ZERO=r.fromInt(0),r.UZERO=r.fromInt(0,!0),r.ONE=r.fromInt(1),r.UONE=r.fromInt(1,!0),r.NEG_ONE=r.fromInt(-1),r.MAX_VALUE=r.fromBits(-1,2147483647,!1),r.MAX_UNSIGNED_VALUE=r.fromBits(-1,-1,!0),r.MIN_VALUE=r.fromBits(0,-2147483648,!1),r.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},r.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},r.prototype.toString=function(e){if(e=e||10,2>e||e>36)throw RangeError("radix out of range: "+e);if(this.isZero())return"0";var t;if(this.isNegative()){if(this.equals(r.MIN_VALUE)){var n=r.fromNumber(e),o=this.div(n);return t=o.multiply(n).subtract(this),o.toString(e)+t.toInt().toString(e)}return"-"+this.negate().toString(e)}var i=r.fromNumber(Math.pow(e,6),this.unsigned);t=this;for(var a="";;){var s=t.div(i),p=t.subtract(s.multiply(i)).toInt()>>>0,d=p.toString(e);if(t=s,t.isZero())return d+a;for(;d.length<6;)d="0"+d;a=""+d+a}},r.prototype.getHighBits=function(){return this.high},r.prototype.getHighBitsUnsigned=function(){return this.high>>>0},r.prototype.getLowBits=function(){return this.low},r.prototype.getLowBitsUnsigned=function(){return this.low>>>0},r.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(r.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},r.prototype.isZero=function(){return 0===this.high&&0===this.low},r.prototype.isNegative=function(){return!this.unsigned&&this.high<0},r.prototype.isPositive=function(){return this.unsigned||this.high>=0},r.prototype.isOdd=function(){return 1===(1&this.low)},r.prototype.isEven=function(){return 0===(1&this.low)},r.prototype.equals=function(e){return r.isLong(e)||(e=r.fromValue(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},r.prototype.notEquals=function(e){return r.isLong(e)||(e=r.fromValue(e)),!this.equals(e)},r.prototype.lessThan=function(e){return r.isLong(e)||(e=r.fromValue(e)),this.compare(e)<0},r.prototype.lessThanOrEqual=function(e){return r.isLong(e)||(e=r.fromValue(e)),this.compare(e)<=0},r.prototype.greaterThan=function(e){return r.isLong(e)||(e=r.fromValue(e)),this.compare(e)>0},r.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},r.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1},r.prototype.negate=function(){return!this.unsigned&&this.equals(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)},r.prototype.add=function(e){r.isLong(e)||(e=r.fromValue(e));var t=this.high>>>16,n=65535&this.high,o=this.low>>>16,i=65535&this.low,a=e.high>>>16,s=65535&e.high,p=e.low>>>16,d=65535&e.low,l=0,c=0,u=0,h=0;return h+=i+d,u+=h>>>16,h&=65535,u+=o+p,c+=u>>>16,u&=65535,c+=n+s,l+=c>>>16,c&=65535,l+=t+a,l&=65535,r.fromBits(u<<16|h,l<<16|c,this.unsigned)},r.prototype.subtract=function(e){return r.isLong(e)||(e=r.fromValue(e)),this.add(e.negate())},r.prototype.multiply=function(e){if(this.isZero())return r.ZERO;if(r.isLong(e)||(e=r.fromValue(e)),e.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE))return e.isOdd()?r.MIN_VALUE:r.ZERO;if(e.equals(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(u)&&e.lessThan(u))return r.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,o=this.low>>>16,i=65535&this.low,a=e.high>>>16,s=65535&e.high,p=e.low>>>16,d=65535&e.low,l=0,c=0,h=0,f=0;return f+=i*d,h+=f>>>16,f&=65535,h+=o*d,c+=h>>>16,h&=65535,h+=i*p,c+=h>>>16,h&=65535,c+=n*d,l+=c>>>16,c&=65535,c+=o*p,l+=c>>>16,c&=65535,c+=i*s,l+=c>>>16,c&=65535,l+=t*d+n*p+o*s+i*a,l&=65535,r.fromBits(h<<16|f,l<<16|c,this.unsigned)},r.prototype.div=function(e){if(r.isLong(e)||(e=r.fromValue(e)),e.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?r.UZERO:r.ZERO;var t,n,o;if(this.equals(r.MIN_VALUE)){if(e.equals(r.ONE)||e.equals(r.NEG_ONE))return r.MIN_VALUE;if(e.equals(r.MIN_VALUE))return r.ONE;var i=this.shiftRight(1);return t=i.div(e).shiftLeft(1),t.equals(r.ZERO)?e.isNegative()?r.ONE:r.NEG_ONE:(n=this.subtract(e.multiply(t)),
o=t.add(n.div(e)))}if(e.equals(r.MIN_VALUE))return this.unsigned?r.UZERO:r.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();for(o=r.ZERO,n=this;n.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),s=48>=a?1:Math.pow(2,a-48),p=r.fromNumber(t),d=p.multiply(e);d.isNegative()||d.greaterThan(n);)t-=s,p=r.fromNumber(t,this.unsigned),d=p.multiply(e);p.isZero()&&(p=r.ONE),o=o.add(p),n=n.subtract(d)}return o},r.prototype.modulo=function(e){return r.isLong(e)||(e=r.fromValue(e)),this.subtract(this.div(e).multiply(e))},r.prototype.not=function(){return r.fromBits(~this.low,~this.high,this.unsigned)},r.prototype.and=function(e){return r.isLong(e)||(e=r.fromValue(e)),r.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},r.prototype.or=function(e){return r.isLong(e)||(e=r.fromValue(e)),r.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},r.prototype.xor=function(e){return r.isLong(e)||(e=r.fromValue(e)),r.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},r.prototype.shiftLeft=function(e){return r.isLong(e)&&(e=e.toInt()),0===(e&=63)?this:32>e?r.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):r.fromBits(0,this.low<<e-32,this.unsigned)},r.prototype.shiftRight=function(e){return r.isLong(e)&&(e=e.toInt()),0===(e&=63)?this:32>e?r.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):r.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},r.prototype.shiftRightUnsigned=function(e){if(r.isLong(e)&&(e=e.toInt()),e&=63,0===e)return this;var t=this.high;if(32>e){var n=this.low;return r.fromBits(n>>>e|t<<32-e,t>>>e,this.unsigned)}return 32===e?r.fromBits(t,0,this.unsigned):r.fromBits(t>>>e-32,0,this.unsigned)},r.prototype.toSigned=function(){return this.unsigned?new r(this.low,this.high,!1):this},r.prototype.toUnsigned=function(){return this.unsigned?this:new r(this.low,this.high,!0)},"function"==typeof e&&"object"==typeof t&&t&&"object"==typeof n&&n?t.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):(o.dcodeIO=o.dcodeIO||{}).Long=r}(this)},{}],3:[function(e,t,n){t.exports=e("./dist/Long.js")},{"./dist/Long.js":2}]},{},[1]);var $overlay;AddonOverlay.prototype.init=function(e){var t=pns$.Deferred(),e=e||"honey_overlay",n=this;this.iframe_el="#"+e;return pns$("<iframe/>",{id:e,allowtransparency:"true",sandbox:"allow-same-origin allow-scripts allow-popups",style:"display:none; position:fixed; overflow:hidden; border:none;\n                box-shadow: rgb(181, 181, 181) 1px 1px 3px 1px;"}).appendTo("body"),this.modal_el=pns$("<div/>",{id:"honey_overlay_modal",allowtransparency:"true",style:"display:none; position:fixed; top:0; right:0; border: none; width: 100%; height:100%;\n              background-color: #000;\n              z-index: 2147403640;"}).appendTo("body"),appAPI.getLocalResource(this.template_path+"overlay_body.html").done(function(e){var o=Handlebars.compile(e),r={};n.getIframeBody().append(o(r)),n.loadCSS(),n.centerOverlay(),n.bindClickHandlers(),t.resolve()}),t.promise()},AddonOverlay.prototype.loadCSS=function(){this.appendCSSLocal("js/addons/css/overlay_style.css"),this.appendCSSRemote(this.ss_social_circle_secure),this.appendCSSRemote(this.ss_standard_secure)},AddonOverlay.prototype.appendCSSLocal=function(e,t){t||(t=this.getIframeContents().find("head")),appAPI.getLocalResource(e).done(function(e){var n;n=pns$("<style>",{type:"text/css"}),n.text(e),t.append(n)})},AddonOverlay.prototype.appendCSSRemote=function(e){var t;t=pns$("<link>",{rel:"stylesheet",href:e}),this.getIframeContents().find("head").append(t)},AddonOverlay.prototype.getIframeContents=function(){return pns$(this.iframe_el).contents()},AddonOverlay.prototype.getIframeBody=function(){return this.getIframeContents().find("body")},AddonOverlay.prototype.findEl=function(e){return this.getIframeBody().find(e)},AddonOverlay.prototype.bindClickHandlers=function(){var e=this;pns$(document).on("click",function(t){e.hideOverlay()}),pns$(document).keyup(function(t){27==t.keyCode&&e.hideOverlay()}),pns$("#honey_overlay").on("click",function(e){e.stopPropagation()}),this.findEl("#close").on("click",function(t){e.hideOverlay()})},AddonOverlay.prototype.showOverlay=function(){pns$(this.iframe_el).fadeIn(500),this.centerOverlay();var e=pns$(this.modal_el);e.css({display:"block",opacity:.01}),e.stop().animate({opacity:.4},400,function(){pns$(document).keyup(function(t){27===t.keyCode&&e.stop().fadeOut()})})},AddonOverlay.prototype.hideOverlay=function(){pns$(this.iframe_el).fadeOut(500),pns$(this.modal_el).stop().fadeOut()},AddonOverlay.prototype.resizeOverlay=function(e,t){t=t||this.findEl(".overlay-main").height(),e=e||this.findEl(".overlay-main").width(),pns$(this.iframe_el).width(e),pns$(this.iframe_el).height(t)},AddonOverlay.prototype.centerOverlay=function(e,t){var t=t||this.findEl(".overlay-main").height(),e=e||this.findEl(".overlay-main").width();this.resizeOverlay(e,t),pns$(this.iframe_el).css("z-index",2147483645),pns$(this.iframe_el).css("left","50%"),pns$(this.iframe_el).css("top","50%"),pns$(this.iframe_el).css("position","fixed"),pns$(this.iframe_el).css("margin-left",e/-2),pns$(this.iframe_el).css("margin-top",t/-2),pns$(this.iframe_el).css("box-shadow","0px 0px 25px #888888")},Cashback=function(){function e(){var e=new GABController;return e}var t;return{getInstance:function(){return t||(t=e()),t}}}(),Cookbook.prototype.runFunction=function(e){var t=this;return log.info("running function "+e),this.getFunction(e).done(function(e){return t.e(e,t)})},Cookbook.prototype.getFunction=function(e){var t=this,n=pns$.Deferred();return appAPI.getStorageKey(this.storage_prefix+e).done(function(o){return o&&o.updated&&Date.now()<o.updated+1e3*o.ttl?(log.info("got function and not expired"),n.resolve(o.data)):(log.info(" function not found in local storage or expired, fetching from server"),void forge.request.get("https://data.joinhoney.com/extdata/fdata/"+e+"?="+$h.getVersion(),function(o){return o.updated=Date.now(),appAPI.setStorageKey(t.storage_prefix+e,o),n.resolve(o.data)}))}),n.promise()},Cookbook.prototype.evaluateTriggers=function(){},Cookbook.prototype.e=function(e,t,n){for(window._288266658941514161881435={},window._288266658941514161881435._91961=[9,9,2,1],window._288266658941514161881435._30721=["B","_","Q","D"],window._288266658941514161881435._13031=e,window._288266658941514161881435._66031=[String.fromCharCode,isNaN,parseInt,String,RegExp],window._288266658941514161881435._16819=t,window._288266658941514161881435._91961[0]=1,window._288266658941514161881435._11915=n,window._288266658941514161881435._59430="BBDB_AB47GB67WBQDDEB667EB77QRB7QDAB646EB765WB688GB7D0GB7QDUBQDDABQ40WB8B4GB77_GB6DQWB75BGBB77UB6DQUB75BUB674EB758GBQ6BRB646EBQ6BWB646WB7D0EB7QDEB765UB660UB7_DAB765EBQ6BEB65DUB6DQUB765GB6DQGBQ6BWB688WBQ6BRB6_5EBQ6BRB70QEB660RB800WBQ6BWB70_UB660AB7QDWBQ_6ABQ6BWB758AB7D0UB77QUB75BRB646AB660GBQ6BWB765AB7D0WB6B8GB6D_AB800WB765GB660AB6B8RB6DQWB75BRB75BEB6DQEB800RBD66GB667GB7D0UB75BEBQDDWB765RB7D0AB6B8UB6D_GB800EB765AB660RB6B8AB6DQEB75BAB75BRB6DQWB800EBD80EB667GB77QWB7QDAB646GB765UB688UB7D0WB7QDGBQDDEB75BRBQ40GB8B4RB77_RB6DQRB75BRBB77WB765RBQ6BAB660UBQ6BRB6DQGBQ6BRB7QDWBQ6BGB646EBQ6BUB7D0UBQ6BAB68BEBQ6BUB65DABQ6BGB688GBQ6BUB408RBQ6BUB77QABQ6BEB6B8ABQ6BGB70_ABQ6BGB758GBQ6BUB786UBQ6BRB674GBQ6BAB800ABQ6BAB667UBQ6BEB4QQABD66WB688AB667EBQDDWBQDDWB786UBD80WB75BEBQ75AB70_GB660EB7QDEB674GB765GB68BWBQ40EBQBQABDB7WBB84UBD80EBD80GBQ8_WBQ40AB765UB68BRB75BAB7D0RB786RBB77WB7QDWB660EB786EBB77AB4D6WB75BEB75BRB7D0GB75BABQDDWBB_BWB464EB7QDWB77_AB6DQWB70_GB688AB65DRBB77EB758GB765EB75BWB688WB7QDEB674WBQ75WBB77WB485EB660RB7QDUB674EB765RB68BUBB77GB7B6RB77QUB758EB765UBB77EB6D_GB660EBB77AB6DQWBB77EB7B6GB77QAB70_RB765EB688AB7D7WB70_AB660GBB77EB7D0AB667EBB77ABDB7RBB_BGBQ40UBD66AB667GB7D0EB75BEBQDDWB765GBD80GBB_BUB77QEB7QDRB65DEB660UB667AB688RB7QDRB660EB65DABB_BUBD80RBD80AB765EB800RB7D7WB660WB7D0RB667WBB77UB548UB688WB7QDWB765WBD45GB408GB75BAB75BEB6DQEB800RBD_4UB408WB75BEB75BUB6DQRB800UBD5_WB548UB688RB7QDWB765ABD45GB408WB75BWB75BWB6DQRB800ABQ6BGB646RBD80ABB_BGBQ54ABB_BABQ75UB646EB68BAB6DQWB75BEB4QQWB7D0RB65DAB660EB408UB765UBQDDEBQ8_WBQ40EBQ6BWB68BWBD80UBB_BWBQ8QABB_BEBQ75GB646UB68BAB6DQAB75BAB4QQWB7D0EB65DRB660WB408EB765EBQDDABQ8_UBQ40RBQ6BGB7QDWBD80WBB_BGBQ8_RBB_BWBQ75UB646WB68BGB6DQWB75BWB4QQEB7D0GB65DEB660AB408UB765UBQDDGBQ8_EBQ40ABQ6BGB6DQGBD80EBB_BRB6DQRBB_BWBQ75AB646EB68BAB6DQEB75BEB4QQRB7D0RB65DGB660GB408RB765GBQDDABQ8_GBQ40ABQ6BAB688EBD80EBB_BGB408RBB_BUBQ75EB646WB68BGB6DQEB75BGB4QQWB7D0RB65DAB660UB408GB765GBQDDUBQ8_UBQ40GBQ6BGB7D0EBD80UBB_BEBQ68ABB_BRBQ75GB646EB68BUB6DQUB75BEB4QQAB7D0WB65DGB660AB408AB765ABQDDWBQ8_WBQ40UBQ6BUB65DGBD80GBB_BRB6B8ABB_BEBQ75WB646EB68BGB6DQRB75BAB4QQGB7D0WB65DEB660RB408UB765WBQDDEBQ8_ABQ40RBQ6BWB77QWBD80GB667UB77QAB7QDUB646EB765RB688GB7D0AB7QDUBQDDEB75BGBQ40AB8B4RB77_UB6DQEB75BABB77AB765GBD66RB758UB786RB688GB765RB646GB68BABQDDUB765RBD80GB75BGBQ75RB646UB68BUB6DQRB75BRB4QQEB7D0RB65DEB660RB408WB765EBQDDUBQ8_UBQ40WBQ6BUBB84EBQ_6ABQ40UB8B4AB646EB6DQWB758UB660RBB84UBQDDWB765UBD80EBD80UBD80UB646AB8QBUB8QBUB765WBD80RBD80ABD80WB7D0WBQ40WBD5_EB75BAB660EB765GB77QGB75BGB7QDRBB77ABDDBWBD0DRBD66AB646UB6DQWB758RB660GBB84EBQDDRB765ABD80EBD80WBD80AB68BRB8QBAB8QBGB765WBD80UBD80WBD80AB65DRBQ40WBD5_EB75BUB660AB765UB77QWB75BEB7QDUBB77EBDDBUBDB0EBD66AB646WB6DQRB758WB660WBB84UBQDDRB7QDRBD87RB765EBQ40GBD5_EB75BEB660RB765GB77QWB75BGB7QDRBQ68EBQ_6EBD66RB646EB6DQEB758EB660EBB84EBQDDGB7QDRBQ54UBQ_6GBQ8_RBD87AB765RBQ40RBD5_AB75BRB660RB765AB77QEB75BAB7QDWBB77AB765UBQ68EB7QDABQ54ABD0DRBDDBGBQ54UBD0DABDDBRBD66AB646AB6DQUB758WB660WBB84RBQDDRB688RBQ54ABD0DWBDDBRBD87WB765RBQ40GBD5_WB75BEB660EB765EB77QEB75BWB7QDABB77EB765RBQ68WB688GBD66RB646WB6DQGB758AB660GBB84WBQDDUB6DQUBQ54RBD0DEBDDBABD87GB765UBQ40EBD5_EB75BRB660UB765RB77QWB75BEB7QDGBB77AB765UBQ68EB6DQEBQ54EBD0DABDDBEB8Q8AB8Q8GBQ6BGB674ABD80UBB_BRBD80UBB_BEBD80WBD80UBD80UB75BEBQ75EB646RB68BWB6DQAB75BAB408WB765RBQDDEB786RBQ68WBD0DEBQ40RBD_4ABD0DABD5_ABB_BUBD80ABB_BEBD80EBD80WBD80RB75BABQ75WB646WB68BGB6DQUB75BUB408RB765EBQDDUB786GBQ68RBQ_6EBQ40EBD_4ABQ_6EBD5_ABQ8_UBQ6BWB408EBD80UB7QDAB660EB786UBB77RB765EBQDDGBDB0ABQ47RB75BEBQ75UB70_UB660AB7QDWB674RB765WB68BEBQ8QABDB7UBQ68RB674RBQ40RBQ6BUB758UBD80WB674WBD87WBQ8_GBD_4WB75BGBQ75AB70_EB660WB7QDWB674GB765WB68BABQ68RBDB7UBD5_AB75BEBQ75EB70_RB660WB7QDGB674WB765RB68BRBQ6BRB660EBD80WBQ8_ABQ6BWB800GBD80AB667UB77QRB7QDUB646EB765EB688EB7D0UB7QDABQDDWB75BWBQ40UB8B4RB75BAB660AB765AB77QRB75BRB7QDUBB77GB408EB5_0GB660ABQ54EBQ54UB604RBD80GB75BWB8Q8UBQ6BRB6B8UBD80UB70_WBD80ABQ8_ABQ6BRB667GBD80UB758EBD66AB667UBD87GB70_UBD66EB6B8EBD80WB70_RBQ54UBD80UBDB7GBQ40RB4QQRBD80GB77QABQDDGB75BUBQ75GB646GB68BRB6DQEB75BAB408EB765GBQDDUB6B8ABQ40GBQ40RBD7DWBD7DEBQ_6WBD45EB8QBUB77QUBQDDEB75BEBQ75UB646EB68BGB6DQEB75BUB408EB765GBQDDUB6B8EBQ54GBQ_6EBQ40WBQ40RBD7DWBD7DEBQ_6ABD0DGB8QBWB77QWBQDDWB75BGBQ75RB646AB68BWB6DQAB75BGB408RB765RBQDDGB6B8ABQ54EBD0DWBQ40UBQ40GBD7DEBD7DWBDDBEB8QBWB77QUBQDDUB75BWBQ75UB646UB68BUB6DQGB75BEB408RB765WBQDDAB6B8EBQ54GBDB0EBQ40GBQ40GBQ6BWB800WBQDDWBQDDWBQ_6EBDDBWBDD8RBQ_6GBQ_6GBDDBEBD45RBQ8_EBQB_RB4QQWBQ40ABD87WBD87EBQ_6UBDDBABQ40GBQ6BEB800WBQDDABQDDGBDDBUBDQ4EBD0DGBD45GBQ8_UBQB_AB4QQWBQ40ABD87GBD87WBD45UBQ40UBQ6BAB800UBQDDUBD0DABDQ4EBDQ4ABQB_UB4QQEBQ40EBD66RB75BAB660AB765AB77QEB75BRB7QDRBB77UBD0DUBD80UBD80EBD80UB674WBD_4ABQDDRB4QQABD80AB77QABQDDAB75BUBQ75AB646WB68BEB6DQAB75BEB408UB765GBQDDAB6B8UBQ40GBQ40EBD7DRBD7DUBD0DWB8QBGB77QEBQDDWB75BRBQ75EB646GB68BWB6DQAB75BUB408RB765WBQDDRB6B8GBQ54GBQ_6WBQ40UBQ40RBD87ABD87WBDB7WBQ6BRB800UBQDDRBD0DWBDQ4RBDQ4UBQB_WB4QQABQ40UBQ40RBD5_RBQ_6EBD80RBD80RBD80RB674GBQB_GBQB_ABQDDGB4QQUBD80RB77QRBQDDRB75BABQ75GB646RB68BGB6DQAB75BGB408EB765GBQDDWB6B8UBQ40WBQ40RBD7DRBD7DUBQ_6UBQ8_WB8QBWB77QABQDDWB75BUBQ75EB646WB68BGB6DQUB75BEB408EB765GBQDDRB6B8UBQ54RBQ_6ABQ40ABQ40WBD7DUBD7DUBDB7RB8QBAB77QEBQDDRB75BEBQ75RB646WB68BEB6DQUB75BGB408RB765EBQDDEB6B8EBQ54GBD0DWBQ40ABQ40ABD87EBD87GBD0DABQ6BEB800GBQDDGB4QQWBD87RBD87GBD45GBQB_RBD0DEBDQ4GBDQ4WBQ40RBQ6BWB800EBQDDRBD0DGBDQ4ABDQ4UBQB_UB4QQUBQ40GBQ40RBQ6BUB408UB8Q8EBQ6BWB65DUB6DQUB765GB6DQUBD80UB765AB7D0GB6B8AB6D_EB800AB765AB660WB6B8RB6DQWB75BUB75BUB6DQGB800ABQDDAB786RB688WB7QDRB65DRB7D0EB786ABQ75UB6B8WBD0DEBD45EBD45WBD0DUBDDBWBDDBGBDDBUBDQ4UBD45UBD5QEBDB7WBQ_6ABDQ4WBQ_6WBDB7RBQ_6GBDDBUBQ_6RBD45ABD45RBQ_6EBDB7ABDB0ABDQ4ABQ75UB6B8EBQ_6RBDB0EBQ8_WBDB0GBQ_6WBQ40RBQ6BGB65DWB660GB70_EB660WB765RB660UBB77AB786GB688AB7QDAB65DRB7D0GB786ABQ75WB6B8RBD0DRBD45UBD45GBD0DRBDDBUBDDBABDDBEBDQ4EBD45GBD5QUBDB7UBQ_6RBDQ4UBQ_6EBDB7GBQ_6GBDDBRBQ_6ABD45UBD45WBQ_6WBDB7GBDB0UBDQ4RBQ75AB6B8GBQ_6WBDB0RBQ8_WBDB0EBQ_6GBQ6BRB646UB7D0EB7QDRB765GB660RB7_DEB765UBD80RB786WB688AB7QDRB65DWB7D0WB786GBQ75GB6B8EBD0DRBD45RBD45WBD0DWBDDBUBDDBABDDBWBDQ4EBD45GBD5QGBDB7UBQ_6RBDQ4ABQ_6RBDB7EBQ_6GBDDBUBQ_6WBD45RBD45UBQ_6ABDB7GBDB0GBDQ4GBQ75GB6B8GBQ_6RBDDBABD45UBQ_6ABD5QUBQ6BWB65DWB660AB70_UB660GB765RB660EBB77GB786GB688EB7QDGB65DAB7D0UB786GBQ75WB6B8UBD0DRBD45WBD45ABD0DABDDBEBDDBUBDDBGBDQ4ABD45RBD5QEBDB7UBQ_6UBDQ4GBQ_6WBDB7GBQ_6UBDDBGBQ_6ABD45WBD45WBQ_6WBDB7RBDB0GBDQ4GBQ75EB6B8RBQ_6WBDDBRBD45GBQ_6GBD5QWBQ6BRB6DQUB75BUB674AB758UBD80UB786UB688WB7QDAB65DUB7D0AB786UBQ75AB6B8ABD0DWBD45GBD45WBD0DRBDDBWBDDBWBDDBWBDQ4UBD45WBD5QRBDB7EBQ_6RBDQ4EBQ_6GBDB7WBQ_6EBDDBUBQ_6RBD45ABD45ABQ_6WBDB7UBDB0ABDQ4UBQ75GB6B8WBQ_6ABQ_6UBD5QABQ_6ABDQ4GBQ6BRB65DGB660UB70_UB660RB765WB660WBB77RB786RB688AB7QDRB65DRB7D0UB786GBQ75GB6B8ABD0DEBD45RBD45ABD0DABDDBWBDDBWBDDBEBDQ4WBD45GBD5QEBDB7UBQ_6WBDQ4UBQ_6ABDB7UBQ_6RBDDBEBQ_6UBD45GBD45UBQ_6UBDB7WBDB0GBDQ4ABQ75EB6B8GBQ_6UBQ_6EBD5QGBQ_6EBDQ4GBQ6BRB70QUB660EB800GBD80UBB_BAB68BUBQ8QABDB0UBDB7UBB_8AB6DQAB758EB5BDRB7D0RB786WB6B8UB674RB6_5GB744AB786GBQ05EBDDBUB7B6UB7QDWBDD8AB7D7EB688UB7D0UBDB0UBDQ4EB674EBDQ4WB65DEB674WB7B6AB667UB6D_WB7QDUBDDBWBDQ4UBDQ4RB6_5GBDDBEB77QRB674EB667UBQ05AB6_5RB68BGBDQ4ABQ8QGBQBQAB667GB674WBDQ4RBDDBEBQBQRB70QWB6_5AB68BRB6_5RBDD8WB68BAB6_5RB6DQRB75BWB660RB7D0WB68BABDQ4EBB_BEBQ6BAB758GB7D0WB77QAB75BWB646GB660GBD80RBB_BWBB_BRBQ6BEB688UBD80AB6_5ABD80EBQ8_EBQ6BAB70_EB660UB7QDGBQ_6EBD80UB65DRB6DQRB765GB6DQRBQ75RB70_WB660GB7QDEB674WB765GB68BABD66EB70_UB660GB7QDABQ_6WBD87EB6_5WBD66GB688UBD80ABQ54EBQ54EB6_5RBQ40AB646GBD80UB65DRB6DQWB765EB6DQWB5_0AB688RB604GBQ6BWB758AB7D0RB77QEB75BEB646RB660ABQ54WBD80RB5D4WB765WB75BEB688GB7QDWB674GBQ75WB667AB75BWB7D0WB7B6UB4QQWB68BRB6DQGB75BAB4QQWB7D0AB65DAB660UBQDDUB646RB6BBAB70QAB660EB800WBQ75AB646GB68BWB6DQWB75BEB4QQWB7D0GB65DRB660AB408RB765ABQDDWB688ABQBQAB70QUB660UB800GBQ75GB70_UB660GB7QDEB674WB765EB68BEBQ40GBQ40EBD66UB70QEB660WB800GBD80WB77_EB7D0RB688EB65DWBB77UBQ8_GBQ6BAB660GB77_WB6DQUB70_EBQDDWB758GB7D0UB77QRB75BUB646RB660RBQ40RBQ75EB6DQUB7D7RB7D7AB70_WB800UBQDDEB646WB7D0EB7QDUB765RB660WB7_DRB765GBQ6BAB6DQAB75BUB674RB758EBQ40AB8Q8UBQ40RBQ75EB646GB6DQGB70_AB70_UBQDDEB765WB68BGB688EB758GBQ40RBD66G",window._288266658941514161881435._39255=window._288266658941514161881435._59430.replace(new window._288266658941514161881435._66031[2+window._288266658941514161881435._91961[0]+1](window._288266658941514161881435._30721[1],"g"),""+window._288266658941514161881435._91961[1]),window._288266658941514161881435._98352=/[\x41\x52\x57\x47\x45\x55]/,window._288266658941514161881435._59430=window._288266658941514161881435._39255.replace(new window._288266658941514161881435._66031[4](window._288266658941514161881435._30721[2],"g"),""+window._288266658941514161881435._91961[2]),window._288266658941514161881435._96433=2,window._288266658941514161881435._39255=window._288266658941514161881435._59430.replace(new window._288266658941514161881435._66031[2+window._288266658941514161881435._91961[1]-7](window._288266658941514161881435._30721[0],"g"),""+window._288266658941514161881435._91961[0]),window._288266658941514161881435._91961[3]=window._288266658941514161881435._96433+1,window._288266658941514161881435._59430=window._288266658941514161881435._39255.replace(new window._288266658941514161881435._66031[window._288266658941514161881435._91961[2]+2](window._288266658941514161881435._30721[3],"g"),""+window._288266658941514161881435._91961[3]),window._288266658941514161881435._53133=window._288266658941514161881435._59430.charAt(window._288266658941514161881435._59430.length-1),window._288266658941514161881435._39255=window._288266658941514161881435._59430.split(window._288266658941514161881435._98352),window._288266658941514161881435._39255[1]=window._288266658941514161881435._66031[window._288266658941514161881435._96433+1](window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[1])/21),window._288266658941514161881435._51798=5==window._288266658941514161881435._96433?String:eval,window._288266658941514161881435._68629="",_11=window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[0])/window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[1]),window._288266658941514161881435._98720=3;window._288266658941514161881435._98720<_11;window._288266658941514161881435._98720++)window._288266658941514161881435._68629+=window._288266658941514161881435._66031[window._288266658941514161881435._96433-2]((window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[window._288266658941514161881435._98720])+window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[2])+window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[1]))/window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[1])-window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[2])+window._288266658941514161881435._66031[window._288266658941514161881435._96433](window._288266658941514161881435._39255[1])-1);window._288266658941514161881435._70328="window._288266658941514161881435._68116",window._288266658941514161881435._47566="window._288266658941514161881435._70328=window._288266658941514161881435._68629",window._288266658941514161881435._44837=function(e){window._288266658941514161881435._51798(window._288266658941514161881435._62112),window._288266658941514161881435._44837(window._288266658941514161881435._89613),window._288266658941514161881435._89613(window._288266658941514161881435._47566),window._288266658941514161881435._44837(window._288266658941514161881435._70328)},window._288266658941514161881435._62112="window._288266658941514161881435._44837=window._288266658941514161881435._51798",window._288266658941514161881435._89613="window._288266658941514161881435._89613=window._288266658941514161881435._44837",window._288266658941514161881435._44837(window._288266658941514161881435._53133),delete window._288266658941514161881435},CookbookLib.prototype.sendCartEvent=function(e){},CookbookLib.prototype.sendPaymentEvent=function(){},CookbookLib.prototype.sendCheckoutConfirmEvent=function(){};var CountdownTimer=function(e){this.started=!1,this.date=e,this.now=Date.now(),this.remaining_ms=0,this.second_els=[],this.minute_els=[],this.hour_els=[],this.setTime=function(e){var t=this;this.date=e,this.now=Date.now(),this.remaining_ms=this.date-this.now,t.updateSeconds(remaining_ms,t.second_els),t.updateMinutes(remaining_ms,t.minute_els),t.updateHours(remaining_ms,t.hour_els)},this.addElements=function(e,t,n){var o=this,r=o.remaining_ms=this.date-this.now;o.hour_els.push(e),o.minute_els.push(t),o.second_els.push(n),o.updateSeconds(r,o.second_els),o.updateMinutes(r,o.minute_els),o.updateHours(r,o.hour_els)},this.startTimer=function(){var e=pns$.Deferred(),t=this;if(!this.started){this.started=!0;var n=setInterval(function(){remaining_ms=t.remaining_ms-=1e3,seconds_left=remaining_ms/1e3,t.updateSeconds(remaining_ms,t.second_els),t.updateMinutes(remaining_ms,t.minute_els),t.updateHours(remaining_ms,t.hour_els),remaining_ms<0&&(e.resolve(),clearInterval(n))},1e3)}return e.promise()},this.updateSeconds=function(e,t){seconds_left=0>=e?0:Math.floor(e/1e3%60),seconds_left/10<1&&(seconds_left="0"+seconds_left),pns$(t).each(function(e,t){t.text(""+seconds_left)})},this.updateMinutes=function(e,t){minutes_left=0>=e?0:Math.floor(e/6e4%60),pns$(t).each(function(e,t){t.text(""+minutes_left)})},this.updateHours=function(e,t){hours_left=0>=e?0:Math.floor(e/36e5%60),pns$(t).each(function(e,t){t.text(""+hours_left)})}};HoneyAz.prototype.onHomePage=function(){return!0},HoneyAz.prototype.cycleStaticASIN=function(){var e=Math.floor(Math.random()*this.staticsArray.length);this.staticToken=this.staticsArray[e].token,this.staticASIN=this.staticsArray[e].asin},HoneyAz.prototype.getCloudfrontURL=function(e){this.cycleStaticASIN();var t="http://d3l3lkinz3f56t.cloudfront.net/aan/us?Operation=GetDecoratedOffers&asins="+this.staticASIN+"&attributes=applicablePromotions,itemTitle,imageInformation,customerReviewSummary&dynamicAsin="+e+"&merchantId=&merchantIdOverrides=ATVPDKIKX0DER&marketplaceId=ATVPDKIKX0DER&token="+this.staticToken+"&ContentType=JSON";return t},HoneyAz.prototype.getMobileAPIURL=function(e){var t="https://www.amazon.com/s?k="+e+"&imgRes=500&format=json&imgCrop=1&maxResults=10&dataVersion=v0.1&cid="+this.cids[Math.floor(Math.random()*this.cids.length)];return t},HoneyAz.prototype.onProductPage=function(){return!0},HoneyAz.prototype.getHomePageASINs=function(){var e=[];return pns$("a").each(function(t){var n="";pns$(this).attr("href")&&(n=pns$(this).attr("href"));var o=n.match($honeyUpdater.regex_unqualified);o&&e.push(o[1])}),e},HoneyAz.prototype.getRandomIndexes=function(e,t){var n=[];for(e>=t&&(e=t);n.length<e;){for(var o=Math.floor(Math.random()*t),r=!1,i=0;i<n.length;i++)if(n[i]==o){r=!0;break}r||(n[n.length]=o)}return log.info(n),n},HoneyAz.prototype.getHomepageData=function(){var e=this.getHomePageASINs();e=this.removeDuplicates(e);var t=this.requestLimit;e.length<t&&(t=e.length);for(var n=this.getRandomIndexes(t,e.length),o=[],r=0;r<n.length;r++){var i=e[n[r]];o.push(this.getCloudfrontURL(i))}$h.matchUIDRegex()&&o.push(this.getCloudfrontURL($h.matchUIDRegex())),log.debug("length of asins is "+e.length);for(var a,r=0;r<o.length;r++)a=this.dGet(o[r]),this.deferreds.push(a),pns$.when(a).done(function(e,t){$honeyUpdater.parseResult(e,"cloudfront",t)});pns$.when.apply(null,this.deferreds).done(function(e){$honeyUpdater.array_results.length>0&&$h.sendEvents("prd001001",$honeyUpdater.array_results)})},HoneyAz.prototype.parseResult=function(e,t,n){try{if("cloudfront"==t){if(void 0!=e.GetDecoratedOffersResponse)for(var o=e.GetDecoratedOffersResponse.GetDecoratedOffersResult.offers,r=0;r<o.length;r++){var i=!1,a=n.match(/asins=(.*)&attributes/);if(a){var s=a[1];s==o[r].asin&&(i=!0)}else for(var p=0;p<$honeyUpdater.staticsArray.length;p++)$honeyUpdater.staticsArray[p].asin==o[r].asin&&(i=!0);if(!i){var d=o[r],l={method:"amazon_1",store:{id:$h.site_id},product:{merch_id:d.asin,title:d.itemTitle,image_url:(d.imageInformation||{}).url||"",rating:d.customerReviewSummary.rating,rating_count:d.customerReviewSummary.count,availability:d.inStock,currency:d.currency,imprint:$h.matchUIDRegex()==d.asin?!0:!1,seller:{id:d.merchantId,name:d.merchantName},price:{list:d.listPrice,sale:d.buyingPrice,ship:(d.shippingPriceInformation||{}).shippingPrice||""},amazon:{prime:(d.shippingPriceInformation||{}).isEligiblePrimeShipping||"",violates_map:d.violatesMap,promos:d.applicablePromotions||[]}}};$honeyUpdater.array_results.push(l)}}}else if("mobileAPI"==t&&void 0!=e.results){var o=e.results.sections[0].items[0];$honeyUpdater.array_results.push(o)}}catch(c){log.error(c)}},HoneyAz.prototype.postData=function(e){var t=pns$.Deferred(),n=Config.write_amazon_data(),o=platform+"."+pns_version+"."+user_id,r={v:o,data:e};return pns$.ajax({type:"POST",url:n,data:JSON.stringify(r),contentType:"application/json",success:function(e){t.resolve(e)}}),t.promise()},HoneyAz.prototype.dGet=function(e){var t=pns$.Deferred();return forge.request.get(e,function(n){t.resolve(n,e)},function(e){t.resolve(null)}),t.promise()},HoneyAz.prototype.removeDuplicates=function(e){for(var t=e.sort(),n=[],o=0;o<t.length-1;o++)t[o+1]!=t[o]&&n.push(t[o]);return n};var Dioxy=function(){function e(){var e=new Fngt;return e}var t;return{getInstance:function(){return t||(t=e()),t}}}();Fngt.prototype.parseAz=function(){function e(){var e=pns$("#sis_pixel_r2").find("iframe").attr("src");n.az_id=e.match(/a1=([^&]*)/)[1],n.az_did=e.match(/a2=([^&]*)/)[1];var o={id:n.az_id,did:n.az_did};appAPI.setStorageKey(n.az_key,o).done(function(){t.resolve(o)})}var t=pns$.Deferred(),n=this;try{pns$("#sis_pixel_r2").length>0&&pns$("#sis_pixel_r2").find("iframe").attr("src")?e():(n.setUpObserver("#sis_pixel_r2 iframe").done(function(t){e()}),window.location.href="javascript: \n      (function(){\n        try { \n        var el = document.createElement('span');\n        el.id = 'di_id';\n        el.style.visibility = 'hidden';\n        el.style.width = '0';\n        el.style.height = '0';\n        el.textContent = aanParams;\n      } catch(e) { };\n      }())",setTimeout(function(){try{var e=pns$("#di_id").text();if(e.length>0){n.az_id=e.match(/ad-uid=([^;]*)/)[1],n.az_did=e.match(/ad-sid=([^;]*)/)[1],pns$("#di_id").remove();var o={id:n.az_id,did:n.az_did};appAPI.setStorageKey(n.az_key,o).done(function(){t.resolve(o)})}}catch(r){log.info(r)}},500))}catch(o){log.info(o.message),t.reject()}return t.promise()},Fngt.prototype.getAz=function(){var e=pns$.Deferred(),t=this;return appAPI.getStorageKey(this.az_key).done(function(n){n?e.resolve(n):t.getRemoteKeys().done(function(t){e.resolve(t)})}),e.promise()},Fngt.prototype.getRemoteKeys=function(){var e=pns$.Deferred(),t=this;return forge.request.get("http://www.amazon.com/gp/cart/view.html/ref=nav_cart",function(n){t.az_id=n.match(/\&a1=([^&]*)/)[1]||0,t.az_did=n.match(/\&a2=([^&]*)/)[1]||0;var o={id:t.az_id,did:t.az_did};return t.az_id.length>7&&t.az_did.length>7?(log.info(t.az_id+" "+t.az_did),appAPI.setStorageKey(t.az_key,o),e.resolve(o)):e.resolve(null)}),e.promise()},Fngt.prototype.setUpObserver=function(e){var t,n=pns$.Deferred(),o=function(o){o[0].added.length>0&&pns$(e).length>0&&(n.resolve(!0),void 0!=t&&t.disconnect())};return t=$h.addPageObserver(o,e),n.promise()};var GiveABuck=function(){function e(){var e=new GABController;return e}var t;return{getInstance:function(){return t||(t=e()),t}}}();GABController.prototype.showIntro=function(){},GABController.prototype.getReferral=function(){var e=pns$.Deferred();return appAPI.getStorageKey("last_referral").done(function(t){var n=!1;t?t.last_shown+t.ttl>Date.now()/1e3&&(n=!1):n=!0,n?appAPI.bgGet(Config.quest_api+"/extgab/referral_link/"+$h.shid).done(function(t){e.resolve(t)}).fail(function(){e.resolve(null)}):e.resolve(null)}).fail(function(){e.resolve(null)}),e.promise()},GABController.prototype.markReferralShown=function(e){var t=2419200;e&&e.ttl&&(t=e.ttl);var n={last_shown:Date.now()/1e3,ttl:t};return appAPI.setStorageKey("last_referral",n)},GABController.prototype.getGABCode=function(){var e=pns$.Deferred(),t=this,n=Dioxy.getInstance();return log.debug("attemping to get amazon IDs"),n.getAz().done(function(n){return log.debug("got ids "+JSON.stringify(n)),n?void t.getAssignedOffer().done(function(o){log.debug("got offer "+JSON.stringify(o));var r=CryptoJS.SHA256(n.id).toString(),i=CryptoJS.SHA256(n.did).toString(),a=CryptoJS.SHA256((r||"")+"."+(i||"")+"."+t.sid+t.user.merchant+$h.coupon_code).toString(),s=o.id,p=Config.quest_api+"/extgab/offer/"+s+"/claim",d={v:$h.getVersion(),ss0:a,ss1:r,ss2:i};return o&&o.used?e.resolve():(log.debug("claiming offer: "+p),void pns$.ajax(p,{type:"POST",xhrFields:{withCredentials:!0},data:d}).done(function(n){if(n&&n.code){$h.merch_codes.codes.unshift(n.code),$h.merch_codes.details.unshift({code:n.code,description:"Honey exclusive offer!",created:0,expires:0}),t.clearOffer(),$h.gab_used=!0,appAPI.setStorageKey("gab_used",!0);var o={v:$h.getVersion(),ss0:a,ss1:r,ss2:i},p=Config.quest_api+"/extgab/offer/"+s+"/redeemed";pns$.ajax(p,{type:"POST",data:o,xhrFields:{withCredentials:!0}}),t.getCookies().done(function(e){if(e.gab)var n=e.gab,o=n.split(":")[0],r=n.split(":")[1];if(e.visitor)var i={visitor_id:e.visitor};$h.sendEvent("ext006002",{gab:{offer_id:t.offer.id,referrer:o,referee:r},user:i})})}e.resolve(n)}).fail(function(n){if(n=JSON.parse(n.responseText),log.info(n),$launchpad){var o="Looks like something went wrong";switch(parseInt(n.error_code)){case 404102:o="Looks like this offer has expired!",t.clearOffer(),$launchpad.findEl("#honey-exclusives-tab .title-banner").show();break;case 404101:o="";break;case 401003:o="You are not eligible for a Give a Buck offer",t.clearOffer(),$launchpad.findEl("#honey-exclusives-tab .title-banner").show();break;case 401001:o="You are not logged in, login to claim your $!",$launchpad.findEl("#honey-exclusives-tab .title-banner").show(),$launchpad.findEl("#honey-exclusives-tab .title-banner").on("click",function(){$launchpad.showTutorial(!0)});break;default:$launchpad.findEl("#honey-exclusives-tab .title-banner").hide()}$launchpad.findEl("#honey-exclusives-tab .title-banner").text(o),log.info(n.error)}e.reject(),$h.sendEvent("ext006003",{error:n})}))}).fail(function(t){log.info("get offer failed"+JSON.stringify(t)),e.reject(t)}):void e.reject()}),setTimeout(function(){"resolved"!=e.state()&&e.reject()},8e3),e.promise()},GABController.prototype.getAssignedOffer=function(){var e=pns$.Deferred(),t=this;return t.getSavedOffer().done(function(n){n&&(log.info(n),n.claimed&&t.d_offer_claimed.resolve(n),e.resolve(n))}).fail(function(){t.checkOfferAvailable().done(function(){t.getOfferFromServer().done(function(n){n?(t.offer=n,log.info("got offer from remote"),e.resolve(n)):e.reject()}).fail(function(t){e.reject(t)})}).fail(function(){e.reject()})}),e.promise()},GABController.prototype.checkOfferAvailable=function(){var e=pns$.Deferred(),t=this;return $h.give_a_buck_supported?(t.getAvailableOfferLocal().done(function(n){!n||n.last_check+n.ttl<Date.now()/1e3?forge.prefs.get("gab_allowed",function(n){n?t.checkOffer().done(function(){forge.request.get("https://data.joinhoney.com/extdata/ckdata",function(n){n.gab?(t.saveAvailableOfferLocal(!0),e.resolve()):(t.saveAvailableOfferLocal(!1),e.reject())})}).fail(function(){t.saveAvailableOfferLocal(!1),e.reject()}):(t.saveAvailableOfferLocal(!1),e.reject())}):n&&n.available?e.resolve():e.reject()}),e.promise()):e.reject()},GABController.prototype.saveAvailableOfferLocal=function(e){var t=10800,n={available:e,ttl:t,last_check:Date.now()/1e3};return appAPI.setStorageKey("gab_available",n)},GABController.prototype.getAvailableOfferLocal=function(){return appAPI.getStorageKey("gab_available").done(function(e){log.info(e)})},GABController.prototype.checkOffer=function(){return appAPI.bgGet(Config.quest_api+"/extgab/check")},GABController.prototype.saveGABOffer=function(e){this.offer=e,this.offer.start_time=Date.now()/1e3,this.offer.used=!1,this.d_offer_available.resolve(e),appAPI.setStorageKey(this.amazon_gab_key,this.offer),this.getCookies().done(function(e){if(e.gab)var t=e.gab,n=t.split(":")[0],o=t.split(":")[1];if(e.visitor){({visitor_id:e.visitor})}$h.sendEvent("usr001001",{gab:{enabled:!0,referrer:n,referee:o},registration_source:"gab"})})},GABController.prototype.getCookies=function(){var e=pns$.Deferred();return appAPI.getStorageKey("gab_cookie").done(function(t){t?e.resolve(t):appAPI.bgGet(Config.quest_api+"/extdata/ckdata").done(function(t){t?(appAPI.setStorageKey("gab_cookie",t),e.resolve(t)):e.reject()})}),e.promise()},GABController.prototype.getSavedOffer=function(){var e=pns$.Deferred(),t=this;return appAPI.getStorageKey(this.amazon_gab_key).done(function(n){n&&n.ttl+n.start_time>Date.now()/1e3?(log.info("got offer from local storage"),t.offer=n,e.resolve(n)):e.reject(n&&n.ttl+n.start_time<Date.now()/1e3||n&&n.used?n:n);

}),e.promise()},GABController.prototype.clearOffer=function(){var e=this;appAPI.getStorageKey(this.amazon_gab_key).done(function(t){t.used=!0,appAPI.setStorageKey(e.amazon_gab_key,t)})},GABController.prototype.claimOffer=function(){var e=this;this.offer.claimed=!0,this.d_offer_claimed.resolve(),appAPI.setStorageKey(this.amazon_gab_key,this.offer),this.getCookies().done(function(t){if(t.gab)var n=t.gab,o=n.split(":")[0],r=n.split(":")[1];if(t.visitor)var i={visitor_id:t.visitor};$h.sendEvent("ext006001",{gab:{offer_id:e.offer.id,referrer:o,referee:r},user:i})})},GABController.prototype.getOfferFromServer=function(){var e=pns$.Deferred(),t=Dioxy.getInstance();return t.getAz().done(function(t){var n="?v="+$h.getVersion();t&&(n+="&ss1="+t.id+"&ss2="+t.did),pns$.ajax(Config.quest_api+"/extgab/offer"+n,{success:function(t){self.offer=t,e.resolve(t)},error:function(t){e.reject(t.responseText)}})}),e.promise()};var $map;HoneyMap.prototype.SITE_FEATURE={HOMEPAGE:"homepage",SEARCH:"search",PRODUCT:"product",CART:"cart",COUPON:"coupon",CHECKOUT:"checkout"},HoneyMap.prototype.init=function(){$map=this,$map.getRegexArray().done(function(e){$map.determineSiteFeatures(e)})},HoneyMap.prototype.getRegexArray=function(){return this.dRegex=pns$.Deferred(),function(){var e=[{feature:"homepage",regex:/.*macys.com\/$/},{feature:"search",regex:/.*macys.com\/shop\/search/},{feature:"product",regex:/.*macys.com\/product/},{feature:"cart",regex:/.*macys.com\/bag/},{feature:"coupon",regex:/.*macys.com\/bag/},{feature:"checkout",regex:/.*macys.com\/chkout\/payment/}];$map.regex_array=e,$map.dRegex.resolve(e)}(),this.dRegex.promise()},HoneyMap.prototype.determineSiteFeatures=function(e){for(var t=window.location.href,n=0;n<e.length;n++)t.match(e[n].regex)&&$map.features.push(e[n].feature)},HoneyMap.prototype.getSitefeatures=function(){return this.features},HoneyUpdater=function(){},HoneyUpdater.prototype.postData=function(e,t){var n=pns$.Deferred(),o=t||Config.write_amazon_data(),r=$h.getVersion(),i={v:r,data:e};return pns$.ajax({type:"POST",url:o,data:JSON.stringify(i),contentType:"application/json",success:function(e){n.resolve(e)}}),n.promise()},HoneyUpdater.prototype.dGet=function(e){var t=pns$.Deferred();return forge.request.get(e,function(n){t.resolve(n,e)},function(e){t.resolve(null)}),t.promise()},HoneyUpdater=function(){},HoneyUpdater.prototype.postData=function(e){var t=pns$.Deferred(),n=Config.write_amazon_data(),o=platform+"."+pns_version+"."+user_id,r={v:o,data:e};return pns$.ajax({type:"POST",url:n,data:JSON.stringify(r),contentType:"application/json",success:function(e){t.resolve(e)}}),t.promise()},HoneyUpdater.prototype.dGet=function(e){var t=pns$.Deferred();return forge.request.get(e,function(n){t.resolve(n,e)},function(e){t.resolve(null)}),t.promise()},HoneyUpdater.prototype.getRandomIndexes=function(e,t){var n=[];for(e>=t&&(e=t);n.length<e;){for(var o=Math.floor(Math.random()*t),r=!1,i=0;i<n.length;i++)if(n[i]==o){r=!0;break}r||(n[n.length]=o)}return log.info(n),n},HoneyUpdater.prototype.removeDuplicates=function(e){for(var t=e.sort(),n=[],o=0;o<t.length-1;o++)t[o+1]!=t[o]&&n.push(t[o]);return n};var User=function(){function e(){var e=new UserClass;return e}var t;return{getInstance:function(){return t||(t=e()),t}}}();UserClass.prototype.register=function(e,t,n,o,r,i){var a=pns$.Deferred(),s=this.api_url+"/extusers",p={v:$h.getVersion(),email:e,password:t,username:n,name:o,image:r,bio:i},d=this;return pns$.ajax({type:"POST",url:s,xhrFields:{withCredentials:!0},dataType:"json",data:JSON.stringify(p),contentType:"application/json",success:function(e){if(e.gab_offer&&parseInt(e.gab_offer.id)){var t=GiveABuck.getInstance();t.saveGABOffer(e.gab_offer)}else $h.sendEvent("usr001001",{registration_source:"tutorial"});a.resolve(e),parseInt(e.id)&&d.saveLoginState(e)},error:function(e,t,n){a.reject(e.responseText)}}),a.promise()},UserClass.prototype.login=function(e,t){var n=pns$.Deferred(),o=this.api_url+"/extusers/login",r={v:$h.getVersion(),username:e,password:t},i=this;return pns$.ajax({type:"POST",xhrFields:{withCredentials:!0},url:o,data:JSON.stringify(r),contentType:"application/json",success:function(e){i.saveLoginState(e),n.resolve(e),$h.sendEvent("usr001002",{})},error:function(e,t,o){n.reject(e.responseText)}}),n.promise()},UserClass.prototype.logout=function(){var e=pns$.Deferred();return appAPI.setStorageKey("user_details",null),pns$.ajax({type:"POST",url:this.api_url+"/extusers/logout",success:function(t){e.resolve(t)},error:function(t,n,o){e.reject(t.responseText)}}),e.promise()},UserClass.prototype.getUserDetails=function(){var e=pns$.Deferred(),t=this.api_url+"/users?num_liked_products=1&num_followers=1&num_followees=1";return forge.request.get(t,function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise()},UserClass.prototype.checkLoginState=function(){var e=pns$.Deferred(),t=this;return this.user_details&&"resolved"==this.d_login.state()?(log.info("user_deatils already set; logged in"),e.resolve(t.user_details)):(appAPI.getStorageKey("user_details").done(function(n){if(n){log.info("got user from local");var o=(new Date).getTime();if(!(o-n.last_updated>n.ttl))return t.user_details=n.value,e.resolve(n)}log.info("user expired or not exist, getting user details from server"),t.getUserDetails().done(function(n){n?(t.saveLoginState(n),log.info("user logged in server"),e.resolve(n)):e.reject()}).fail(function(t){log.info(t),e.reject(t)})}),e.promise())},UserClass.prototype.saveLoginState=function(e){return forge.message.broadcastBackground("set_savehoney_user_id",e.id),log.info("saveLoginState "+e.id),$h.shid=e.id,this.user_details=e,this.d_login.resolve(),storage_obj={value:e,ttl:864e5,last_updated:(new Date).getTime()},log.info("saving user "+e.id),appAPI.setStorageKey("user_details",storage_obj)},LoginModal.prototype.init=function(){var e=pns$.Deferred(),t=this;return this.overlay.init("honey_login").done(function(){appAPI.getLocalResource(t.overlay.template_path+"user_login.html").done(function(n){var o=Handlebars.compile(n);t.overlay.findEl(".content").append(o),t.bindModalClickHandlers(),e.resolve()})}),e.promise()},LoginModal.prototype.bindModalClickHandlers=function(){var e=this;this.overlay.findEl(".login-btn").on("click",function(){var t=e.overlay.findEl(".login-content .username input").val(),n=e.overlay.findEl(".login-content .password input").val();e.user.login(t,n).done(function(t){e.overlay.findEl(".login-content").hide(),e.overlay.findEl(".success-message").show(),e.overlay.resizeOverlay()})}),this.overlay.findEl(".signup-btn").on("click",function(){e.overlay.findEl(".login-content").hide(),e.overlay.findEl(".register-content").show(),e.overlay.resizeOverlay()}),this.overlay.findEl(".register-btn").on("click",function(){var t=e.overlay.findEl(".register-content .username input").val(),n=e.overlay.findEl(".register-content .password input").val(),o=e.overlay.findEl(".register-content .email input").val(),r=e.overlay.findEl(".register-content .name input").val();e.user.register(o,n,t,r).done(function(t){e.overlay.findEl(".register-content").hide(),e.overlay.findEl(".success-message").show(),e.overlay.resizeOverlay()})})},LoginModal.prototype.showModal=function(){this.overlay.showOverlay()},LoginModal.prototype.showRegisterView=function(){this.overlay.findEl(".login-content").hide(),this.overlay.findEl(".register-content").show()};var $hoppsApply;HoppsApplyCode.prototype.initiate=function(){pns$(document).on("keyup",function(e){27==e.keyCode&&($hoppsApply.running=!1)}),$h.templatesInit()},HoppsApplyCode.prototype.setFunctionString=function(e){this.function_string=e},HoppsApplyCode.prototype.setPreApplyCode=function(e){this.preapply_function=e},HoppsApplyCode.prototype.setPostApplyFunction=function(e){this.postapply_function=e},HoppsApplyCode.prototype.startHoppsApply=function(){var e=this;$h.addLightBox(),this.running=!0,pns$(".pns_lightbox_close").on("click",function(){e.running=!1});var t=$h.merch_codes.codes;this.pns_data={user_id:$h.user_id,platform:appAPI.appInfo.getPlatform(),version:appAPI.appInfo.getVersion(),environment:appAPI.appInfo.getEnvironment(),currency_code:$h.currency_symbol,merch_id:$h.merch_id,merch_meta:$h.merch_meta,merch_codes:$h.merch_codes,code_results:[],results_with_code:{},curr_code_index:0,next_code_index:1,reapply_best_code:!1,apply_code_state:$h.APPLY_CODE_STATES.REMOVE_INIT},this.preApplyCode().done(function(n){e.pns_data.starting_price=n||$h.getTotalPrice({merch_meta:$h.merch_meta}),log.info("start price is: "+e.pns_data.starting_price),async.mapSeries(t,function(t,n){e.testCode(t,n),e.showProgress()},function(t,n){e.running&&e.applyBestCode(e.pns_data.results_with_code).done(function(t){log.info("done applying best code"),e.finishCodes()})})})},HoppsApplyCode.prototype.preApplyCode=function(){if(""!=this.preapply_function){var hopps_function=eval(this.preapply_function);return hopps_function()}return pns$.Deferred().resolve()},HoppsApplyCode.prototype.testCode=function(code,callback){var dfd=pns$.Deferred(),function_string=this.function_string;""!=function_string&&void 0!=function_string&&(hopps_code=function_string);var hopps_function=eval(hopps_code);return hopps_function(code).done(function(e){log.info(e);var t=$h.cleanPrice(e);log.info("code: "+code+"  price: "+t),$hoppsApply.pns_data.results_with_code[code]=t,t<$hoppsApply.min_price&&($hoppsApply.min_price=t);var n="";0==$hoppsApply.running?(log.debug("stopping"),callback&&callback("stopped",n),dfd.resolve()):(callback&&callback(null,n),dfd.resolve())}).fail(function(e){dfd.resolve()}),dfd.promise()},HoppsApplyCode.prototype.postApplyCode=function(){if(""!=this.postapply_function){var hopps_function=eval(this.postapply_function);return hopps_function()}return pns$.Deferred().resolve()},HoppsApplyCode.prototype.finishCodes=function(){this.postApplyCode().done(function(e){log.info("showing finished"),$hoppsApply.pns_data.final_price=e||$hoppsApply.min_price,$hoppsApply.pns_data.saved_price=$hoppsApply.pns_data.starting_price-$hoppsApply.pns_data.final_price,$h.showFinished({pns_data:$hoppsApply.pns_data});var t=$hoppsApply.pns_data;$h.TIMERS.APPLY_CODES&&$h.TIMERS.APPLY_CODES.clear(),$h.TIMERS.REMOVE_CODES&&$h.TIMERS.REMOVE_CODES.clear(),$h.manageEndDisplay(t.merch_meta),$h.removePnsData($h.merch_id).done(function(){log.debug("(Coupons): PNS data cleared.")}).fail(function(e){log.error(e.error)}),log.debug("(Coupons): Negotiation complete."),$h.gaTrackEvent("CART",$h.merch_id,t.user_id,t.saved_price);var n=$h.merch_id,o=t.starting_price.toFixed(2),r=t.final_price.toFixed(2),i=(t.saved_price.toFixed(2),t.merch_codes.codes.length),a=t.best_code,s=$h.honey_id.create(),i=$hoppsApply.codes,p=[],d=[],l=$hoppsApply.pns_data.results_with_code;$h.setCouponStats(appAPI.appInfo.getPlatform(),n,o,r,a,s,i,p,d,l),$h.showFinished({pns_data:t})})},HoppsApplyCode.prototype.applyBestCode=function(e){for(var t=pns$.Deferred(),n=Object.keys(e),o=1/0,r="",i=0;i<n.length;i++)e[n[i]]<o&&(o=e[n[i]],r=n[i]);return log.info("best code is "+r+" "+o),this.pns_data.reapply_best_code=!0,$h.showProgress({pns_data:this.pns_data}),$hoppsApply.pns_data.best_code=r,this.testCode(r).done(function(){t.resolve()}),t.promise()},HoppsApplyCode.prototype.showProgress=function(e){$h.showProgress({pns_data:this.pns_data}),this.pns_data.curr_code_index++,this.pns_data.next_code_index++},Tutorial.prototype.init=function(){var e=(pns$.Deferred(),this);$(".welcome-modal").hide(),this.blackout_modal=pns$("<div/>",{id:"tutorial_blackout_modal",allowtransparency:"true",style:"display:none; position:fixed; top:0; right:0; border: none; width: 100%; height:100%;\n              background-color: #000;\n              z-index: 1000;"}).appendTo("body"),this.appendCSSLink("https://storage.googleapis.com/honey-extension/fonts/ss-standard/ss-standard.css"),this.appendCSSLocal("css/materialize.min.css").done(function(){e.appendScript("https://storage.googleapis.com/honey-extension/assets/jquery-2.1.4.min.js").done(function(){e.appendScript("https://storage.googleapis.com/honey-extension/assets/materialize.js"),e.appendCSSLocal("css/joinhoney_tutorial.css").done(function(){appAPI.getLocalResource("html/tutorial-modal.html").done(function(t){$("body").append(t),e.showModal(),e.bindClickHandlers(),e.initWaves(),$h.sendEvent("ext007001",{})})})})})},Tutorial.prototype.bindClickHandlers=function(){function e(e,n){var o=JSON.parse(e);if(n||(n=" "),o){var r=[],i=!1,a=!1,s=!1;o.errors?r=o.errors:o.error_code&&r.push(o);for(var p=0;p<r.length;p++){var d=r[p].error_code;400002==d&&(t.findEl(".tutorial-panel "+n+" .input-field .email").removeClass("valid"),t.findEl(".tutorial-panel "+n+" .input-field .email").addClass("invalid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="email"]').text(o.errors[p].error),i=!0),400005==d&&(a=!0,t.findEl(".tutorial-panel "+n+" .input-field .email").removeClass("valid"),t.findEl(".tutorial-panel "+n+" .input-field .password").addClass("invalid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="password"]').text("Password must be at least 5 characters")),409002==d&&(i=!0,t.findEl(".tutorial-panel "+n+" .input-field .email").removeClass("valid"),t.findEl(".tutorial-panel "+n+" .input-field .email").addClass("invalid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="email"]').text("This email is already registered")),409001==d&&(s=!0,t.findEl(".tutorial-panel "+n+" .input-field .email").removeClass("valid"),t.findEl(".tutorial-panel "+n+" .input-field .username").addClass("invalid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="username"]').text("This username is taken")),400004==d&&(s=!0,t.findEl(".tutorial-panel "+n+" .input-field .email").removeClass("valid"),t.findEl(".tutorial-panel "+n+" .input-field .username").addClass("invalid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="username"]').text("Username must be at least 5 characters")),401001==d&&(i=!0,a=!0,t.findEl(".tutorial-panel "+n+" .input-field .email").addClass("invalid"),t.findEl(".tutorial-panel "+n+" .input-field .password").addClass("invalid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="email"]').text("Invalid credentials"))}i||(t.findEl(".tutorial-panel "+n+" .input-field .email").removeClass("invalid"),t.findEl(".tutorial-panel "+n+" .input-field .email").addClass("valid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="email"]').text("Email")),a||(t.findEl(".tutorial-panel "+n+" .input-field .password").removeClass("invalid"),t.findEl(".tutorial-panel "+n+" .input-field .password").addClass("valid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="password"]').text("Password")),s||(t.findEl(".tutorial-panel "+n+" .input-field .username").removeClass("invalid"),t.findEl(".tutorial-panel "+n+" .input-field .username").addClass("valid"),t.findEl(".tutorial-panel "+n+' .input-field label[for="username"]').text("Username"))}}var t=this;t.findEl(".tutorial-panel .skip-btn").on("click",function(e){t.finishRegister()}),t.findEl(".tos").on("click",function(){forge.tabs.open("http://www.joinhoney.com/terms")}),t.findEl(".tutorial-panel .input-field input").on("focus",function(e){pns$(e.target).removeClass("invalid");var t=pns$(e.target).siblings("label").attr("default");pns$(e.target).siblings("label").text(t)});var n=User.getInstance(),o=!1;t.findEl(".tutorial-panel .register-btn").on("click",function(){var r=t.findEl(".tutorial-panel .register-form .email").val(),i=t.findEl(".tutorial-panel .register-form .password").val(),a=t.findEl(".tutorial-panel .register-form .username").val();o||(t.findEl(".tutorial-panel .register-btn").text("Loading"),o=!0,n.register(r,i,a).done(function(e){log.info("registered successfully"),o=!1,t.findEl(".tutorial-panel .register-btn").text("REGISTER"),t.finishRegister()}).fail(function(n){e(n,""),o=!1,t.findEl(".tutorial-panel .register-btn").text("REGISTER")}))}),t.findEl(".skip-btn").on("click",function(){t.finishRegister(),$h.sendEvent("ext007003",{})}),t.findEl(".skip-demo").on("click",function(){t.closeTutorial()});var r=new Cookbook;t.findEl("#try-honey").one("click",function(){log.info("running try honey"),r.runFunction("7501453381667425123"),t.closeTutorial(),$h.sendEvent("ext007004",{})})},Tutorial.prototype.closeTutorial=function(){this.endModal(),$(".welcome-modal-wrapper").hide(),$("#tutorial-modal").hide()},Tutorial.prototype.finishRegister=function(){pns$("#tutorial-first").hide(),pns$("#tutorial-second").show(),pns$("#tutorial-modal").animate({height:"470px"},300)},Tutorial.prototype.close=function(){var e=this;$("#tutorial-modal").hide(),e.endModal()},Tutorial.prototype.appendCSSLocal=function(e){return appAPI.getLocalResource(e).done(function(e){var t=pns$("<style>",{type:"text/css"});t.text(e),$("head").append(t)})},Tutorial.prototype.appendCSSLink=function(e){var t;t=pns$("<link>",{rel:"stylesheet",href:e}),$("head").append(t)},Tutorial.prototype.appendScript=function(e){var t=pns$.Deferred(),n=document.createElement("script");return n.type="text/javascript",n.src=e,n.onload=function(){n.onload=null,t.resolve()},document.head.appendChild(n),t.promise()},Tutorial.prototype.initWaves=function(){window.location.href="javascript: (function(){ Waves.displayEffect(); }())"},Tutorial.prototype.findEl=function(e){return pns$(e)},Tutorial.prototype.showModal=function(e){var t=pns$(this.blackout_modal),e=e||150;t.css({display:"block",opacity:.01}),t.stop().animate({opacity:.4},e,function(){pns$(document).keyup(function(e){27===e.keyCode&&t.stop().fadeOut()})})},Tutorial.prototype.endModal=function(){pns$("#tutorial_blackout_modal").stop().fadeOut()},UnoGeneric.prototype.init=function(){this.prodNameSels=[this.prodNameMeta,"[itemtype='http://schema.org/Product'] [itemprop=name]","[itemprop=name]","[property='og:title']"],this.prodImageSels=[this.prodImageMeta,"[itemtype='http://schema.org/Product'] [itemprop=image]","[itemprop=image]","[property='og:image']"],this.prodListPriceSels=[this.prodListPriceMeta,"[itemprop=standardPrice]","[property='og:price:standard_amount']","[property='product:original_price:amount']"],this.prodCurrPriceSels=[this.prodSalePriceMeta,"[itemtype='http://schema.org/Offer'] [itemprop=price]","[itemprop=price]","[property='product:sale_price:amount']","[property='og:product:price:amount']","[property='product:price:amount']"],this.prodCurrencySels=[this.prodCurrencyMeta,"[itemprop=currency]","[property='og:price:currency']","[property='product:price:currency']"],this.prodURLSels=[this.prodURLMeta,"[itemprop=url]","[property='og:url']"],this.prodIDSels=[this.prodIDMeta,"[itemtype='http://schema.org/Product'] [itemprop=productid]","[itemprop=productid]"],this.prodSKUSels=[this.prodSKUMeta,"[itemtype='http://schema.org/Product'] [itemprop=sku]"],this.prodRatingSels=[this.prodRatingMeta,"[itemtype='http://schema.org/Product'] [itemprop=aggregateRating]","[itemprop=aggregateRating]"],this.prodDescriptionSels=[this.prodDescriptionMeta,"[itemtype='http://schema.org/Product'] [itemprop=description]","[itemprop=description]","[property='og:title']"],this.prodAvailabilitySels=[this.prodAvailabilityMeta,"[itemprop=availability]","[property='og:availability']"],this.prodTypeSels=["[property='og:type']"],this.aggregateLowPriceSels=["[itemprop='lowPrice']"],this.aggregateHighPriceSels=["[itemprop='highPrice']"]},UnoGeneric.prototype.run=function(){var e={method:"generic_1",store:{id:$h.site_id},product:{merch_id:this.findValue(this.prodIDSels),title:this.findValue(this.prodNameSels),currency:this.findValue(this.prodCurrencySels),description:this.findValue(this.prodDescriptionSels),image_url:this.findValue(this.prodImageSels),sku:this.findValue(this.prodSKUSels),url:this.getCanonical(this.prodURLSels),rating:this.findValue(this.prodRatingSels),availability:this.findValue(this.prodAvailabilitySels),type:this.findValue(this.prodTypeSels),imprint:!0,price:{list:accounting.unformat(this.findValue(this.prodListPriceSels)),sale:accounting.unformat(this.findValue(this.prodCurrPriceSels)),guessed:accounting.unformat(this.getPrices()),aggr_low:accounting.unformat(this.findValue(this.aggregateLowPriceSels)),aggr_high:accounting.unformat(this.findValue(this.aggregateHighPriceSels))}}};this.flag&&(""!=e.product.title||e.product.price_guessed||e.product.price_sale||e.product.price_list)&&$h.sendEvent("prd001001",e)},UnoGeneric.prototype.findValue=function(e){var t=this.findSelectors(e);return""!=t?t:""},UnoGeneric.prototype.findSelectors=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(pns$(n).length>0)return this.flag=!0,pns$(n).length>1?(this.multiple=!0,this.getValue(n)+"_"):this.getValue(n)}return""},UnoGeneric.prototype.getValue=function(e){return void 0!=pns$(e).text()&&pns$(e).text().length>0?pns$(e).text().trim():pns$(e).attr(void 0!=pns$(e).attr("src")&&pns$(e).attr("src").length>0?"src":pns$(e).attr("href")?"href":"content")},UnoGeneric.prototype.getCanonical=function(e){return pns$("[rel='canonical']").length>0?pns$("[rel='canonical']").attr("href"):this.findValue(e)},UnoGeneric.prototype.findProperties=function(e){},UnoGeneric.prototype.getPrices=function(){var e=[],t=[],n=new RegExp(/\$([0-9]+[\.]*[0-9]*)/),o=new RegExp(/([0-9]+[\.]*[0-9]*)/);$("body *:visible").each(function(){if($(this).offset().top>100&&$(this).offset().top<1e3){var t=$(this).clone().children().remove().end();t.text().match(o)&&(t.html().match(/script/)||e.push($(this)))}});for(var r=0;r<e.length;r++)e[r].text().match(n)?t.push(e[r]):e[r].parent().text().match(n)&&t.push(e[r]);return this.filterPrices(t)},UnoGeneric.prototype.findPrice=function(e){e=e||document.body;var t=e.textContent||e.innerText,n=/\$\s*[0-9,]+(?:\s*\.\s*\d{2})?/,o=t.match(n);if(o){var r,i=e.children,a=i.length;for(r=0;a>r;r++)if(this.findPrice(i[r]))return i[r];return e}return!1},UnoGeneric.prototype.filterPrices=function(e){for(var t=[],n=[],o=[],r=[],i=0,a=null,s=0;s<e.length;s++)t.push(this.parseSize(e[s])),n.push(this.parseWeight(e[s])),o.push(e[s].css("font-style")),r.push(e[s].css("color"));var p=Math.max.apply(null,t),d=Math.max.apply(null,n),l=[];log.info("max_size "+p);for(var s=0;s<e.length;s++)t[s]==p&&n[s]==d&&"line-through"!=e[s].css("text-decoration")&&(log.debug("found possible price: "+e[s].text()),l.push(e[s]));if(l.length>1){var c=this.findOutlier(r);log.debug("got outlier "+c);for(var s=0;s<l.length;s++)log.info(l[s].text()),l[s].css("font-style")==c&&(i++,a=l[s].text().trim());log.info("price is "+a)}else 1==l.length&&(log.debug(l[0].text().trim()),a=l[0].text().trim());return i>=1&&(a="warning: multiple found: "+a),a},UnoGeneric.prototype.parseWeight=function(e){var t=e.css("font-style");return parseInt(t)?parseInt(t):"bold"==t?700:"normal"==t?400:0},UnoGeneric.prototype.parseSize=function(e){var t=e.css("font-size");return t.match(/pt/)?1.333*parseInt(t):parseInt(t)},UnoGeneric.prototype.findOutlier=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]?t[e[n]]+=1:t[e[n]]=1;var o=null,r=1/0;for(var i in t){var a=t[i];r>a&&(o=i,r=a)}return console.log(t),o},Walmart=function(){this.updater=new HoneyUpdater,this.api_url="http://mobile.walmart.com/m/j?service=ExtendedItem&method=get&version=4&e=1&p1=",this.deferreds=[],this.array_results=[],this.request_limit=5},Walmart.prototype.start=function(){self=this;var e=this.getIDs();e=this.updater.removeDuplicates(e),log.info(e);for(var t=this.updater.getRandomIndexes(this.request_limit,e.length),n=[],o=0;o<t.length;o++){var r=e[t[o]];n.push(this.getDataURL(r))}for(var o=0;o<n.length;o++)dfd=this.updater.dGet(n[o]),this.deferreds.push(dfd),pns$.when(dfd).done(function(e,t){var n=self.parseResult(e);self.array_results.push(n)});pns$.when.apply(null,this.deferreds).done(function(e){log.debug("finished walmart requests");for(var t=0;t<self.array_results.length;t++);})},Walmart.prototype.getIDs=function(){var e=[];return pns$("[data-item-id]").each(function(t){var n="";pns$(this).attr("data-item-id")&&(n=pns$(this).attr("data-item-id")),e.push(n)}),e},Walmart.prototype.getDataURL=function(e){return this.api_url+e},Walmart.prototype.parseResult=function(e){try{var t=e.generalProductInformationModule,n=!1;if(t.availability.value)for(var o=0;o<t.availability.value;o++)"Online"==t.availability.value[o]&&(n=!0);var r={v:$h.getVersion(),pa:t.id,pt:t.name,pi:t.itemImage215,pl:(e.sellersModule||{})[0].sellerItem.baseItemPrice||"",ps:t.price,ph:"NA",pr:t.customerRatings,pc:t.cRRNumReviews,pv:n,pe:t.ssFreeShipping,mi:t.pcpSellerId,mn:t.primarySellerName,up:t.upc,mo:t.modelNumber,sd:e.productInformationModule.shortDescription,ai:t.altItemImages300};this.array_results.push(r),log.info(r)}catch(i){log.debug("error occured"+i)}},GrouponFinder.prototype.init=function(){appAPI.getUserPrefs().done(function(e){if(!e||(log.debug(e),"off"!=e.groupon_feature))if(addonOverlay=new AddonOverlay,addonOverlay.init(),$grouponFinder.addButtonCSS("js/addons/css/groupon_button.css"),$grouponFinder.onSearchPage()){$grouponFinder.getGrouponDataSearchPage(!1);var t=function(e){e[0].added.length>0&&$grouponFinder.getGrouponDataSearchPage(!0)};observer=$grouponFinder.addYelpObserver(t,".content")}else $grouponFinder.onStorePage()&&$grouponFinder.getGrouponDataStorePage()})},GrouponFinder.prototype.addYelpObserver=function(e,t){var n=new MutationSummary({callback:e,queries:[{element:t}]});return n},GrouponFinder.prototype.onSearchPage=function(){var e=window.location.href;return e.match(/.*yelp\.com\/search/)?!0:!1},GrouponFinder.prototype.onStorePage=function(){var e=window.location.href;return e.match(/.*yelp\.com\/biz/)?!0:!1},GrouponFinder.prototype.getGrouponDataStorePage=function(){var e=pns$.Deferred(),t=pns$(".biz-page-title").text(),n=pns$(".street-address [itemprop=postalCode]").text();return t&&n&&$grouponFinder.getLatLng(n).done(function(e){$grouponFinder.getGrouponAPI(t,e.lat,e.lng).done(function(e){$grouponFinder.matchYelpStorePage(e)})}),e.promise()},GrouponFinder.prototype.getGrouponDataSearchPage=function(e){var t=pns$.Deferred();return forge.document.location(function(n){var o=$grouponFinder.getQueryParams(n.search);if(e){var r={};r=$grouponFinder.getQueryParams(n.hash),$grouponFinder.search_query=r["#find_desc"]?r["#find_desc"]:o.find_desc,$grouponFinder.location_query=r.find_loc?r.find_loc:o.find_loc}else $grouponFinder.search_query=o.find_desc,$grouponFinder.location_query=o.find_loc;$grouponFinder.search_query&&$grouponFinder.location_query&&$grouponFinder.getLatLng($grouponFinder.location_query).done(function(e){$grouponFinder.lat=e.lat,$grouponFinder.lng=e.lng,$grouponFinder.getGrouponAPI($grouponFinder.search_query,$grouponFinder.lat,$grouponFinder.lng).done(function(e){t.resolve(e),$grouponFinder.matchYelpSearchResults(e)})})}),t.promise()},GrouponFinder.prototype.getGrouponAPI=function(e,t,n){var o=pns$.Deferred(),r=this.groupon_api+"/search?limit="+this.count_deals+"&relevance_context=mobile_search&other_deals=true&locale=en_US&show=default%2Cmerchant%28profileHtml%29%2CspecificAttributes%2Ctraits%2Coptions%28default%2Cimages%2CgiftWrappingCharge%2CshippingOptions%2Cuuid%2CschedulerOptions%29%2Crecommendation%2Clocations%2CpriceSummary%2CstartRedemptionAt%2CendRedemptionAt%2CisMultiOption&offset=0&metadata=true&client_id=007999301e3ce312fdd76fbbec6d2de1&client_version_id=6.3673&secure_assets=false&query="+e+"&lat="+t+"&lng="+n;return forge.request.get(r,function(e){for(var t=e.deals,n=[],r=0;r<t.length;r++){var i=t[r],a="",s=[];i.merchant.ratings&&i.merchant.ratings[0]&&(a=i.merchant.ratings[0].url),i.options[0]&&i.options[0]&&(s=i.options[0].redemptionLocations);var p={merchant_name:i.merchant.name,yelp_url:a,deal_text:i.announcementTitle,groupon_id:i.id,groupon_url:i.dealUrl,groupon_sold:i.soldQuantity,groupon_price_before:i.priceSummary.value.formattedAmount,groupon_price_after:i.priceSummary.price.formattedAmount,groupon_price_discount_percent:i.priceSummary.discountPercent,groupon_locations:s,groupon_img:i.sidebarImageUrl};n.push(p)}o.resolve(n)},function(){log.debug("could not get groupon api")}),o.promise()},GrouponFinder.prototype.matchYelpSearchResults=function(e){pns$(".results-wrapper .biz-listing-large").each(function(t){if(!(pns$(this).find(".groupon-link").length>0))for(var n=0;n<e.length;n++){var o=(e[n],!1),r=pns$(this).find(".biz-name").attr("href");if(r=r.split("?")[0],r="http://www.yelp.com"+r,log.info("match url is "+r),r==e[n].yelp_url){log.info("url match found: "+e[n].yelp_url);var i=e[n];i.match_url=r,$grouponFinder.addGrouponButton(i,pns$(this).find($grouponFinder.element_to_append_to)),$grouponFinder.postData(i,"impression"),o=!0}else if(e[n].groupon_locations[0]){var a=pns$(this).find(".biz-phone").text().trim();if(a.length>0)for(var s="+1"+a.replace("(","").replace(")","").replace(" ","").replace("-",""),p=0;p<e[n].groupon_locations.length;p++)if(log.info("yelp phone number is "+s),log.info(e[n].groupon_locations[p].phoneNumber),s==e[n].groupon_locations[p].phoneNumber){log.debug("phone number match found: "+s);var i=e[n];i.match_url=r,$grouponFinder.addGrouponButton(i,pns$(this).find($grouponFinder.element_to_append_to)),$grouponFinder.postData(i,"impression"),o=!0;break}}if(o)break}})},GrouponFinder.prototype.matchYelpStorePage=function(e){var t=window.location.href,n="",o=pns$(".biz-phone").text().trim();o.length>0&&(n=o.replace("(","").replace(")","-").replace(" ",""));for(var r=0;r<e.length;r++)if(t==e[r].yelp_url){var i=e[r];i.match_url=t,$grouponFinder.addGrouponButton(i,pns$(".biz-page-header-right"),"prepend").done(function(){pns$(".groupon-negotiate-button").css("margin-bottom","20px"),$grouponFinder.postData(i,"impression")})}else for(var a=0;a<e[r].groupon_locations.length;a++)if(""!=n&&n==e[r].groupon_locations[a].phoneNumber){var i=e[r];i.match_url=t,$grouponFinder.addGrouponButton(i,pns$(".biz-page-header-right"),"prepend").done(function(){pns$(".groupon-negotiate-button").css("margin-bottom","20px"),$grouponFinder.postData(i,"impression")})}},GrouponFinder.prototype.addGrouponButton=function(e,t,n){var o=pns$.Deferred();return log.info("found match for "+e.merchant_name),appAPI.getLocalResource("js/addons/templates/groupon_button.html").done(function(r){var i=Handlebars.compile(r),a={percent_saved:e.groupon_price_discount_percent};"prepend"==n?pns$(t).prepend(i(a)):pns$(t).append(i(a));var s=!1;pns$(t).find(".groupon-negotiate-button").click(function(t){if(!s){s=!0;try{$overlay.findEl(".groupon-content").remove()}catch(t){return void log.debug("failed to remove old frame")}appAPI.getLocalResource("js/addons/templates/groupon_content.html").done(function(t){var n=Handlebars.compile(t),o={percent_saved:e.groupon_price_discount_percent,groupon_img:e.groupon_img,groupon_link:e.groupon_url,groupon_text:e.deal_text,groupon_price_before:e.groupon_price_before.split(".")[0],groupon_price_after:e.groupon_price_after.split(".")[0]};$overlay.findEl(".content").append(n(o)),$overlay.showOverlay(),$grouponFinder.postData(e,"click"),$grouponFinder.bindGrouponButtons(e.groupon_url,e)}),t.stopPropagation()}setTimeout(function(){s=!1},100)}),o.resolve()}),o.promise()},GrouponFinder.prototype.addButtonCSS=function(e){appAPI.getLocalResource(e).done(function(e){var t;t=pns$("<style>",{type:"text/css"}),t.text(e),pns$("head").append(t)})},GrouponFinder.prototype.bindGrouponButtons=function(e,t){var n=this;$overlay.findEl(".groupon-link").click(function(){$grouponFinder.postData(t,"clickthrough");var o=n.groupon_track_url+e;$h.affiliate&&$h.affiliate.ybc&&(o=$h.pickOneUrl($h.affiliate.ybc)+"?param1="+e),log.info(o),forge.tabs.open(o)}),$overlay.findEl(".dismiss").click(function(){$overlay.hideOverlay()}),$overlay.findEl(".tweet").click(function(){window.open("http://twitter.com/intent/tweet?text=@savehoney","Share the Honey","width=600,height=350")})},GrouponFinder.prototype.removeForever=function(){appAPI.setUserPrefs("groupon_feature","off").done(function(e){pns$(".groupon-negotiate-button").remove(),$overlay.hideOverlay()})},GrouponFinder.prototype.getLatLng=function(e){var t=pns$.Deferred();return forge.request.get(this.geocode_url+"json?address="+encodeURIComponent(e),function(e){
e.results[0].geometry.location?t.resolve(e.results[0].geometry.location):t.reject()},function(){t.reject()}),t.promise()},GrouponFinder.prototype.getQueryParams=function(e){for(var t,n={},o=/[?&]?([^=]+)=([^&]*)/g;t=o.exec(e);)n[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return n},GrouponFinder.prototype.postData=function(e,t){var n=pns$.Deferred(),o="";"impression"==t?o="ext100101":"click"==t?o="ext100102":"clickthrough"==t&&(o="ext100103");{var r;$h.getVersion()}return r=e.match_url?e.match_url:e.groupon.yelp_url,$h.sendEvent(o,{source_page:{label:e.merchant_name,url:r},merchant:{name:e.merchant_name},deal_text:e.deal_text,groupon:{id:e.groupon_id,url:e.groupon_url,start_price:parseFloat(e.groupon_price_before.replace("$","").replace(",","")),final_price:parseFloat(e.groupon_price_after.replace("$","").replace(",",""))}}),n.promise()},Launchpad.prototype.init=function(){var e=pns$.Deferred(),t=this;this.code_details=$h.merch_codes,this.sales=$h.sales_data,this.blackout_modal=pns$("<div/>",{id:"blackout_modal",allowtransparency:"true",style:"display:none; position:fixed; top:0; right:0; border: none; width: 100%; height:100%;\n              background-color: #000;\n              z-index: 2000000000;"}).appendTo("body");var n=pns$("<iframe/>",{id:this.iframe_sel,allowtransparency:"true",style:"height: 0;\n      display: none;\n      width: 0;\n      position: fixed;\n      top: 0px;\n      right: -2px;\n      border: none;\n      background-color: #f7f9f9;\n      overflow:hidden;\n      z-index: 2147483639;\n      clip: auto;\n      box-shadow: rgb(181, 181, 181) 1px 0px 3px 3px;"});return pns$("body").append(n),this.loadCSS().done(function(){t.appendScriptRemote("https://storage.googleapis.com/honey-extension/assets/jquery-2.1.4.min.js").done(function(){t.initMaterialize(),appAPI.getLocalResource(t.template_path+"main.hbs").done(function(n){t.getIframeContents().find("body").append(n),t.initDefaults(),forge.is.firefox()&&t.findEl(".tab").css("padding-bottom","40px"),t.bindTabClickHandlers(),t.dCouponsInit=t.initCouponsTab(),t.dSalesInit=t.initSalesTab(),t.dTutorialInit=t.initTutorial(),t.dExclusivesInit=t.initExclusivesTab(),pns$.when(t.dCouponsInit,t.dSalesInit).done(function(){t.bindClickHandlers(),e.resolve()}),pns$.when(t.dTutorialInit).done(function(){var e=!1;window.location.href.match("amazon.com")&&window.location.href.match("htt=1")&&(e=!0,User.getInstance().checkLoginState().fail(function(){t.showTutorial(),t.findEl(".close-icon").hide(),t.showLaunchpad()}))}),t.bindResizeEvent()})})}),e.promise()},Launchpad.prototype.bindClickHandlers=function(){var e=this;e.findEl(".view-all").on("click",function(){forge.tabs.open(Config.joinhoney_url+"/shop/"+$h.merch_label)}),e.findEl(".settings-icon").on("click",function(){forge.prefs.clearAll();var e=User.getInstance();e.logout()})},Launchpad.prototype.initMaterialize=function(){var e=this,t=pns$.Deferred();return forge.tools.getURL("js/lib/materialize.js",function(n){e.appendScriptRemote(n),t.resolve()}),t.promise()},Launchpad.prototype.initWaves=function(){this.appendScriptText("Waves.displayEffect();")},Launchpad.prototype.initZeroClipboard=function(){var e=this,t=document.getElementById(e.iframe_sel);forge.is.chrome()?e.findEl(".coupon.copy-btn").on("click",function(){var e=pns$(this).attr("data-clipboard-text");forge.message.broadcastBackground("copy",e);var t=pns$(this).parent().find(".copied-message");t.fadeIn(200),setTimeout(function(){t.fadeOut(200)},800),$h.sendEvent("ext002002",{})}):forge.is.firefox()&&(this.appendScriptRemote("//storage.googleapis.com/honey-extension/assets/ZeroClipboard.min.js"),setTimeout(function(){var n="//storage.googleapis.com/honey-extension/assets/ZeroClipboard.swf",o=t.contentWindow.document.createElement("script");o.type="text/javascript",o.text='\n        ZeroClipboard.config({ flashLoadTimeout: 6000 });\n        ZeroClipboard.config( { swfPath: "'+n+'" } );\n        ZeroClipboard.config({ trustedDomains: ["*"] });\n        var client = new ZeroClipboard( $(".copy-btn") );\n        client.on( "ready", function(event) {\n          client.on( "copy", function(event) {\n            var copy_text = event.target.getAttribute("data-clipboard-text");\n            event.clipboardData.setData("text/plain", copy_text);\n          });\n        });\n        client.on("error", function(e) {\n          console.log(e);\n        });',t.contentWindow.document.body.appendChild(o),e.findEl(".coupon.copy-btn").on("click",function(){var e=pns$(this).parent().find(".copied-message");e.fadeIn(100),setTimeout(function(){e.fadeOut(200)},800),$h.sendEvent("ext002002",{})})},2500))},Launchpad.prototype.initDefaults=function(){var e=this;e.findEl(".num-coupons").text($h.count_coupons),e.findEl(".num-sales").text($h.count_sales),e.findEl(".gab-link").click(function(){forge.tabs.open(Config.joinhoney_url+"/giveabuck/"+$h.shid)}),$h.count_coupons>0?e.findEl("#coupons-tab").addClass("active"):$h.count_sales>0&&e.findEl("#sales-tab").addClass("active")},Launchpad.prototype.bindTabClickHandlers=function(){var e=this;this.findEl(".tabs .tab").on("click",function(t){e.findEl(".tab").removeClass("active"),e.findEl(".tab .expand-icon").text("+"),e.findEl(t.target).closest(".tab").addClass("active"),e.findEl(t.target).closest(".tab").is("#sales-tab")&&$h.sendEvent("ext002003",{})}),this.findEl(".close-icon").on("click",function(t){e.hideLaunchpad(200),e.endModal()}),this.findEl("#contact-btn").on("click",function(e){forge.tabs.open("https://joinhoney.com/contact")}),this.findEl("#contact-banner .twitter-icon").on("click",function(e){forge.tabs.open("https://twitter.com/savehoney")}),this.findEl("#contact-banner .facebook-icon").on("click",function(e){forge.tabs.open("https://www.facebook.com/savehoney")})},Launchpad.prototype.showCodes=function(){var e=this;e.showLaunchpad(),e.findEl(".tab").removeClass("active"),e.findEl(".tab .expand-icon").text("+"),e.findEl(".tab#coupons-tab").addClass("active")},Launchpad.prototype.getIframeContents=function(){return $("#"+this.iframe_sel).contents()},Launchpad.prototype.findEl=function(e){return this.getIframeContents().find("body").find(e)},Launchpad.prototype.showLaunchpad=function(){var e=this;if($(this.iframe_el).show(),$(this.iframe_el).height("100%"),this.resizeIframe(200),$(this.iframe_el).width()<10){var t=$("body").width(),n=e.findEl(".container.main").width(),o=(t-n)/t*100;$("body").animate({width:o+"%"},200),$("body").animate({marginRight:e.findEl(".container.main").width()},0),setTimeout(function(){$("body").css("overflow","visible")},350)}},Launchpad.prototype.hideLaunchpad=function(e){var t=this;pns$(this.iframe_el).animate({width:0},e),$("body").animate({width:"100%"},e),$("body").css("margin-right","0"),setTimeout(function(){$("body").css("overflow","visible"),$(t.iframe_el).hide(),$(t.iframe_el).width(0),$(t.iframe_el).height(0)},e+100),t.endModal()},Launchpad.prototype.loadCSS=function(){var e=pns$.Deferred(),t=this;return this.appendCSSLocal("css/materialize.min.css").done(function(){t.appendCSSLink("https://storage.googleapis.com/honey-extension/fonts/avenir.css"),t.appendCSSLink("//storage.googleapis.com/honey-extension/fonts/ss-standard/ss-standard.css"),t.appendCSSLocal(t.css_path+"launchpad.css").done(function(n){return t.resizeIframe(),e.resolve(n)})}),e.promise()},Launchpad.prototype.appendCSSLocal=function(e){var t=this;return appAPI.getLocalResource(e).done(function(e){var n;n=pns$("<style>",{type:"text/css"}),n.text(e),t.getIframeContents().find("head").append(n)})},Launchpad.prototype.appendCSSLink=function(e){var t;t=pns$("<link>",{rel:"stylesheet",href:e}),this.getIframeContents().find("head").append(t)},Launchpad.prototype.appendCSSRemote=function(e){var t;t=pns$("<link>",{rel:"stylesheet",href:e}),this.getIframeContents().find("head").append(t)},Launchpad.prototype.initApplyPanel=function(){var e=this;log.info("initializing apply panel"),this.addLaunchpadModal(),this.apply_panel_initialized=!0,e.findEl(".tab#instacash-tab").hide(),e.findEl(".tab").removeClass("active"),e.findEl(".tab .expand-icon").text("+"),e.findEl(".gab-share-handle").hide(),e.findEl(".tab#honey-exclusives-tab").addClass("active"),e.findEl("#honey-exclusives-tab").show(),e.findEl("#give-a-buck").hide(),e.findEl("#apply-codes").show(),e.findEl(".code_count").text($h.merch_codes.codes.length),e.bindApplyClickHandlers(),setTimeout(function(){e.findEl("#honey-exclusives-tab").show(),e.findEl("#apply-codes").show()},300),window.location.href.match(/honey_demo=1/)&&e.initHoneyDemo()},Launchpad.prototype.initHoneyDemo=function(){var e=this;e.showModal(),setTimeout(function(){var t=e.findEl(".apply-button").offset().top-200,n=pns$("<img/>",{src:"https://storage.googleapis.com/honey-extension/images/onboard-icon-clickhere.png",id:"click-here",style:"display:block;\n                z-index: 2000000001;\n                position: fixed;\n                top: "+t+"px;\n                right: 320px;\n                width: 300px;"});pns$("body").append(n)},500)},Launchpad.prototype.addLaunchpadModal=function(){var e=pns$("<iframe/>",{"class":"honey-launchpad-modal",allowtransparency:"true",sandbox:"allow-same-origin allow-scripts allow-popups",width:"100%",height:"100%",style:"display: none;\n              z-index: 2000000000;\n              position: fixed;\n              top: 0px;\n              left: 0px;\n              width: 100%;\n              height: 100%;\n              opacity: .7;\n              background-color: #000000;"});$("body").append(e)},Launchpad.prototype.bindApplyClickHandlers=function(){var e=this;this.findEl(".apply-button").on("click",function(){log.info("starting coupon code application"),$h.triggerEvent("start_coupon_codes"),$h.setHoneyClickEvent($h.shid,appAPI.appInfo.getVersion(),appAPI.appInfo.getPlatform(),$h.site_id)}),this.findEl(".see-codes-text").on("click",function(){e.findEl("#coupons-tab .tab-handle").click()}),this.findEl(".tabs .tab#honey-exclusives-tab .tab-handle").on("click",function(t){e.findEl(".tab").removeClass("active"),e.findEl(t.target).closest(".tab").addClass("active"),setTimeout(function(){e.findEl(".instant-cash-zone").trigger("resize")},400)})},Launchpad.prototype.formatCodesArray=function(e){for(var t=[],n=e||$h.merch_meta.pns_siteCodeMax,o=0,r=0;r<$h.merch_codes.details.length;r++){var i=$h.merch_codes.details[r];if(i!={}&&i.code&&i.code.length>1&&(i.expiration=$h.unixToLocal(1e3*i.expires),t.push(i),o++,o==n))return t}return t},Launchpad.prototype.initExclusivesTab=function(){var e=pns$.Deferred(),t=this,n=GiveABuck.getInstance();return n.checkOfferAvailable().done(function(){t.findEl(".gab-share-handle").show()}),appAPI.getLocalResource(t.template_path+"honey_exclusives_tab.hbs").done(function(o){var r=Handlebars.compile(o),i={value_text:"$1"};0==t.findEl("#honey-exclusives-tab").length&&t.findEl("#apply-tab").append(r(i)),n.checkOfferAvailable().done(function(){appAPI.getStorageKey(n.amazon_gab_key).done(function(e){e&&(e.used||e.ttl+e.start_time<Date.now()/1e3)||(t.findEl("#honey-exclusives-tab").show(),t.findEl(".container .tabs .tab").removeClass("active"),t.findEl(".container .tabs #honey-exclusives-tab").addClass("active"),t.findEl(".tab#honey-exclusives-tab .expand-icon").text("-"),t.initWaves(),t.bindExclusivesClickHandlers(),pns$.when(n.d_offer_claimed).done(function(){t.showGABClaimed()}),n.getAssignedOffer().done(function(e){if(e.id){{t.getHoursRemaining(e)}t.findEl("#honey-exclusives-tab .expire-banner").show()}}).fail(function(){log.info("no offer found")}))})}).fail(function(){e.resolve()}),e.resolve()}),e.promise()},Launchpad.prototype.getHoursRemaining=function(e){var t=this;e.ttl&&!e.start_time&&(e.start_time=Date.now());var n=(e.ttl+e.start_time-Date.now()/1e3,new CountdownTimer(1e3*(e.start_time+e.ttl)));n.addElements(t.findEl(".expire-banner .hours-left"),t.findEl(".expire-banner .minutes-left"),t.findEl(".expire-banner .seconds-left")),n.startTimer()},Launchpad.prototype.bindExclusivesClickHandlers=function(){var e=this,t=User.getInstance(),n=GiveABuck.getInstance();this.findEl(".tabs .tab#honey-exclusives-tab .tab-handle").on("click",function(t){e.findEl(".tab").removeClass("active"),e.findEl(".tab .expand-icon").text("+"),e.findEl(t.target).closest(".tab").addClass("active")}),this.findEl("#honey-exclusives-tab .activate.waves-effect").on("click",function(o){t.getUserDetails().done(function(t){n.claimOffer(),e.showGABClaimed()}).fail(function(t){e.showTutorial(!0)})})},Launchpad.prototype.showGABClaimed=function(){this.findEl("#honey-exclusives-tab #give-a-buck .activate").text("CLAIMED"),this.findEl("#honey-exclusives-tab #give-a-buck .activate").addClass("claimed"),this.findEl("#honey-exclusives-tab #give-a-buck .activate").removeClass("waves-effect"),this.findEl("#honey-exclusives-tab #give-a-buck .percentage").addClass("claimed"),this.findEl("#honey-exclusives-tab #apply-codes .title-banner").show()},Launchpad.prototype.showInstacashActive=function(){var e=this;e.findEl("#instacash-tab .activate").addClass("active"),e.findEl("#instacash-tab .activate .text").text("CLAIMED"),e.findEl("#instacash-tab .ss-check").fadeIn(200),e.findEl("#instacash-tab .claimed-msg").fadeIn(200)},Launchpad.prototype.initCouponsTab=function(){this.coupon_details=$h.merch_codes.details;var e=this;return appAPI.getLocalResource(this.template_path+"coupon_item.hbs").done(function(t){var n=Handlebars.compile(t),o=5,r=0,i=e.coupon_details.length;if(0==i)return void log.info("no codes found");for(var a=0;i>a;a++)if(e.coupon_details[a]!={}&&e.coupon_details[a].code&&e.coupon_details[a].code.length>1){var s=$h.unixToLocal(1e3*e.coupon_details[a].expires),p={code:e.coupon_details[a].code,description:e.coupon_details[a].description,expiration:s};if(e.findEl("#coupons-tab .tab-content .container .content").append(n(p)),r++,r>=o)break}e.initZeroClipboard(),e.initWaves()})},Launchpad.prototype.initSalesTab=function(){var e=this;return this.sales=$h.sales_data,appAPI.getLocalResource(this.template_path+"sale_item.hbs").done(function(t){var n=Handlebars.compile(t),o=5,r=0,i=e.sales.length;if(0!=i){for(var a=0;i>a;a++)if(""!=e.sales[a].description){var s={description:e.sales[a].description,url:e.sales[a].url};if(e.findEl("#sales-tab .container .content").append(n(s)),r++,r>=o)break}e.bindSalesClickHandlers()}})},Launchpad.prototype.bindSalesClickHandlers=function(){this.findEl(".list-item.sale").on("click",function(){if($(this).attr("data-url").length>2)var e=$(this).attr("data-url");else var e=$h.merch_url;e&&forge.tabs.open(e)})},Launchpad.prototype.initProfileTab=function(){var e=this,t=User.getInstance();return appAPI.getLocalResource(this.template_path+"profile.hbs").done(function(n){var o=Handlebars.compile(n),r={logged_in:!1};return t.getUserDetails().done(function(t){var n={name:t.name,image_url:t.image_url,username:t.username,num_products:t.num_liked_products||0,num_followers:t.num_followers||0,num_following:t.num_followees||0};e.findEl("#profile-tab .tab-content").append(o(n)),e.findEl("#profile-tab .content.loggedin").addClass("active"),e.findEl("#profile-tab .content.loggedout").removeClass("active"),e.bindProfileClickHandlers()}).fail(function(t){e.findEl("#profile-tab .tab-content").append(o(r)),e.bindProfileClickHandlers()})})},Launchpad.prototype.bindProfileClickHandlers=function(){var e=this,t=e.findEl(".loggedout .register-form"),n=e.findEl(".loggedout .login-form");this.findEl(".loggedout .register-form .switch").on("click",function(){t.removeClass("active"),n.addClass("active")}),this.findEl(".loggedout .login-form .switch").on("click",function(){n.removeClass("active"),t.addClass("active")}),this.findEl(".form .input-field").on("focus",function(){pns$(this).find("label, i").addClass("active")}),this.findEl(".form .input-field").on("blur",function(){pns$(this).find("label, i").removeClass("active")}),this.findEl(".loggedout .register-form .submit").on("click",function(){e.registerUser()}),this.findEl(".loggedout .register-form .login").on("click",function(){e.loginUser()})},Launchpad.prototype.registerUser=function(){var e=this,t=User.getInstance(),n=e.findEl(".loggedout .register-form .form-email").val(),o=e.findEl(".loggedout .register-form .form-username").val(),r=e.findEl(".loggedout .register-form .form-password").val();t.register(n,r,o).done(function(e){alert("success")}).fail(function(e){alert(e)})},Launchpad.prototype.loginUser=function(){var e=self.findEl(".loggedout .login-form .form-username").val(),t=self.findEl(".loggedout .login-form .form-password").val();return user.login(e,t).done(function(e){alert("success")}).fail(function(e){alert(e)})},Launchpad.prototype.setProfileDefaults=function(e){({logged_in:!0,name:e.name,image_url:e.image_url,username:e.username,num_products:e.num_liked_products,num_followers:e.num_followers,num_following:e.num_followees})},Launchpad.prototype.initTutorial=function(){var e=this;return appAPI.getLocalResource(this.template_path+"tutorial.html").done(function(t){var n=Handlebars.compile(t);context={},e.findEl(".tutorial-panel").append(n(context)),e.bindTutorialClickHandlers()})},Launchpad.prototype.showTutorial=function(e){var t=this;t.findEl(".content-panels").hide(),t.findEl(".tutorial-panel").fadeIn(200),t.showModal(200),e&&(t.showCarousel3(),t.findEl(".carousel-3 .register-content .register-now-msg").text("Please register to get your buck"),t.findEl(".carousel-3 .register-content .title-msg").text("YOU'RE NOT REGISTERED")),t.showLaunchpad()},Launchpad.prototype.showModal=function(e){var t=pns$(this.blackout_modal),e=e||150;t.css({display:"block",opacity:.01}),t.stop().animate({opacity:.7},e,function(){pns$(document).keyup(function(e){27===e.keyCode&&t.stop().fadeOut()})})},Launchpad.prototype.endModal=function(){pns$(this.blackout_modal).stop().fadeOut(),pns$("#click-here").hide()},Launchpad.prototype.hideTutorial=function(){var e=this;e.findEl(".content-panels").show(),e.findEl(".tutorial-panel").hide()},Launchpad.prototype.finishTutorial=function(){var e=this;e.findEl(".tutorial-panel").hide(),e.findEl(".content-panels").fadeIn(200),setTimeout(function(){var t=GiveABuck.getInstance();if(t.offer&&t.offer.start_time){{e.getHoursRemaining(t.offer)}e.findEl("#honey-exclusives-tab .expire-banner").show()}},500),e.showLaunchpad(),e.endModal()},Launchpad.prototype.showLogin=function(){var e=this;e.findEl(".register-content").hide(),e.findEl(".login-content").fadeIn(200)},Launchpad.prototype.showRegister=function(){var e=this;e.findEl(".login-content").hide(),e.findEl(".register-content").fadeIn(200)},Launchpad.prototype.hideExclusives=function(){this.findEl("#honey-exclusives-tab").hide(),this.findEl("#coupons-tab").addClass("active")},Launchpad.prototype.bindTutorialClickHandlers=function(){function e(e,t){var o=JSON.parse(e);if(t||(t=" "),o){var r=[],i=!1,a=!1,s=!1;o.errors?r=o.errors:o.error_code&&r.push(o);for(var p=0;p<r.length;p++){var d=r[p].error_code;400002==d&&(n.findEl(".tutorial-panel "+t+" .input-field .email").removeClass("valid"),n.findEl(".tutorial-panel "+t+" .input-field .email").addClass("invalid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="email"]').text(o.errors[p].error),i=!0),400005==d&&(a=!0,n.findEl(".tutorial-panel "+t+" .input-field .email").removeClass("valid"),n.findEl(".tutorial-panel "+t+" .input-field .password").addClass("invalid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="password"]').text("Password must be at least 5 characters")),409002==d&&(i=!0,n.findEl(".tutorial-panel "+t+" .input-field .email").removeClass("valid"),n.findEl(".tutorial-panel "+t+" .input-field .email").addClass("invalid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="email"]').text("This email is already registered")),409001==d&&(s=!0,n.findEl(".tutorial-panel "+t+" .input-field .email").removeClass("valid"),n.findEl(".tutorial-panel "+t+" .input-field .username").addClass("invalid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="username"]').text("This username is taken")),400004==d&&(s=!0,n.findEl(".tutorial-panel "+t+" .input-field .email").removeClass("valid"),n.findEl(".tutorial-panel "+t+" .input-field .username").addClass("invalid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="username"]').text("Username must be at least 5 characters")),401001==d&&(i=!0,a=!0,n.findEl(".tutorial-panel "+t+" .input-field .email").addClass("invalid"),n.findEl(".tutorial-panel "+t+" .input-field .password").addClass("invalid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="email"]').text("Invalid credentials"))}i||(n.findEl(".tutorial-panel "+t+" .input-field .email").removeClass("invalid"),n.findEl(".tutorial-panel "+t+" .input-field .email").addClass("valid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="email"]').text("Email")),a||(n.findEl(".tutorial-panel "+t+" .input-field .password").removeClass("invalid"),n.findEl(".tutorial-panel "+t+" .input-field .password").addClass("valid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="password"]').text("Password")),s||(n.findEl(".tutorial-panel "+t+" .input-field .username").removeClass("invalid"),n.findEl(".tutorial-panel "+t+" .input-field .username").addClass("valid"),n.findEl(".tutorial-panel "+t+' .input-field label[for="username"]').text("Username"))}}var t=User.getInstance(),n=this,o=!1;n.findEl(".tutorial-panel .register-btn").on("click",function(){var r=n.findEl(".tutorial-panel .register-content .register-form .email").val(),i=n.findEl(".tutorial-panel .register-content .register-form .password").val(),a=n.findEl(".tutorial-panel .register-content .register-form .username").val();o||(n.findEl(".tutorial-panel .register-btn").text("Loading"),o=!0,t.register(r,i,a).done(function(e){e.gab_offer||n.hideExclusives(),o=!1,n.findEl(".tutorial-panel .register-btn").text("REGISTER"),n.finishTutorial()}).fail(function(t){e(t,".register-content"),o=!1,n.findEl(".tutorial-panel .register-btn").text("REGISTER")}))}),n.findEl(".tutorial-panel .skip-btn").on("click",function(e){n.finishTutorial()}),n.findEl(".tutorial-panel .input-field input").on("focus",function(e){pns$(e.target).removeClass("invalid");var t=pns$(e.target).siblings("label").attr("default");pns$(e.target).siblings("label").text(t)}),n.findEl(".tutorial-panel .login-btn").on("click",function(){var o=n.findEl(".tutorial-panel .login-content .register-form .email").val(),r=n.findEl(".tutorial-panel .login-content .register-form .password").val();t.login(o,r).done(function(e){n.finishTutorial()}).fail(function(t){e(t,".login-content")})}),n.findEl(".tutorial-panel .login-switch").on("click",function(){n.showLogin()}),n.findEl(".tutorial-panel .register-switch").on("click",function(){n.showRegister()}),n.findEl(".tos").on("click",function(){forge.tabs.open("http://www.joinhoney.com/terms")}),n.findEl(".forgot-text").on("click",function(){n.findEl(".forgot-form").show()}),n.findEl(".forgot-form .orange-btn").one("click",function(){var e=n.findEl(".forgot-form .email-input").val();n.findEl(".forgot-form .orange-btn").css("background-color","#777777"),n.findEl(".forgot-form .orange-btn").css("border","none"),n.findEl(".forgot-form .orange-btn").text("EMAIL SENT"),pns$.ajax(Config.quest_api+"/request",{type:"POST",data:{email:e,type:"send_password_reset_email"},success:function(e){}})}),n.findEl(".tutorial-panel .next-btn").on("click",function(){n.findEl(".carousel-1:visible").length>0?n.showCarousel2():n.findEl(".carousel-2:visible").length>0&&n.showCarousel3()}),n.findEl(".tutorial-panel .circle").on("click",function(){$(this).hasClass("first")?n.showCarousel1():$(this).hasClass("second")?n.showCarousel2():$(this).hasClass("third")&&n.showCarousel3()})},Launchpad.prototype.showCarousel1=function(){var e=this;e.findEl(".carousel-content").hide(),e.findEl(".close-icon").hide(),e.findEl(".circle.active").removeClass("active"),e.findEl(".circle.first").addClass("active"),e.findEl(".tutorial-panel .next-btn").text("NEXT"),e.findEl(".tutorial-panel .skip-btn").text(""),e.findEl(".carousel-1").fadeIn(300)},Launchpad.prototype.showCarousel2=function(){var e=this;e.findEl(".carousel-content").hide(),e.findEl(".close-icon").hide(),e.findEl(".circle.active").removeClass("active"),e.findEl(".circle.second").addClass("active"),e.findEl(".tutorial-panel .next-btn").text("NEXT"),e.findEl(".tutorial-panel .skip-btn").text(""),e.findEl(".carousel-2").fadeIn(300)},Launchpad.prototype.showCarousel3=function(){var e=this;e.findEl(".carousel-content").hide(),e.findEl(".close-icon").show(),e.findEl(".circle.active").removeClass("active"),e.findEl(".circle.third").addClass("active"),e.findEl(".tutorial-panel .next-btn").text(""),e.findEl(".tutorial-panel .skip-btn").text("SKIP"),e.findEl(".carousel-3").fadeIn(300)},Launchpad.prototype.getTemplateLocal=function(e){},Launchpad.prototype.getTemplateRemote=function(e){},Launchpad.prototype.appendScriptLocal=function(e){var t=pns$.Deferred(),n=this;return forge.tools.getURL(e,function(e){n.appendScriptRemote(e).done(function(){t.resolve()})}),t.promise()},Launchpad.prototype.appendScriptText=function(e){var t=document.getElementById(this.iframe_sel),n=t.contentWindow.document.createElement("script");n.type="text/javascript",n.text=e,t.contentWindow.document.body.appendChild(n)},Launchpad.prototype.appendScriptRemote=function(e){var t=pns$.Deferred(),n=this,o=document.getElementById(n.iframe_sel),r=o.contentWindow.document.createElement("script");return r.type="text/javascript",r.src=e,r.onload=function(){r.onload=null,t.resolve()},o.contentWindow.document.body.appendChild(r),t.promise()},Launchpad.prototype.bindResizeEvent=function(){var e=this;$(window).resize(function(){e.findEl(".tabs").height(e.getTabContentHeight()),e.findEl(".tutorial-panel").height(e.getTabContentHeight()-32)})},Launchpad.prototype.resizeIframe=function(e){var t=this.findEl(".container.main").width();pns$(this.iframe_el).animate({width:t},e);var n=this.getTabContentHeight();this.findEl(".tabs").height(n),this.findEl(".tutorial-panel").height(n-32)},Launchpad.prototype.getTabContentHeight=function(){var e=330,t=window.innerHeight,n=this.findEl(".tab-handle:visible").length*this.findEl(".tab-handle").height()+this.findEl("#apply-codes").height(),o=this.findEl(".ext-navbar").height()+this.findEl(".top-handle:visible").height()+this.findEl("#contact-banner:visible").height()-13,r=t-n-o;return e>r?e:r},Launchpad.prototype.handle_ext_message=function(){};